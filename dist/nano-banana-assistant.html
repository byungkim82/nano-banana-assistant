<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>나노 바나나 프롬프트 어시스턴트</title>
  <style>
/* ===== variables.css ===== */
/* ===== CSS 변수 - Cyberpunk Dark Theme ===== */
:root {
  /* ========== 브랜드 컬러 ========== */
  --color-primary: #FFE135;           /* 바나나 옐로우 - 메인 강조 */
  --color-primary-hover: #FFD600;     /* 호버 시 더 진한 옐로우 */
  --color-primary-active: #E6C200;    /* 클릭 시 */
  --color-primary-glow: rgba(255, 225, 53, 0.4);  /* 글로우 효과 */
  --color-primary-soft: rgba(255, 225, 53, 0.15); /* 배경용 연한 버전 */

  /* 기존 호환용 */
  --color-primary-dark: var(--color-primary-active);
  --color-primary-light: #FFF59D;

  /* ========== 배경 컬러 ========== */
  --color-bg-primary: #0D0D0D;        /* 최상위 배경 (거의 검정) */
  --color-bg-secondary: #141414;      /* 메인 컨텐츠 영역 */
  --color-bg-tertiary: #1A1A1A;       /* 카드/패널 배경 */
  --color-bg-elevated: #222222;       /* 떠있는 요소 (모달, 드롭다운) */
  --color-bg-hover: #2A2A2A;          /* 호버 상태 배경 */

  /* ========== 표면 컬러 (Glassmorphism) ========== */
  --color-surface: rgba(30, 30, 30, 0.8);
  --color-surface-light: rgba(45, 45, 45, 0.6);
  --color-surface-border: rgba(255, 255, 255, 0.08);

  /* ========== 텍스트 컬러 ========== */
  --color-text-primary: #FFFFFF;      /* 주요 텍스트 */
  --color-text-secondary: #A0A0A0;    /* 보조 텍스트 */
  --color-text-muted: #666666;        /* 비활성/힌트 텍스트 */
  --color-text-inverse: #0D0D0D;      /* 밝은 배경 위 텍스트 */

  /* ========== Secondary 컬러 ========== */
  --color-secondary: #E0E0E0;
  --color-secondary-light: #B0B0B0;

  /* ========== 상태 컬러 ========== */
  --color-success: #00D68F;           /* 성공/완료 */
  --color-success-bg: rgba(0, 214, 143, 0.15);
  --color-warning: #FFB800;           /* 경고/진행중 */
  --color-warning-bg: rgba(255, 184, 0, 0.15);
  --color-error: #FF4757;             /* 오류 */
  --color-error-bg: rgba(255, 71, 87, 0.15);
  --color-info: #3B82F6;              /* 정보 */
  --color-info-bg: rgba(59, 130, 246, 0.15);

  /* ========== 보더 컬러 ========== */
  --color-border: rgba(255, 255, 255, 0.1);
  --color-border-strong: rgba(255, 255, 255, 0.2);
  --color-border-focus: var(--color-primary);

  /* ========== 악센트 컬러 ========== */
  --color-accent: #6C5CE7;
  --color-accent-purple: #8B5CF6;
  --color-accent-cyan: #06B6D4;
  --color-accent-pink: #EC4899;

  /* ========== 타이포그래피 ========== */
  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
  --font-family: var(--font-sans);

  /* 폰트 크기 (새로운 체계) */
  --text-xs: 0.6875rem;    /* 11px - 캡션, 라벨 */
  --text-sm: 0.75rem;      /* 12px - 보조 텍스트 */
  --text-base: 0.875rem;   /* 14px - 기본 본문 */
  --text-md: 1rem;         /* 16px - 강조 본문 */
  --text-lg: 1.125rem;     /* 18px - 소제목 */
  --text-xl: 1.25rem;      /* 20px - 섹션 제목 */
  --text-2xl: 1.5rem;      /* 24px - 페이지 제목 */
  --text-3xl: 2rem;        /* 32px - 대형 헤딩 */

  /* 기존 호환용 */
  --font-size-xs: var(--text-xs);
  --font-size-sm: var(--text-sm);
  --font-size-base: var(--text-base);
  --font-size-lg: var(--text-lg);
  --font-size-xl: var(--text-xl);
  --font-size-2xl: var(--text-2xl);

  /* 폰트 굵기 */
  --font-normal: 400;
  --font-medium: 500;
  --font-semibold: 600;
  --font-bold: 700;

  /* 행간 */
  --leading-tight: 1.25;
  --leading-normal: 1.5;
  --leading-relaxed: 1.75;

  /* 자간 */
  --tracking-tight: -0.02em;
  --tracking-normal: 0;
  --tracking-wide: 0.02em;

  /* ========== 간격 시스템 ========== */
  --space-0: 0;
  --space-1: 0.25rem;   /* 4px */
  --space-2: 0.5rem;    /* 8px */
  --space-3: 0.75rem;   /* 12px */
  --space-4: 1rem;      /* 16px */
  --space-5: 1.25rem;   /* 20px */
  --space-6: 1.5rem;    /* 24px */
  --space-8: 2rem;      /* 32px */
  --space-10: 2.5rem;   /* 40px */
  --space-12: 3rem;     /* 48px */
  --space-16: 4rem;     /* 64px */

  /* 기존 호환용 */
  --spacing-xs: var(--space-1);
  --spacing-sm: var(--space-2);
  --spacing-md: var(--space-4);
  --spacing-lg: var(--space-6);
  --spacing-xl: var(--space-8);

  /* ========== 테두리 반경 ========== */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  --radius-full: 9999px;

  /* ========== 그림자 ========== */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.3);
  --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.4);
  --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.5);

  /* 특수 그림자 */
  --shadow-glow-primary: 0 0 20px var(--color-primary-glow);
  --shadow-glow-success: 0 0 20px rgba(0, 214, 143, 0.4);
  --shadow-glow-error: 0 0 20px rgba(255, 71, 87, 0.4);

  /* 인셋 그림자 */
  --shadow-inset: inset 0 2px 4px rgba(0, 0, 0, 0.3);

  /* ========== Z-Index 레이어 ========== */
  --z-base: 0;
  --z-dropdown: 100;
  --z-sticky: 200;
  --z-overlay: 300;
  --z-modal: 400;
  --z-popover: 500;
  --z-tooltip: 600;
  --z-toast: 700;

  /* ========== 애니메이션 ========== */
  --ease-default: cubic-bezier(0.4, 0, 0.2, 1);
  --ease-in: cubic-bezier(0.4, 0, 1, 1);
  --ease-out: cubic-bezier(0, 0, 0.2, 1);
  --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);

  --duration-fast: 0.1s;
  --duration-normal: 0.15s;
  --duration-slow: 0.3s;
  --duration-slower: 0.5s;

  /* 기존 호환용 */
  --transition-theme: all 0.15s ease;

  /* ========== 아이콘 크기 ========== */
  --icon-xs: 12px;
  --icon-sm: 16px;
  --icon-md: 20px;
  --icon-lg: 24px;
  --icon-xl: 32px;
}


/* ===== reset.css ===== */
/* ===== 리셋 & 기본 - Cyberpunk Dark Theme ===== */
*, *::before, *::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  font-family: var(--font-family);
  font-size: var(--text-base);
  color: var(--color-text-primary);
  background-color: var(--color-bg-primary);
  line-height: var(--leading-normal);
}

img, video {
  max-width: 100%;
  height: auto;
  display: block;
}

button {
  font-family: inherit;
  font-size: inherit;
  cursor: pointer;
  background: none;
  border: none;
}

input, textarea, select {
  font-family: inherit;
  font-size: inherit;
}

a {
  color: inherit;
  text-decoration: none;
}

ul, ol {
  list-style: none;
}

/* 스크롤바 스타일 (다크 테마) */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--color-bg-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--color-bg-hover);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-border-strong);
}

/* Firefox 스크롤바 */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--color-bg-hover) var(--color-bg-secondary);
}


/* ===== layout.css ===== */
/* ===== 레이아웃 - Cyberpunk Dark Theme ===== */
#app {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: var(--color-bg-primary);
}

/* ===== 헤더 ===== */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 var(--space-5);
  background: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border);
  height: 56px;
}

.header-title {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  font-size: var(--text-lg);
  font-weight: var(--font-bold);
  color: var(--color-text-primary);
}

.header-title span:first-child {
  font-size: 28px;
}

.header-title span:last-child {
  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-hover) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.header-actions {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

/* ===== 작업 모드 바 ===== */
.work-mode-bar {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  padding: 0 var(--space-5);
  background: var(--color-bg-tertiary);
  border-bottom: 1px solid var(--color-border);
  min-height: 48px;
}

.work-mode-label {
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  color: var(--color-text-secondary);
}

.work-mode-buttons {
  display: flex;
  gap: var(--space-1);
}

.work-mode-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--space-2) var(--space-4);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-bg-tertiary);
  cursor: pointer;
  transition: all 0.15s ease;
  min-width: 80px;
  color: var(--color-text-secondary);
}

.work-mode-btn:hover {
  border-color: var(--color-border-strong);
  background: var(--color-bg-hover);
  color: var(--color-text-primary);
}

.work-mode-btn.active {
  border-color: var(--color-primary);
  background: var(--color-primary-soft);
  color: var(--color-text-primary);
}

.work-mode-btn .mode-icon {
  font-size: var(--text-lg);
}

.work-mode-btn .mode-name {
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  color: inherit;
}

.work-mode-btn .mode-size {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
}

.work-mode-btn.active .mode-size {
  color: var(--color-text-secondary);
}

.translate-toggle {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  cursor: pointer;
}

.translate-toggle input {
  width: 16px;
  height: 16px;
  cursor: pointer;
  accent-color: var(--color-primary);
}

.translate-toggle:hover {
  color: var(--color-text-primary);
}

/* ===== 메인 컨텐츠 (2열) ===== */
.main {
  flex: 1;
  display: grid;
  grid-template-columns: 1fr 400px;
  gap: var(--space-6);
  padding: var(--space-6);
  max-width: 1600px;
  margin: 0 auto;
  width: 100%;
}

/* ===== 3열 레이아웃 ===== */
.main-3col {
  flex: 1;
  display: grid;
  grid-template-columns: 280px 1fr 320px;
  gap: 0;
  overflow: hidden;
}

/* ===== 패널 ===== */
.panel {
  background: var(--color-bg-secondary);
  border-right: 1px solid var(--color-border);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

.panel:last-child {
  border-right: none;
  border-left: 1px solid var(--color-border);
}

/* 가운데 패널 (빌더 영역) */
.panel:nth-child(2) {
  background: var(--color-bg-primary);
  border-right: 1px solid var(--color-border);
}

.panel-header {
  background: var(--color-bg-tertiary);
  padding: var(--space-3) var(--space-4);
  border-bottom: 1px solid var(--color-border);
  font-weight: var(--font-semibold);
  font-size: var(--text-sm);
  display: flex;
  align-items: center;
  gap: var(--space-2);
  color: var(--color-text-primary);
  flex-shrink: 0;
}

.panel-body {
  padding: var(--space-4);
  flex: 1;
  overflow-y: auto;
}


/* ===== components.css ===== */
/* ===== 버튼 - Cyberpunk Dark Theme ===== */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  padding: 10px 16px;
  border: none;
  border-radius: var(--radius-md);
  font-family: inherit;
  font-size: var(--text-base);
  font-weight: var(--font-medium);
  cursor: pointer;
  transition: all 0.15s ease;
  white-space: nowrap;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}

.btn-primary {
  background: var(--color-primary);
  color: var(--color-text-inverse);
}

.btn-primary:hover:not(:disabled) {
  background: var(--color-primary-hover);
  transform: translateY(-1px);
  box-shadow: var(--shadow-glow-primary);
}

.btn-primary:active:not(:disabled) {
  background: var(--color-primary-active);
  transform: scale(0.98);
}

.btn-secondary {
  background: var(--color-bg-tertiary);
  color: var(--color-text-primary);
  border: 1px solid var(--color-border);
}

.btn-secondary:hover:not(:disabled) {
  background: var(--color-bg-hover);
  border-color: var(--color-border-strong);
}

.btn-outline {
  background: transparent;
  border: 1px solid var(--color-border);
  color: var(--color-text-secondary);
}

.btn-outline:hover:not(:disabled) {
  background: var(--color-bg-hover);
  border-color: var(--color-border-strong);
  color: var(--color-text-primary);
}

.btn-ghost {
  background: transparent;
  color: var(--color-text-secondary);
}

.btn-ghost:hover:not(:disabled) {
  background: var(--color-bg-hover);
  color: var(--color-text-primary);
}

.btn-accent {
  background: var(--color-accent);
  color: white;
}

.btn-accent:hover:not(:disabled) {
  background: var(--color-accent-purple);
  transform: translateY(-1px);
}

.btn-lg {
  padding: 14px 28px;
  font-size: var(--text-md);
}

.btn-sm {
  padding: 6px 12px;
  font-size: var(--text-sm);
}

.btn-icon {
  padding: var(--space-2);
  min-width: 36px;
}

.btn-danger {
  color: var(--color-error);
  border-color: var(--color-error);
}

.btn-danger:hover:not(:disabled) {
  background: var(--color-error);
  color: white;
}

/* ===== 폼 요소 ===== */
.form-group {
  margin-bottom: var(--space-4);
}

.form-label {
  display: block;
  margin-bottom: var(--space-2);
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  color: var(--color-text-secondary);
}

.form-label .required {
  color: var(--color-error);
  margin-left: 2px;
}

.form-help {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  margin-top: var(--space-1);
}

.form-input,
.form-textarea,
.form-select {
  width: 100%;
  padding: 10px 12px;
  font-size: var(--text-base);
  color: var(--color-text-primary);
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  font-family: inherit;
  outline: none;
  transition: all 0.15s ease;
}

.form-input::placeholder,
.form-textarea::placeholder {
  color: var(--color-text-muted);
}

.form-input:hover,
.form-textarea:hover,
.form-select:hover {
  border-color: var(--color-border-strong);
}

.form-input:focus,
.form-textarea:focus,
.form-select:focus {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-primary-soft);
}

.form-textarea {
  min-height: 80px;
  resize: vertical;
  line-height: var(--leading-relaxed);
}

.form-select {
  cursor: pointer;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23A0A0A0' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  -webkit-appearance: none;
  appearance: none;
  padding-right: 36px;
}

.form-checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
}

.form-checkbox-label {
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-1) var(--space-2);
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  transition: all 0.15s ease;
}

.form-checkbox-label:hover {
  background: var(--color-bg-hover);
  border-color: var(--color-border-strong);
}

.form-checkbox-label input {
  cursor: pointer;
  accent-color: var(--color-primary);
}

.form-row {
  display: flex;
  gap: var(--space-4);
}

.form-row .form-group {
  flex: 1;
}

.form-group-sm {
  max-width: 80px !important;
  flex: 0 0 80px !important;
}

/* ===== 템플릿 탭 ===== */
.template-tabs {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-1);
  padding: var(--space-3);
  background: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border);
}

.template-tab {
  padding: var(--space-2) var(--space-4);
  border: none;
  border-radius: var(--radius-md);
  background: transparent;
  font-family: inherit;
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.template-tab:hover {
  background: var(--color-bg-hover);
  color: var(--color-text-primary);
}

.template-tab.active {
  background: var(--color-primary);
  color: var(--color-text-inverse);
  font-weight: var(--font-semibold);
}

.template-tab .icon {
  font-size: var(--text-lg);
}

.template-tab-divider {
  color: var(--color-text-muted);
  padding: 0 var(--space-1);
  display: flex;
  align-items: center;
}

.template-tab-custom {
  border: 1px dashed var(--color-border);
}

.template-tab-add {
  border: 1px dashed var(--color-primary);
  color: var(--color-primary);
}

.template-tab-add:hover {
  background: var(--color-primary-soft);
}

/* ===== 프롬프트 미리보기 ===== */
.prompt-preview {
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  margin-top: var(--space-6);
  overflow: hidden;
}

.prompt-preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-3) var(--space-4);
  border-bottom: 1px solid var(--color-border);
  background: var(--color-bg-secondary);
}

.prompt-preview-title {
  font-weight: var(--font-semibold);
  color: var(--color-text-secondary);
  font-size: var(--text-sm);
}

.prompt-preview-text {
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  line-height: var(--leading-relaxed);
  color: var(--color-text-secondary);
  white-space: pre-wrap;
  word-break: break-word;
  min-height: 60px;
  padding: var(--space-4);
  max-height: 200px;
  overflow-y: auto;
}

.prompt-preview-text.empty {
  color: var(--color-text-muted);
  font-style: italic;
}

/* ===== 프롬프트 탭 ===== */
.prompt-tabs {
  display: flex;
  gap: var(--space-1);
}

.prompt-tab {
  padding: var(--space-1) var(--space-3);
  border: none;
  background: transparent;
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.prompt-tab:hover {
  background: var(--color-bg-hover);
}

.prompt-tab.active {
  background: var(--color-accent);
  color: white;
}

/* ===== 번역 상태 ===== */
.translate-status {
  display: flex;
  align-items: center;
  gap: var(--space-1);
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  margin-top: var(--space-2);
  padding: 0 var(--space-4);
  padding-bottom: var(--space-3);
}

.translate-status.translating {
  color: var(--color-warning);
}

.translate-status.translated {
  color: var(--color-success);
}

/* ===== API 상태 ===== */
.api-status {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  font-size: var(--text-sm);
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-md);
}

.api-status.connected {
  background: var(--color-success-bg);
  color: var(--color-success);
}

.api-status.disconnected {
  background: var(--color-error-bg);
  color: var(--color-error);
}

.api-status.testing {
  background: var(--color-warning-bg);
  color: var(--color-warning);
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
}

/* ===== 액션 바 ===== */
.action-bar {
  display: flex;
  gap: var(--space-3);
  padding-top: var(--space-6);
  border-top: 1px solid var(--color-border);
  margin-top: var(--space-6);
}

.action-bar .btn {
  flex: 1;
}

/* ===== 입력 그룹 ===== */
.input-group {
  display: flex;
  gap: var(--space-2);
}

.input-group .form-input {
  flex: 1;
}

/* ===== 에러 & 성공 메시지 ===== */
.error-message {
  background: var(--color-error-bg);
  border: 1px solid var(--color-error);
  color: var(--color-error);
  padding: var(--space-4);
  border-radius: var(--radius-md);
  margin-top: var(--space-4);
  font-size: var(--text-sm);
}

.success-message {
  background: var(--color-success-bg);
  border: 1px solid var(--color-success);
  color: var(--color-success);
  padding: var(--space-4);
  border-radius: var(--radius-md);
  margin-top: var(--space-4);
  font-size: var(--text-sm);
}

/* ===== 로딩 ===== */
.loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-4);
}

.loading-spinner {
  width: 48px;
  height: 48px;
  border: 4px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-text {
  color: var(--color-text-secondary);
  font-size: var(--text-sm);
}

/* ===== 접근성 ===== */

/* 기본 포커스 제거 */
*:focus {
  outline: none;
}

/* 키보드 포커스에만 표시 */
*:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
}

/* 버튼 포커스 스타일 */
.btn:focus-visible {
  box-shadow: 0 0 0 3px var(--color-primary-soft);
}

/* 템플릿 탭 포커스 */
.template-tab:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
  z-index: 1;
}

/* 폼 요소 포커스 */
.form-input:focus-visible,
.form-textarea:focus-visible,
.form-select:focus-visible {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-primary-soft);
}

/* 스크린 리더 전용 */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* 스크린 리더에서만 읽히고 포커스 시 표시 */
.sr-only-focusable:focus,
.sr-only-focusable:active {
  position: static;
  width: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* 줄어든 모션 선호 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .loading-spinner {
    animation: none;
    border-top-color: var(--color-primary);
    opacity: 0.7;
  }
}

/* 스킵 네비게이션 링크 */
.skip-link {
  position: absolute;
  top: -100px;
  left: 0;
  background: var(--color-primary);
  color: var(--color-text-inverse);
  padding: var(--space-2) var(--space-4);
  z-index: 9999;
  text-decoration: none;
  border-radius: 0 0 var(--radius-md) 0;
  font-weight: var(--font-medium);
}

.skip-link:focus {
  top: 0;
}

/* ===== 팁 팝업 ===== */
.tip-popup {
  background: var(--color-bg-elevated);
  border: 1px solid var(--color-primary);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  max-width: 320px;
  z-index: 1100;
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.tip-popup.visible {
  opacity: 1;
  transform: translateY(0);
}

.tip-header {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  background: var(--color-primary-soft);
  border-bottom: 1px solid var(--color-border);
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.tip-icon {
  font-size: var(--text-lg);
}

.tip-title {
  flex: 1;
  font-weight: var(--font-semibold);
  font-size: var(--text-sm);
  color: var(--color-text-primary);
}

.tip-close {
  background: none;
  border: none;
  font-size: var(--text-lg);
  color: var(--color-text-muted);
  cursor: pointer;
  padding: 0;
  line-height: 1;
}

.tip-close:hover {
  color: var(--color-text-primary);
}

.tip-message {
  padding: var(--space-4);
  font-size: var(--text-sm);
  line-height: var(--leading-normal);
  color: var(--color-text-secondary);
}

.tip-footer {
  padding: var(--space-2) var(--space-4);
  border-top: 1px solid var(--color-border);
  text-align: right;
}

.tip-dismiss-all {
  background: none;
  border: none;
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  cursor: pointer;
  padding: var(--space-1);
}

.tip-dismiss-all:hover {
  color: var(--color-primary);
  text-decoration: underline;
}

/* ===== panels.css ===== */
/* ===== 결과 패널 - Cyberpunk Dark Theme ===== */
.result-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 300px;
  text-align: center;
}

.result-placeholder {
  color: var(--color-text-muted);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-4);
}

.result-placeholder-icon {
  font-size: 48px;
  opacity: 0.5;
}

.result-image {
  max-width: 100%;
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-md);
}

.result-actions {
  display: flex;
  gap: var(--space-2);
  margin-top: var(--space-4);
  justify-content: center;
}

/* ===== 이미지 업로드 영역 ===== */
.upload-area {
  border: 2px dashed var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--space-8);
  text-align: center;
  cursor: pointer;
  transition: all 0.15s ease;
  background: var(--color-bg-tertiary);
}

.upload-area:hover {
  border-color: var(--color-primary);
  background: var(--color-primary-soft);
}

.upload-area.drag-over {
  border-color: var(--color-primary);
  border-style: solid;
  background: var(--color-primary-soft);
  transform: scale(1.02);
}

.upload-area-icon {
  font-size: 48px;
  margin-bottom: var(--space-4);
  opacity: 0.5;
}

.upload-area-text {
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
}

.upload-area-hint {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  margin-top: var(--space-2);
}

/* ===== 썸네일 그리드 ===== */
.thumbnail-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-2);
  margin-top: var(--space-4);
}

.thumbnail-item {
  position: relative;
  aspect-ratio: 1;
  border-radius: var(--radius-md);
  overflow: hidden;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.15s ease;
  background: var(--color-bg-tertiary);
}

.thumbnail-item:hover {
  border-color: var(--color-border-strong);
}

.thumbnail-item.selected {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 2px var(--color-primary-soft);
}

.thumbnail-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.thumbnail-item .thumbnail-index {
  position: absolute;
  top: 4px;
  left: 4px;
  width: 20px;
  height: 20px;
  background: var(--color-primary);
  color: var(--color-text-inverse);
  font-size: var(--text-xs);
  font-weight: var(--font-bold);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
}

.thumbnail-item .thumbnail-delete {
  position: absolute;
  top: 4px;
  right: 4px;
  background: var(--color-error);
  color: white;
  border: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 12px;
  display: none;
  align-items: center;
  justify-content: center;
  transition: transform 0.15s ease;
}

.thumbnail-item:hover .thumbnail-delete {
  display: flex;
}

.thumbnail-item .thumbnail-delete:hover {
  transform: scale(1.1);
}

/* 드래그 앤 드롭 스타일 */
.thumbnail-item.dragging {
  opacity: 0.5;
  border-color: var(--color-primary);
  transform: scale(0.95);
}

.thumbnail-item.drag-over {
  border-color: var(--color-primary);
  background: var(--color-primary-soft);
  transform: scale(1.05);
}

.thumbnail-item.drag-over::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border: 2px dashed var(--color-primary);
  border-radius: var(--radius-md);
  z-index: 10;
  pointer-events: none;
}

/* 드래그 가능 커서 */
.thumbnail-item[draggable="true"] {
  cursor: grab;
}

.thumbnail-item[draggable="true"]:active {
  cursor: grabbing;
}

/* ===== 선택된 이미지 정보 ===== */
.selected-image-info {
  margin-top: var(--space-4);
  padding: var(--space-4);
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
}

.selected-image-preview {
  width: 100%;
  aspect-ratio: 4/3;
  object-fit: contain;
  background: var(--color-bg-secondary);
  border-radius: var(--radius-sm);
  margin-bottom: var(--space-3);
}

.selected-image-meta {
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
}

.selected-image-meta p {
  margin-bottom: var(--space-1);
}

.selected-image-actions {
  display: flex;
  gap: var(--space-2);
  margin-top: var(--space-3);
}

/* ===== 결과 히스토리 ===== */
.result-history {
  display: flex;
  gap: var(--space-2);
  overflow-x: auto;
  padding-bottom: var(--space-2);
  margin-bottom: var(--space-4);
}

.result-history-item {
  flex-shrink: 0;
  width: 60px;
  height: 60px;
  border-radius: var(--radius-sm);
  overflow: hidden;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.15s ease;
}

.result-history-item:hover {
  border-color: var(--color-border-strong);
}

.result-history-item.selected {
  border-color: var(--color-primary);
}

.result-history-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* ===== 이미지 확대 모달 ===== */
.image-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

.image-modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.image-modal-content {
  position: relative;
  max-width: 90vw;
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.image-modal-img {
  max-width: 100%;
  max-height: 80vh;
  object-fit: contain;
  border-radius: var(--radius-md);
}

.image-modal-close {
  position: absolute;
  top: -40px;
  right: 0;
  background: none;
  border: none;
  color: white;
  font-size: 32px;
  cursor: pointer;
  padding: var(--space-2);
  transition: color 0.15s ease;
}

.image-modal-close:hover {
  color: var(--color-primary);
}

.image-modal-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: var(--color-bg-hover);
  border: 1px solid var(--color-border);
  color: white;
  font-size: 24px;
  padding: var(--space-4);
  cursor: pointer;
  border-radius: var(--radius-md);
  transition: all 0.15s ease;
}

.image-modal-nav:hover {
  background: var(--color-bg-tertiary);
  border-color: var(--color-primary);
}

.image-modal-nav.prev {
  left: -60px;
}

.image-modal-nav.next {
  right: -60px;
}

.image-modal-actions {
  display: flex;
  gap: var(--space-3);
  margin-top: var(--space-4);
}

.image-modal-info {
  color: var(--color-text-secondary);
  font-size: var(--text-sm);
  margin-top: var(--space-3);
  text-align: center;
  max-width: 600px;
}

/* ===== 캔버스 생성기 버튼 ===== */
.canvas-generator-btn-container {
  margin-top: var(--space-4);
  text-align: center;
}


/* ===== modals.css ===== */
/* ===== 모달 - Cyberpunk Dark Theme ===== */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(4px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: var(--z-modal);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, visibility 0.2s ease;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: var(--color-bg-elevated);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  width: 100%;
  max-width: 500px;
  max-height: 90vh;
  overflow: hidden;
  transform: scale(0.95);
  transition: transform 0.2s ease;
}

.modal-overlay.active .modal {
  transform: scale(1);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-4) var(--space-6);
  border-bottom: 1px solid var(--color-border);
  background: var(--color-bg-tertiary);
}

.modal-title {
  font-size: var(--text-lg);
  font-weight: var(--font-semibold);
  color: var(--color-text-primary);
}

.modal-close {
  background: none;
  border: none;
  font-size: var(--text-xl);
  cursor: pointer;
  color: var(--color-text-muted);
  padding: var(--space-1);
  line-height: 1;
  transition: color 0.15s ease;
}

.modal-close:hover {
  color: var(--color-primary);
}

.modal-body {
  padding: var(--space-6);
  overflow-y: auto;
  background: var(--color-bg-elevated);
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: var(--space-2);
  padding: var(--space-4) var(--space-6);
  border-top: 1px solid var(--color-border);
  background: var(--color-bg-tertiary);
}

/* 모달 사이즈 변형 */
.modal-lg {
  max-width: 700px;
}

.modal-xl {
  max-width: 900px;
}

/* ===== 프롬프트 히스토리 ===== */
.history-search {
  margin-bottom: var(--space-4);
}

.prompt-history-list {
  max-height: 400px;
  overflow-y: auto;
}

.history-item {
  display: flex;
  gap: var(--space-4);
  padding: var(--space-4);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-2);
  background: var(--color-bg-tertiary);
  transition: all 0.15s ease;
}

.history-item:hover {
  border-color: var(--color-primary);
  background: var(--color-bg-hover);
}

.history-item-content {
  flex: 1;
  min-width: 0;
}

.history-prompt {
  font-size: var(--text-sm);
  color: var(--color-text-primary);
  line-height: 1.4;
  word-break: break-word;
}

.history-translated {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  margin-top: var(--space-1);
  font-family: var(--font-mono);
}

.history-meta {
  display: flex;
  gap: var(--space-4);
  margin-top: var(--space-2);
  font-size: var(--text-xs);
  color: var(--color-text-muted);
}

.history-template {
  background: var(--color-primary-soft);
  color: var(--color-primary);
  padding: 2px 6px;
  border-radius: var(--radius-sm);
  font-weight: var(--font-medium);
}

.history-item-actions {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
}

.empty-history {
  text-align: center;
  padding: var(--space-8);
  color: var(--color-text-muted);
}

/* ===== 캔버스 생성기 ===== */
.aspect-ratio-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: var(--space-1);
}

.aspect-ratio-btn {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-2);
  border: 2px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-bg-tertiary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.aspect-ratio-btn:hover {
  border-color: var(--color-border-strong);
  background: var(--color-bg-hover);
}

.aspect-ratio-btn.active {
  border-color: var(--color-primary);
  background: var(--color-primary-soft);
}

.ratio-preview {
  border-radius: 2px;
  background: var(--color-bg-hover);
  border: 1px solid var(--color-border);
}

.ratio-label {
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
  text-align: center;
}

.aspect-ratio-btn.active .ratio-label {
  color: var(--color-primary);
}

.size-input-row {
  display: flex;
  align-items: flex-end;
  gap: var(--space-2);
}

.size-input-group {
  flex: 1;
}

.size-input-group label {
  display: block;
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  margin-bottom: var(--space-1);
}

.size-input-group .form-input {
  width: 100%;
}

.size-separator {
  padding-bottom: var(--space-2);
  color: var(--color-text-muted);
}

.size-unit {
  padding-bottom: var(--space-2);
  color: var(--color-text-muted);
  font-size: var(--text-sm);
}

.background-options {
  display: flex;
  gap: var(--space-4);
}

.background-option {
  display: flex;
  align-items: center;
  gap: var(--space-1);
  cursor: pointer;
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
}

.background-option:hover {
  color: var(--color-text-primary);
}

.bg-preview {
  width: 24px;
  height: 24px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
}

.bg-white {
  background: #FFFFFF;
}

.bg-transparent {
  background: repeating-conic-gradient(#444444 0% 25%, #222222 0% 50%) 50% / 8px 8px;
}

.canvas-preview-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-4);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  margin-top: var(--space-4);
}

#canvasPreview {
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
}

.canvas-info {
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
}

/* ===== 템플릿 에디터 ===== */
.template-editor-body {
  max-height: 70vh;
  overflow-y: auto;
}

.editor-section {
  margin-bottom: var(--space-6);
  padding-bottom: var(--space-6);
  border-bottom: 1px solid var(--color-border);
}

.editor-section:last-child {
  border-bottom: none;
  margin-bottom: 0;
}

.editor-section h3 {
  font-size: var(--text-base);
  font-weight: var(--font-semibold);
  margin-bottom: var(--space-4);
  color: var(--color-text-primary);
}

.editor-section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-4);
}

.template-fields-editor {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.editor-field-item {
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  overflow: hidden;
}

.editor-field-header {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  background: var(--color-bg-hover);
  border-bottom: 1px solid var(--color-border);
}

.field-drag-handle {
  cursor: move;
  color: var(--color-text-muted);
  font-size: var(--text-sm);
}

.field-type-badge {
  background: var(--color-primary);
  color: var(--color-text-inverse);
  padding: 2px 8px;
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
}

.field-label-preview {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  color: var(--color-text-muted);
}

.field-actions {
  margin-left: auto;
  display: flex;
  gap: var(--space-1);
}

.editor-field-body {
  padding: var(--space-4);
}

.field-row {
  display: flex;
  gap: var(--space-2);
  margin-bottom: var(--space-2);
}

.field-col {
  flex: 1;
}

.field-col-sm {
  max-width: 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.field-col label {
  display: block;
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-1);
}

.field-options {
  background: var(--color-bg-primary);
  padding: var(--space-2);
  border-radius: var(--radius-sm);
  margin-top: var(--space-2);
  border: 1px solid var(--color-border);
}

.option-row {
  display: flex;
  gap: var(--space-1);
  margin-bottom: var(--space-1);
}

.option-row .form-input {
  flex: 1;
}

.empty-fields-message {
  text-align: center;
  padding: var(--space-8);
  color: var(--color-text-muted);
}

.field-placeholders {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-1);
  margin-bottom: var(--space-2);
}

.field-placeholder-btn {
  padding: var(--space-1) var(--space-2);
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-family: var(--font-mono);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.field-placeholder-btn:hover {
  background: var(--color-primary-soft);
  border-color: var(--color-primary);
  color: var(--color-primary);
}

.custom-template-actions {
  display: flex;
  gap: var(--space-1);
  margin-bottom: var(--space-4);
  padding-bottom: var(--space-4);
  border-bottom: 1px solid var(--color-border);
  flex-wrap: wrap;
}

.template-duplicate-btn {
  margin-bottom: var(--space-4);
}

/* ===== 도움말 모달 ===== */
.help-tabs {
  display: flex;
  gap: var(--space-1);
  margin-bottom: var(--space-4);
  border-bottom: 1px solid var(--color-border);
  padding-bottom: var(--space-2);
}

.help-tab {
  padding: var(--space-2) var(--space-4);
  background: transparent;
  border: none;
  border-radius: var(--radius-sm);
  font-family: inherit;
  font-size: var(--text-sm);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.help-tab:hover {
  background: var(--color-bg-hover);
  color: var(--color-text-primary);
}

.help-tab.active {
  background: var(--color-primary);
  color: var(--color-text-inverse);
}

.help-content {
  max-height: 400px;
  overflow-y: auto;
  padding-right: var(--space-2);
}

.help-content h3 {
  font-size: var(--text-xl);
  margin-bottom: var(--space-4);
  color: var(--color-text-primary);
}

.help-content h4 {
  font-size: var(--text-lg);
  margin: var(--space-6) 0 var(--space-2);
  color: var(--color-text-primary);
}

.help-content h5 {
  font-size: var(--text-base);
  margin: var(--space-4) 0 var(--space-2);
  color: var(--color-text-secondary);
}

.help-content p {
  margin-bottom: var(--space-4);
  line-height: 1.6;
  color: var(--color-text-secondary);
}

.help-content ul,
.help-content ol {
  margin: var(--space-2) 0;
  padding-left: var(--space-6);
}

.help-content li {
  margin-bottom: var(--space-1);
  line-height: 1.5;
  color: var(--color-text-secondary);
}

.help-content details {
  margin-bottom: var(--space-2);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-2) var(--space-4);
  background: var(--color-bg-tertiary);
}

.help-content summary {
  font-weight: var(--font-medium);
  cursor: pointer;
  padding: var(--space-1) 0;
  color: var(--color-text-primary);
}

.help-content details[open] summary {
  margin-bottom: var(--space-2);
  border-bottom: 1px solid var(--color-border);
  padding-bottom: var(--space-2);
}

.help-content a {
  color: var(--color-primary);
  text-decoration: none;
}

.help-content a:hover {
  text-decoration: underline;
}

/* 단축키 테이블 */
.shortcuts-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: var(--space-4);
}

.shortcuts-table td {
  padding: var(--space-2);
  border-bottom: 1px solid var(--color-border);
  color: var(--color-text-secondary);
}

.shortcuts-table td:first-child {
  width: 120px;
}

.shortcuts-table kbd {
  display: inline-block;
  padding: 2px 6px;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  color: var(--color-primary);
}


/* ===== editing.css ===== */
/* ===== Thinking 모드 토글 - Cyberpunk Dark Theme ===== */
.thinking-toggle {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  background: var(--color-bg-tertiary);
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: all 0.15s ease;
  border: 2px solid transparent;
}

.thinking-toggle:hover {
  border-color: var(--color-border-strong);
  background: var(--color-bg-hover);
}

.thinking-toggle.active {
  background: var(--color-primary-soft);
  border-color: var(--color-primary);
}

.thinking-toggle input {
  display: none;
}

.thinking-toggle-switch {
  width: 40px;
  height: 20px;
  background: var(--color-bg-hover);
  border-radius: 10px;
  position: relative;
  transition: background 0.15s ease;
}

.thinking-toggle.active .thinking-toggle-switch {
  background: var(--color-primary);
}

.thinking-toggle-switch::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 2px;
  width: 16px;
  height: 16px;
  background: white;
  border-radius: 50%;
  transition: transform 0.15s ease;
}

.thinking-toggle.active .thinking-toggle-switch::after {
  transform: translateX(20px);
}

.thinking-toggle-label {
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  color: var(--color-text-secondary);
}

.thinking-toggle.active .thinking-toggle-label {
  color: var(--color-primary);
}

.thinking-tooltip {
  position: relative;
}

.thinking-tooltip .tooltip-content {
  position: absolute;
  top: 100%;
  right: 0;
  width: 280px;
  background: var(--color-bg-elevated);
  color: var(--color-text-primary);
  padding: var(--space-4);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  font-size: var(--text-xs);
  line-height: 1.5;
  z-index: var(--z-tooltip);
  opacity: 0;
  visibility: hidden;
  transform: translateY(8px);
  transition: all 0.15s ease;
  box-shadow: var(--shadow-lg);
}

.thinking-tooltip:hover .tooltip-content {
  opacity: 1;
  visibility: visible;
  transform: translateY(4px);
}

/* ===== 편집 세션 UI ===== */
.edit-session {
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  padding: var(--space-4);
  margin-bottom: var(--space-4);
}

.edit-session-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-2);
}

.edit-session-title {
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  color: var(--color-text-primary);
  display: flex;
  align-items: center;
  gap: var(--space-1);
}

.edit-session-actions {
  display: flex;
  gap: var(--space-1);
}

/* 편집 히스토리 */
.edit-history {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
  margin-bottom: var(--space-4);
  max-height: 200px;
  overflow-y: auto;
}

.edit-history-item {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2);
  background: var(--color-bg-secondary);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.15s ease;
  border: 2px solid transparent;
}

.edit-history-item:hover {
  border-color: var(--color-border-strong);
  background: var(--color-bg-hover);
}

.edit-history-item.active {
  border-color: var(--color-primary);
  background: var(--color-primary-soft);
}

.edit-history-item .step-number {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--color-primary);
  color: var(--color-text-inverse);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  flex-shrink: 0;
}

.edit-history-item.pending .step-number {
  background: var(--color-bg-hover);
  color: var(--color-text-muted);
}

.edit-history-item .step-content {
  flex: 1;
  overflow: hidden;
}

.edit-history-item .step-label {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
}

.edit-history-item .step-text {
  font-size: var(--text-sm);
  color: var(--color-text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.edit-history-item .step-thumb {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-sm);
  overflow: hidden;
  flex-shrink: 0;
  border: 1px solid var(--color-border);
}

.edit-history-item .step-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* 수정 요청 입력 */
.edit-request {
  margin-top: var(--space-2);
}

.edit-request-input {
  width: 100%;
  padding: var(--space-2);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  font-family: inherit;
  font-size: var(--text-sm);
  background: var(--color-bg-secondary);
  color: var(--color-text-primary);
  resize: none;
  min-height: 60px;
  transition: border-color 0.15s ease, box-shadow 0.15s ease;
}

.edit-request-input:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-primary-soft);
}

.edit-request-input::placeholder {
  color: var(--color-text-muted);
}

.edit-request-actions {
  display: flex;
  justify-content: flex-end;
  gap: var(--space-1);
  margin-top: var(--space-2);
}

/* ===== 빠른 수정 프리셋 ===== */
.quick-presets {
  margin-top: var(--space-4);
  padding-top: var(--space-4);
  border-top: 1px solid var(--color-border);
}

.quick-presets-title {
  font-size: var(--text-sm);
  font-weight: var(--font-semibold);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-2);
}

.preset-categories {
  display: flex;
  gap: var(--space-1);
  margin-bottom: var(--space-2);
  flex-wrap: wrap;
}

.preset-category-btn {
  padding: var(--space-1) var(--space-2);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background: var(--color-bg-tertiary);
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.preset-category-btn:hover {
  border-color: var(--color-border-strong);
  background: var(--color-bg-hover);
  color: var(--color-text-primary);
}

.preset-category-btn.active {
  background: var(--color-primary);
  color: var(--color-text-inverse);
  border-color: var(--color-primary);
}

.preset-items {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-1);
}

.preset-item {
  padding: var(--space-1) var(--space-2);
  background: var(--color-bg-secondary);
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.preset-item:hover {
  background: var(--color-primary-soft);
  border-color: var(--color-primary);
  color: var(--color-primary);
}


/* ===== responsive.css ===== */
/* ===== 반응형 - Cyberpunk Dark Theme ===== */

/* 태블릿 (768px - 1199px) */
@media (max-width: 1199px) and (min-width: 768px) {
  .main-3col {
    grid-template-columns: 1fr 1fr;
    gap: var(--space-4);
  }

  /* 첨부 패널을 접을 수 있는 형태로 */
  .main-3col > .panel:first-child {
    grid-column: 1 / -1;
  }

  .main-3col > .panel:first-child .panel-body {
    max-height: 300px;
    overflow-y: auto;
  }

  /* 썸네일 그리드 조정 */
  .thumbnail-grid {
    grid-template-columns: repeat(6, 1fr);
  }
}

/* 작은 태블릿 / 큰 모바일 (768px - 1023px) */
@media (max-width: 1023px) {
  .main {
    grid-template-columns: 1fr;
  }

  .main-3col {
    grid-template-columns: 1fr;
  }

  .header-title {
    font-size: var(--text-lg);
  }

  .template-tabs {
    flex-wrap: wrap;
    justify-content: center;
  }

  .template-tab {
    padding: var(--space-1) var(--space-2);
    font-size: var(--text-sm);
  }
}

/* 모바일 (767px 이하) */
@media (max-width: 767px) {
  /* 헤더 */
  .header {
    flex-direction: column;
    gap: var(--space-2);
    text-align: center;
    padding: var(--space-2) var(--space-4);
  }

  .header-title {
    font-size: var(--text-base);
  }

  .header-actions {
    width: 100%;
    justify-content: center;
    flex-wrap: wrap;
    gap: var(--space-1);
  }

  .header-actions .btn {
    font-size: var(--text-sm);
    padding: var(--space-1) var(--space-2);
  }

  /* 작업 모드 바 */
  .work-mode-bar {
    flex-direction: column;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
  }

  .work-mode-label {
    display: none;
  }

  .work-mode-buttons {
    width: 100%;
    justify-content: center;
  }

  .work-mode-btn {
    flex: 1;
    padding: var(--space-1);
    font-size: var(--text-xs);
  }

  .work-mode-btn .mode-name {
    display: none;
  }

  .translate-toggle {
    margin-left: 0;
    width: 100%;
    justify-content: center;
  }

  /* 메인 레이아웃 */
  .main {
    padding: var(--space-2);
    padding-bottom: 80px; /* 하단 네비게이션 공간 */
  }

  .main-3col {
    padding: var(--space-2);
    padding-bottom: 80px;
  }

  /* 패널 숨김 (모바일 네비게이션으로 전환) */
  .main-3col > .panel {
    display: none;
  }

  .main-3col > .panel.mobile-active {
    display: block;
  }

  .panel-header {
    padding: var(--space-2);
    font-size: var(--text-sm);
  }

  .panel-body {
    padding: var(--space-2);
  }

  /* 템플릿 탭 */
  .template-tabs {
    flex-wrap: wrap;
    justify-content: flex-start;
    gap: var(--space-1);
    padding: var(--space-1);
  }

  .template-tab {
    padding: var(--space-1) var(--space-2);
    font-size: var(--text-xs);
  }

  .template-tab .icon {
    margin-right: 2px;
  }

  /* 폼 요소 */
  .form-group {
    margin-bottom: var(--space-2);
  }

  .form-label {
    font-size: var(--text-sm);
  }

  .form-input,
  .form-textarea,
  .form-select {
    font-size: var(--text-base); /* 16px to prevent zoom on iOS */
    padding: var(--space-2);
  }

  /* 액션 바 */
  .action-bar {
    flex-direction: column;
    gap: var(--space-2);
  }

  .action-bar .btn {
    width: 100%;
  }

  /* 결과 영역 */
  .result-container {
    min-height: 200px;
  }

  .result-placeholder {
    padding: var(--space-6);
  }

  /* 편집 세션 */
  .edit-session {
    padding: var(--space-2);
  }

  .quick-presets {
    padding: var(--space-2);
  }

  .preset-categories {
    flex-wrap: wrap;
  }

  .preset-items {
    grid-template-columns: repeat(2, 1fr);
  }

  /* 모달 */
  .modal {
    width: 95%;
    max-height: 90vh;
    margin: var(--space-4);
  }

  .modal-lg,
  .modal-xl {
    width: 95%;
  }

  .modal-header {
    padding: var(--space-2) var(--space-4);
  }

  .modal-body {
    padding: var(--space-4);
    max-height: 60vh;
    overflow-y: auto;
  }

  .modal-footer {
    padding: var(--space-2) var(--space-4);
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .modal-footer .btn {
    flex: 1;
    min-width: 100px;
  }

  /* 이미지 모달 */
  .image-modal-content {
    padding: var(--space-2);
  }

  .image-modal-img {
    max-height: 60vh;
  }

  .image-modal-nav {
    padding: var(--space-2);
    font-size: var(--text-lg);
  }

  .image-modal-actions {
    flex-direction: column;
    gap: var(--space-2);
  }

  .image-modal-actions .btn {
    width: 100%;
  }
}

/* 하단 모바일 네비게이션 */
.mobile-nav {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: var(--color-bg-secondary);
  border-top: 1px solid var(--color-border);
  padding: var(--space-2);
  z-index: var(--z-sticky);
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.5);
}

.mobile-nav-inner {
  display: flex;
  justify-content: space-around;
  align-items: center;
  max-width: 400px;
  margin: 0 auto;
}

.mobile-nav-btn {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: var(--space-2);
  background: transparent;
  border: none;
  border-radius: var(--radius-md);
  color: var(--color-text-secondary);
  font-size: var(--text-xs);
  cursor: pointer;
  transition: all 0.15s ease;
}

.mobile-nav-btn .nav-icon {
  font-size: 1.5rem;
}

.mobile-nav-btn.active {
  color: var(--color-primary);
  background: var(--color-primary-soft);
}

.mobile-nav-btn:hover {
  background: var(--color-bg-hover);
  color: var(--color-text-primary);
}

@media (max-width: 767px) {
  .mobile-nav {
    display: block;
  }
}

/* 스와이프 힌트 */
.swipe-hint {
  display: none;
  text-align: center;
  padding: var(--space-2);
  color: var(--color-text-muted);
  font-size: var(--text-xs);
}

@media (max-width: 767px) {
  .swipe-hint {
    display: block;
  }
}


/* ===== utilities.css ===== */
/* ===== 유틸리티 - Cyberpunk Dark Theme ===== */

/* 가시성 */
.hidden {
  display: none !important;
}

.invisible {
  visibility: hidden;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* 텍스트 정렬 */
.text-center {
  text-align: center;
}

.text-left {
  text-align: left;
}

.text-right {
  text-align: right;
}

/* 텍스트 색상 */
.text-primary {
  color: var(--color-primary);
}

.text-secondary {
  color: var(--color-text-secondary);
}

.text-muted {
  color: var(--color-text-muted);
}

.text-success {
  color: var(--color-success);
}

.text-warning {
  color: var(--color-warning);
}

.text-error {
  color: var(--color-error);
}

/* 마진 유틸리티 */
.mt-0 { margin-top: 0; }
.mt-1 { margin-top: var(--space-1); }
.mt-2 { margin-top: var(--space-2); }
.mt-3 { margin-top: var(--space-3); }
.mt-4 { margin-top: var(--space-4); }
.mt-md { margin-top: var(--space-4); }

.mb-0 { margin-bottom: 0; }
.mb-1 { margin-bottom: var(--space-1); }
.mb-2 { margin-bottom: var(--space-2); }
.mb-3 { margin-bottom: var(--space-3); }
.mb-4 { margin-bottom: var(--space-4); }
.mb-md { margin-bottom: var(--space-4); }

.ml-auto { margin-left: auto; }
.mr-auto { margin-right: auto; }
.mx-auto { margin-left: auto; margin-right: auto; }

/* 패딩 유틸리티 */
.p-0 { padding: 0; }
.p-1 { padding: var(--space-1); }
.p-2 { padding: var(--space-2); }
.p-3 { padding: var(--space-3); }
.p-4 { padding: var(--space-4); }

/* 플렉스 유틸리티 */
.flex {
  display: flex;
}

.flex-col {
  flex-direction: column;
}

.items-center {
  align-items: center;
}

.justify-center {
  justify-content: center;
}

.justify-between {
  justify-content: space-between;
}

.gap-1 { gap: var(--space-1); }
.gap-2 { gap: var(--space-2); }
.gap-3 { gap: var(--space-3); }
.gap-4 { gap: var(--space-4); }

/* 크기 */
.w-full {
  width: 100%;
}

.h-full {
  height: 100%;
}

/* 오버플로우 */
.overflow-hidden {
  overflow: hidden;
}

.overflow-auto {
  overflow: auto;
}

/* 커서 */
.cursor-pointer {
  cursor: pointer;
}

.cursor-not-allowed {
  cursor: not-allowed;
}

/* 투명도 */
.opacity-50 {
  opacity: 0.5;
}

.opacity-75 {
  opacity: 0.75;
}

/* ===== 애니메이션 ===== */

/* Fade In */
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.animate-fadeIn {
  animation: fadeIn 0.3s ease-out;
}

/* Fade In Up */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fadeInUp {
  animation: fadeInUp 0.3s ease-out;
}

/* Slide In */
@keyframes slideIn {
  from {
    transform: translateX(-100%);
  }
  to {
    transform: translateX(0);
  }
}

.animate-slideIn {
  animation: slideIn 0.3s ease-out;
}

/* Pulse */
@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

.animate-pulse {
  animation: pulse 2s ease-in-out infinite;
}

/* Spin */
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.animate-spin {
  animation: spin 1s linear infinite;
}

/* Shimmer (로딩 효과) */
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.animate-shimmer {
  background: linear-gradient(
    90deg,
    var(--color-bg-tertiary) 25%,
    var(--color-bg-hover) 50%,
    var(--color-bg-tertiary) 75%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

/* Glow Pulse (Primary 색상 글로우) */
@keyframes glowPulse {
  0%, 100% {
    box-shadow: 0 0 5px var(--color-primary-glow);
  }
  50% {
    box-shadow: 0 0 20px var(--color-primary-glow);
  }
}

.animate-glow {
  animation: glowPulse 2s ease-in-out infinite;
}

/* Bounce */
@keyframes bounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-5px);
  }
}

.animate-bounce {
  animation: bounce 1s ease-in-out infinite;
}

/* ===== 트랜지션 ===== */
.transition-all {
  transition: all 0.15s ease;
}

.transition-colors {
  transition: color 0.15s ease, background-color 0.15s ease, border-color 0.15s ease;
}

.transition-transform {
  transition: transform 0.15s ease;
}

.transition-opacity {
  transition: opacity 0.15s ease;
}

/* ===== 호버 효과 ===== */
.hover-lift:hover {
  transform: translateY(-2px);
}

.hover-scale:hover {
  transform: scale(1.02);
}

.hover-glow:hover {
  box-shadow: var(--shadow-glow-primary);
}

  </style>
</head>
<body>
<!-- 스킵 네비게이션 -->
  <a href="#templateForm" class="skip-link">메인 콘텐츠로 건너뛰기</a>

  <div id="app" role="application" aria-label="나노 바나나 프롬프트 어시스턴트">
    <!-- 헤더 -->
    <header class="header">
      <h1 class="header-title">
        <span>🍌</span>
        <span>나노 바나나 프롬프트 어시스턴트</span>
      </h1>
      <div class="header-actions">
        <!-- 언어 토글 버튼 -->
        <button id="localeToggle" class="btn btn-outline btn-icon" onclick="toggleLocale()" title="언어 전환 / Switch Language">
          <span id="localeIcon">🇰🇷</span>
        </button>
        <!-- Thinking 모드 토글 -->
        <div class="thinking-tooltip">
          <label id="thinkingToggle" class="thinking-toggle" onclick="toggleThinkingMode()">
            <input type="checkbox" id="thinkingCheckbox">
            <span class="thinking-toggle-switch"></span>
            <span class="thinking-toggle-label">🧠 Thinking</span>
          </label>
          <div class="tooltip-content">
            <strong>Thinking 모드</strong><br>
            AI가 이미지 생성 전 논리적 검토를 수행합니다.<br><br>
            <strong>권장 상황:</strong><br>
            • 다중 요소가 있는 복잡한 장면<br>
            • 정확한 텍스트 렌더링<br>
            • 물리적 정확성이 중요한 이미지<br>
            • 여러 이미지의 일관성 유지
          </div>
        </div>
        <div id="apiStatus" class="api-status disconnected">
          <span class="status-dot"></span>
          <span id="apiStatusText">API 미연결</span>
        </div>
        <button class="btn btn-outline btn-icon" onclick="openHelp()" title="도움말 (Shift+?)">
          ❓
        </button>
        <button class="btn btn-secondary" onclick="openSettingsModal()">
          <span>⚙️</span>
          <span>API 설정</span>
        </button>
      </div>
    </header>

    <!-- 작업 모드 바 -->
    <div class="work-mode-bar">
      <span class="work-mode-label">작업 모드:</span>
      <div class="work-mode-buttons" id="workModeButtons">
        <button class="work-mode-btn active" data-mode="explore" onclick="setWorkMode('explore')">
          <span class="mode-icon">🔍</span>
          <span class="mode-name">탐색</span>
          <span class="mode-size">512px</span>
        </button>
        <button class="work-mode-btn" data-mode="refine" onclick="setWorkMode('refine')">
          <span class="mode-icon">✨</span>
          <span class="mode-name">정제</span>
          <span class="mode-size">1024px</span>
        </button>
        <button class="work-mode-btn" data-mode="final" onclick="setWorkMode('final')">
          <span class="mode-icon">📸</span>
          <span class="mode-name">최종</span>
          <span class="mode-size">원본</span>
        </button>
      </div>
      <label class="translate-toggle">
        <input type="checkbox" id="translateToggle" onchange="handleTranslateToggle(this.checked)">
        <span>🌐 한글→영어 자동 번역</span>
      </label>
    </div>

    <!-- 메인 (3열 레이아웃) -->
    <main class="main-3col">
      <!-- 첨부 이미지 패널 -->
      <div class="panel">
        <div class="panel-header">
          <span>📎</span>
          <span>첨부 이미지</span>
          <span style="margin-left: auto; font-size: var(--font-size-xs); color: var(--color-text-muted);">
            (<span id="attachedCount">0</span>/14)
          </span>
        </div>
        <div class="panel-body">
          <!-- 업로드 영역 -->
          <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
            <div class="upload-area-icon">📤</div>
            <div class="upload-area-text">이미지를 드래그하거나<br>클릭하여 업로드</div>
            <div class="upload-area-hint">PNG, JPG, WEBP (최대 14개)</div>
          </div>
          <input type="file" id="fileInput" multiple accept="image/*" style="display: none;" onchange="handleFileSelect(event)">

          <!-- 썸네일 그리드 -->
          <div class="thumbnail-grid" id="thumbnailGrid">
            <!-- JavaScript로 렌더링 -->
          </div>

          <!-- 선택된 이미지 정보 -->
          <div class="selected-image-info hidden" id="selectedImageInfo">
            <img class="selected-image-preview" id="selectedImagePreview" src="" alt="선택된 이미지">
            <div class="selected-image-meta" id="selectedImageMeta">
              <!-- JavaScript로 렌더링 -->
            </div>
            <div class="selected-image-actions">
              <button class="btn btn-outline btn-sm" onclick="viewOriginalImage()">🔍 원본 보기</button>
              <button class="btn btn-outline btn-sm" onclick="deleteSelectedImage()">🗑️ 삭제</button>
            </div>
          </div>

          <!-- 빈 캔버스 생성 버튼 -->
          <div class="canvas-generator-btn-container">
            <button class="btn btn-outline" onclick="openCanvasGenerator()">
              📐 빈 캔버스 생성
            </button>
          </div>
        </div>
      </div>

      <!-- 프롬프트 빌더 패널 -->
      <div class="panel">
        <!-- 템플릿 탭 -->
        <div class="template-tabs" id="templateTabs" role="tablist" aria-label="프롬프트 템플릿 선택">
          <!-- JavaScript로 렌더링 -->
        </div>

        <!-- 폼 영역 -->
        <div class="panel-body">
          <div id="templateForm">
            <!-- JavaScript로 렌더링 -->
          </div>

          <!-- 프롬프트 미리보기 -->
          <div class="prompt-preview">
            <div class="prompt-preview-header">
              <span class="prompt-preview-title">📝 프롬프트 미리보기</span>
              <div class="prompt-tabs" id="promptTabs">
                <button class="prompt-tab active" data-tab="original" onclick="setPromptTab('original')">원본</button>
                <button class="prompt-tab" data-tab="translated" onclick="setPromptTab('translated')">번역</button>
              </div>
              <button class="btn btn-outline btn-icon" onclick="openPromptHistory()" title="히스토리">
                📜
              </button>
              <button class="btn btn-outline btn-icon" onclick="copyPrompt()" title="복사">
                📋
              </button>
            </div>
            <div id="promptPreview" class="prompt-preview-text empty">
              필드를 입력하면 프롬프트가 생성됩니다.
            </div>
            <div id="translateStatus" class="translate-status hidden">
              <span id="translateStatusText"></span>
            </div>
          </div>

          <!-- 에러 메시지 -->
          <div id="errorMessage" class="error-message hidden"></div>

          <!-- 액션 버튼 -->
          <div class="action-bar">
            <button class="btn btn-outline" onclick="resetForm()">
              🔄 초기화
            </button>
            <button class="btn btn-accent btn-lg" onclick="generateImage()" id="generateBtn" aria-label="AI로 이미지 생성">
              🎨 이미지 생성
            </button>
          </div>
        </div>
      </div>

      <!-- 결과 패널 -->
      <div class="panel">
        <div class="panel-header">
          <span>🖼️</span>
          <span>생성 결과</span>
        </div>
        <div class="panel-body">
          <!-- 편집 세션 UI -->
          <div class="edit-session hidden" id="editSession">
            <div class="edit-session-header">
              <div class="edit-session-title">
                <span>🔄</span>
                <span>편집 세션</span>
              </div>
              <div class="edit-session-actions">
                <button class="btn btn-outline btn-icon" onclick="saveEditSession()" title="세션 저장">💾</button>
                <button class="btn btn-outline btn-icon" onclick="loadEditSession()" title="세션 불러오기">📂</button>
                <button class="btn btn-outline btn-icon" onclick="startNewSession()" title="새 세션">🔄</button>
              </div>
            </div>

            <!-- 편집 히스토리 -->
            <div class="edit-history" id="editHistory">
              <!-- JavaScript로 렌더링 -->
            </div>

            <!-- 수정 요청 입력 -->
            <div class="edit-request">
              <textarea
                class="edit-request-input"
                id="editRequestInput"
                placeholder="이전 결과를 기반으로 수정할 내용을 입력하세요..."
              ></textarea>
              <div class="edit-request-actions">
                <button class="btn btn-outline" onclick="clearEditRequest()">지우기</button>
                <button class="btn btn-accent" onclick="applyEditRequest()" id="applyEditBtn">✨ 수정 적용</button>
              </div>
            </div>

            <!-- 빠른 수정 프리셋 -->
            <div class="quick-presets">
              <div class="quick-presets-title">⚡ 빠른 수정</div>
              <div class="preset-categories" id="presetCategories">
                <!-- JavaScript로 렌더링 -->
              </div>
              <div class="preset-items" id="presetItems">
                <!-- JavaScript로 렌더링 -->
              </div>
            </div>
          </div>

          <!-- 히스토리 썸네일 -->
          <div class="result-history hidden" id="resultHistory">
            <!-- JavaScript로 렌더링 -->
          </div>

          <div id="resultContainer" class="result-container">
            <div class="result-placeholder">
              <div class="result-placeholder-icon">🎨</div>
              <div>프롬프트를 입력하고<br>이미지를 생성하세요</div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- 이미지 확대 모달 -->
    <div id="imageModal" class="image-modal-overlay">
      <div class="image-modal-content">
        <button class="image-modal-close" onclick="closeImageModal()">&times;</button>
        <button class="image-modal-nav prev" onclick="navigateImageModal(-1)">◀</button>
        <img class="image-modal-img" id="imageModalImg" src="" alt="확대 이미지">
        <button class="image-modal-nav next" onclick="navigateImageModal(1)">▶</button>
        <div class="image-modal-actions">
          <button class="btn btn-primary" onclick="downloadModalImage()">💾 다운로드</button>
          <button class="btn btn-secondary" onclick="reusePrompt()">✏️ 재편집</button>
        </div>
        <div class="image-modal-info" id="imageModalInfo"></div>
      </div>
    </div>

    <!-- API 설정 모달 -->
    <div id="settingsModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title" id="settingsModalTitle">⚙️ API 설정</h2>
          <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Gemini API Key</label>
            <div class="input-group">
              <input
                type="password"
                id="apiKeyInput"
                class="form-input"
                placeholder="API 키를 입력하세요"
              >
              <button class="btn btn-outline btn-icon" onclick="toggleApiKeyVisibility()" title="보기/숨기기">
                👁
              </button>
            </div>
            <p class="form-help">
              API 키는 브라우저 로컬 스토리지에 저장됩니다.
              <a href="https://aistudio.google.com/app/apikey" target="_blank">API 키 발급받기</a>
            </p>
          </div>

          <div id="apiTestResult"></div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="testApiConnection()" id="testApiBtn">
            🔗 연결 테스트
          </button>
          <button class="btn btn-primary" onclick="saveApiKey()">
            💾 저장
          </button>
        </div>
      </div>
    </div>

    <!-- 프롬프트 히스토리 모달 -->
    <div id="promptHistoryModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="promptHistoryTitle">
      <div class="modal modal-lg">
        <div class="modal-header">
          <h2 class="modal-title" id="promptHistoryTitle">📜 프롬프트 히스토리</h2>
          <button class="modal-close" onclick="closePromptHistory()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="history-search">
            <input type="text" id="promptHistorySearch" class="form-input"
                   placeholder="프롬프트 검색..."
                   oninput="searchPromptHistory(this.value)">
          </div>
          <div id="promptHistoryList" class="prompt-history-list">
            <!-- JavaScript로 렌더링 -->
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline btn-danger" onclick="clearAllPromptHistory()">
            🗑️ 전체 삭제
          </button>
          <button class="btn btn-outline" onclick="closePromptHistory()">닫기</button>
        </div>
      </div>
    </div>

    <!-- 캔버스 생성기 모달 -->
    <div id="canvasGeneratorModal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">📐 빈 캔버스 생성</h2>
          <button class="modal-close" onclick="closeCanvasGenerator()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">종횡비 선택</label>
            <div id="aspectRatioButtons" class="aspect-ratio-grid">
              <!-- JavaScript로 렌더링 -->
            </div>
          </div>

          <div class="form-group canvas-size-inputs">
            <label class="form-label">크기</label>
            <div class="size-input-row">
              <div class="size-input-group">
                <label>너비</label>
                <input type="number" id="canvasWidth" class="form-input"
                       value="1024" min="100" max="4096"
                       onchange="setCanvasCustomSize(this.value, document.getElementById('canvasHeight').value)">
              </div>
              <span class="size-separator">×</span>
              <div class="size-input-group">
                <label>높이</label>
                <input type="number" id="canvasHeight" class="form-input"
                       value="1024" min="100" max="4096"
                       onchange="setCanvasCustomSize(document.getElementById('canvasWidth').value, this.value)">
              </div>
              <span class="size-unit">px</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">기준 크기 (긴 쪽)</label>
            <select id="canvasBaseSize" class="form-select" onchange="setCanvasBaseSize(this.value)">
              <option value="512">512px</option>
              <option value="768">768px</option>
              <option value="1024" selected>1024px</option>
              <option value="1536">1536px</option>
              <option value="2048">2048px</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">배경색</label>
            <div class="background-options">
              <label class="background-option">
                <input type="radio" name="bgType" value="white" checked
                       onchange="setCanvasBackgroundType('white')">
                <span class="bg-preview bg-white"></span>
                <span>흰색</span>
              </label>
              <label class="background-option">
                <input type="radio" name="bgType" value="transparent"
                       onchange="setCanvasBackgroundType('transparent')">
                <span class="bg-preview bg-transparent"></span>
                <span>투명</span>
              </label>
              <label class="background-option">
                <input type="radio" name="bgType" value="custom"
                       onchange="setCanvasBackgroundType('custom')">
                <input type="color" id="canvasBgColor" value="#FFFFFF"
                       onchange="setCanvasBackgroundColor(this.value)">
                <span>커스텀</span>
              </label>
            </div>
          </div>

          <div class="canvas-preview-container">
            <canvas id="canvasPreview" width="200" height="200"></canvas>
            <div id="canvasInfo" class="canvas-info">1024 × 1024px</div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="closeCanvasGenerator()">취소</button>
          <button class="btn btn-primary" onclick="generateAndAttachCanvas()">
            ✅ 캔버스 생성 및 첨부
          </button>
        </div>
      </div>
    </div>

    <!-- 템플릿 에디터 모달 -->
    <div id="templateEditorModal" class="modal-overlay">
      <div class="modal modal-xl">
        <div class="modal-header">
          <h2 class="modal-title">📝 템플릿 편집기</h2>
          <button class="modal-close" onclick="closeTemplateEditor()">&times;</button>
        </div>
        <div class="modal-body template-editor-body">
          <div class="editor-section">
            <h3>기본 정보</h3>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">템플릿 이름 <span class="required">*</span></label>
                <input type="text" id="templateName" class="form-input" placeholder="예: 내 제품 사진 템플릿">
              </div>
              <div class="form-group form-group-sm">
                <label class="form-label">아이콘</label>
                <input type="text" id="templateIcon" class="form-input" value="🎨" maxlength="2">
              </div>
              <div class="form-group">
                <label class="form-label">카테고리</label>
                <select id="templateCategory" class="form-select">
                  <option value="custom">커스텀</option>
                  <option value="basic">기본</option>
                  <option value="typography">타이포그래피</option>
                  <option value="artwork">아트워크</option>
                  <option value="professional">전문</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">설명</label>
              <input type="text" id="templateDescription" class="form-input" placeholder="템플릿에 대한 간단한 설명">
            </div>
          </div>

          <div class="editor-section">
            <div class="editor-section-header">
              <h3>필드</h3>
              <button class="btn btn-primary btn-sm" onclick="addEditorField()">➕ 필드 추가</button>
            </div>
            <div id="templateFieldsEditor" class="template-fields-editor">
              <div class="empty-fields-message">필드가 없습니다. "필드 추가" 버튼을 클릭하세요.</div>
            </div>
          </div>

          <div class="editor-section">
            <h3>프롬프트 템플릿</h3>
            <p class="form-help">필드 값을 삽입하려면 {필드ID}를 사용하세요. 아래 버튼을 클릭하면 자동 삽입됩니다.</p>
            <div class="field-placeholders" id="fieldPlaceholders">
              <!-- JavaScript로 필드 버튼 렌더링 -->
            </div>
            <textarea id="templatePrompt" class="form-textarea" rows="6"
                      placeholder="Create a {style} image of {subject}..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="importTemplate()">📥 가져오기</button>
          <button class="btn btn-outline" onclick="closeTemplateEditor()">취소</button>
          <button class="btn btn-primary" onclick="saveTemplate()">💾 저장</button>
        </div>
      </div>
    </div>
  </div>

    <!-- 도움말 모달 -->
    <div id="helpModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
      <div class="modal modal-lg">
        <div class="modal-header">
          <h2 class="modal-title" id="helpModalTitle">❓ 도움말</h2>
          <button class="modal-close" onclick="closeHelp()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="help-tabs">
            <button class="help-tab active" data-tab="overview" onclick="setHelpTab('overview')">개요</button>
            <button class="help-tab" data-tab="templates" onclick="setHelpTab('templates')">템플릿</button>
            <button class="help-tab" data-tab="shortcuts" onclick="setHelpTab('shortcuts')">단축키</button>
            <button class="help-tab" data-tab="tips" onclick="setHelpTab('tips')">팁</button>
            <button class="help-tab" data-tab="faq" onclick="setHelpTab('faq')">FAQ</button>
          </div>
          <div class="help-content" id="helpContent">
            <!-- JavaScript로 렌더링 -->
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="closeHelp()">닫기</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 모바일 하단 네비게이션 -->
  <nav class="mobile-nav" id="mobileNav">
    <div class="mobile-nav-inner">
      <button class="mobile-nav-btn" data-panel="attach" onclick="setActivePanel('attach')">
        <span class="nav-icon">📎</span>
        <span>첨부</span>
      </button>
      <button class="mobile-nav-btn active" data-panel="builder" onclick="setActivePanel('builder')">
        <span class="nav-icon">✏️</span>
        <span>빌더</span>
      </button>
      <button class="mobile-nav-btn" data-panel="result" onclick="setActivePanel('result')">
        <span class="nav-icon">🖼️</span>
        <span>결과</span>
      </button>
    </div>
  </nav>

  <!-- ES Module 진입점 -->

  <script>
// ===== 나노 바나나 프롬프트 어시스턴트 =====
// 빌드: 2025-12-24T04:55:14.132Z
(() => {
  // src/js/templates.js
  var TEMPLATES = {
    basic: {
      id: "basic",
      name: "\uAE30\uBCF8 \uD504\uB86C\uD504\uD2B8",
      icon: "\u{1F3A8}",
      category: "basic",
      description: "Google \uACF5\uC2DD 6\uC694\uC18C \uACF5\uC2DD \uAE30\uBC18",
      fields: [
        {
          id: "subject",
          label: "\uC8FC\uC81C (Subject)",
          type: "textarea",
          placeholder: "\uC608: \uD30C\uB780\uC0C9 \uBC1C\uAD11 \uAD11\uD559\uAE30\uB97C \uAC00\uC9C4 \uAE08\uC695\uC801\uC778 \uB85C\uBD07 \uBC14\uB9AC\uC2A4\uD0C0",
          required: true,
          helpText: '\uAD6C\uCCB4\uC801\uC73C\uB85C \uC791\uC131\uD558\uC138\uC694. "\uB85C\uBD07"\uBCF4\uB2E4 "\uD30C\uB780 \uBC1C\uAD11 \uAD11\uD559\uAE30\uB97C \uAC00\uC9C4 \uB85C\uBD07 \uBC14\uB9AC\uC2A4\uD0C0"\uAC00 \uC88B\uC2B5\uB2C8\uB2E4.'
        },
        {
          id: "composition",
          label: "\uAD6C\uC131 (Composition)",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "extreme close-up", label: "\uC775\uC2A4\uD2B8\uB9BC \uD074\uB85C\uC988\uC5C5" },
            { value: "close-up", label: "\uD074\uB85C\uC988\uC5C5" },
            { value: "medium shot", label: "\uBBF8\uB514\uC5C4 \uC0F7" },
            { value: "wide shot", label: "\uC640\uC774\uB4DC \uC0F7" },
            { value: "establishing shot", label: "\uC804\uCCB4 \uC0F7" },
            { value: "birds eye view", label: "\uBC84\uB4DC \uC544\uC774 \uBDF0" },
            { value: "worms eye view", label: "\uC6DC\uC988 \uC544\uC774 \uBDF0" }
          ]
        },
        {
          id: "action",
          label: "\uC561\uC158 (Action)",
          type: "text",
          placeholder: "\uC608: \uCEE4\uD53C\uB97C \uB0B4\uB9AC\uACE0 \uC788\uB294, \uB2EC\uB9AC\uB294 \uC911\uC778"
        },
        {
          id: "location",
          label: "\uC704\uCE58 (Location)",
          type: "text",
          placeholder: "\uC608: \uD654\uC131\uC758 \uBBF8\uB798\uD615 \uCE74\uD398\uC5D0\uC11C"
        },
        {
          id: "style",
          label: "\uC2A4\uD0C0\uC77C (Style)",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "photorealistic", label: "\uD3EC\uD1A0\uB9AC\uC5BC\uB9AC\uC2A4\uD2F1" },
            { value: "3D animation", label: "3D \uC560\uB2C8\uBA54\uC774\uC158" },
            { value: "watercolor painting", label: "\uC218\uCC44\uD654" },
            { value: "oil painting", label: "\uC720\uD654" },
            { value: "pencil sketch", label: "\uC5F0\uD544 \uC2A4\uCF00\uCE58" },
            { value: "digital art", label: "\uB514\uC9C0\uD138 \uC544\uD2B8" },
            { value: "vintage photograph", label: "\uBE48\uD2F0\uC9C0 \uC0AC\uC9C4" }
          ]
        },
        {
          id: "lighting",
          label: "\uC870\uBA85",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "golden hour sunlight", label: "\uACE8\uB4E0\uC544\uC6CC" },
            { value: "soft diffused light", label: "\uC18C\uD504\uD2B8 \uB514\uD4E8\uC988\uB4DC" },
            { value: "dramatic chiaroscuro", label: "\uBA85\uC554\uBC95 (Chiaroscuro)" },
            { value: "neon lighting", label: "\uB124\uC628 \uC870\uBA85" },
            { value: "studio three-point lighting", label: "\uC2A4\uD29C\uB514\uC624 3\uC810 \uC870\uBA85" },
            { value: "Rembrandt lighting", label: "\uB818\uBE0C\uB780\uD2B8 \uC870\uBA85" }
          ]
        },
        {
          id: "additional",
          label: "\uCD94\uAC00 \uC9C0\uC2DC\uC0AC\uD56D",
          type: "textarea",
          placeholder: "\uC0C9\uC0C1 \uD314\uB808\uD2B8, \uBD84\uC704\uAE30, \uAE30\uD0C0 \uC138\uBD80\uC0AC\uD56D..."
        }
      ],
      promptTemplate: "Create a {style} image of {subject}{action}{location}. {composition}. {lighting}. {additional}"
    },
    photo: {
      id: "photo",
      name: "\uD3EC\uD1A0\uB9AC\uC5BC\uB9AC\uC2A4\uD2F1",
      icon: "\u{1F4F7}",
      category: "basic",
      description: "\uC0AC\uC9C4 \uC2A4\uD0C0\uC77C \uC774\uBBF8\uC9C0 \uC0DD\uC131",
      fields: [
        {
          id: "subject",
          label: "\uD53C\uC0AC\uCCB4",
          type: "textarea",
          placeholder: "\uC608: \uC11D\uC591\uC744 \uBC14\uB77C\uBCF4\uB294 \uC80A\uC740 \uC5EC\uC131",
          required: true
        },
        {
          id: "camera",
          label: "\uCE74\uBA54\uB77C",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "Canon EOS R5", label: "Canon EOS R5" },
            { value: "Sony A7R V", label: "Sony A7R V" },
            { value: "Nikon Z9", label: "Nikon Z9" },
            { value: "Hasselblad H6D", label: "Hasselblad H6D" }
          ]
        },
        {
          id: "lens",
          label: "\uB80C\uC988",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "85mm f/1.4", label: "85mm f/1.4 (\uC778\uBB3C)" },
            { value: "35mm f/1.4", label: "35mm f/1.4 (\uD658\uACBD \uC778\uBB3C)" },
            { value: "24-70mm f/2.8", label: "24-70mm f/2.8 (\uBC94\uC6A9)" },
            { value: "70-200mm f/2.8", label: "70-200mm f/2.8 (\uB9DD\uC6D0)" },
            { value: "100mm macro", label: "100mm \uB9E4\uD06C\uB85C" }
          ]
        },
        {
          id: "aperture",
          label: "\uC870\uB9AC\uAC1C",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "f/1.4", label: "f/1.4 (\uADF9\uC595\uC740 \uC2EC\uB3C4)" },
            { value: "f/2.8", label: "f/2.8 (\uC595\uC740 \uC2EC\uB3C4)" },
            { value: "f/5.6", label: "f/5.6 (\uC911\uAC04)" },
            { value: "f/8", label: "f/8 (\uC120\uBA85)" },
            { value: "f/11", label: "f/11 (\uD48D\uACBD)" }
          ]
        },
        {
          id: "lighting",
          label: "\uC870\uBA85",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "golden hour sunlight", label: "\uACE8\uB4E0\uC544\uC6CC" },
            { value: "soft window light", label: "\uCC3D\uBB38 \uC790\uC5F0\uAD11" },
            { value: "overcast diffused", label: "\uD750\uB9B0 \uB0A0 \uD655\uC0B0\uAD11" },
            { value: "Rembrandt lighting", label: "\uB818\uBE0C\uB780\uD2B8 \uC870\uBA85" },
            { value: "rim light", label: "\uB9BC \uB77C\uC774\uD2B8" },
            { value: "three-point studio", label: "3\uC810 \uC2A4\uD29C\uB514\uC624 \uC870\uBA85" }
          ]
        },
        {
          id: "filmStock",
          label: "\uD544\uB984/\uC0C9\uAC10",
          type: "select",
          options: [
            { value: "", label: "\uAE30\uBCF8 \uB514\uC9C0\uD138" },
            { value: "Kodachrome 64 color science", label: "Kodachrome 64" },
            { value: "Fujifilm Velvia saturated", label: "Fujifilm Velvia" },
            { value: "Cinestill 800T", label: "Cinestill 800T" },
            { value: "vintage Polaroid", label: "\uBE48\uD2F0\uC9C0 \uD3F4\uB77C\uB85C\uC774\uB4DC" }
          ]
        },
        {
          id: "depthOfField",
          label: "\uD53C\uC0AC\uACC4 \uC2EC\uB3C4",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "shallow depth of field with creamy bokeh", label: "\uC595\uC740 \uC2EC\uB3C4, \uD06C\uB9AC\uBBF8 \uBCF4\uCF00" },
            { value: "sharp focus throughout", label: "\uC804\uCCB4 \uC120\uBA85" },
            { value: "selective focus on subject", label: "\uD53C\uC0AC\uCCB4\uB9CC \uC120\uBA85" }
          ]
        },
        {
          id: "additional",
          label: "\uCD94\uAC00 \uC9C0\uC2DC\uC0AC\uD56D",
          type: "textarea",
          placeholder: "\uBD84\uC704\uAE30, \uC0C9\uC870, \uAE30\uD0C0 \uC138\uBD80\uC0AC\uD56D..."
        }
      ],
      promptTemplate: "A photorealistic photograph of {subject}. Captured with {camera}, {lens} lens at {aperture}. {lighting}. {filmStock}. {depthOfField}. {additional}"
    },
    typography: {
      id: "typography",
      name: "\uD0C0\uC774\uD3EC\uADF8\uB798\uD53C",
      icon: "\u270F\uFE0F",
      category: "typography",
      description: "\uD14D\uC2A4\uD2B8\uAC00 \uD3EC\uD568\uB41C \uC774\uBBF8\uC9C0 \uC0DD\uC131",
      fields: [
        {
          id: "text",
          label: "\uD45C\uC2DC\uD560 \uD14D\uC2A4\uD2B8",
          type: "text",
          placeholder: "\uC608: HELLO WORLD",
          required: true,
          helpText: "25\uC790 \uC774\uD558 \uAD8C\uC7A5, 2-3\uAC1C \uBB38\uAD6C\uB85C \uC81C\uD55C\uD558\uBA74 \uC88B\uC2B5\uB2C8\uB2E4."
        },
        {
          id: "fontStyle",
          label: "\uD3F0\uD2B8 \uC2A4\uD0C0\uC77C",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "bold sans-serif", label: "\uAD75\uC740 \uC0B0\uC138\uB9AC\uD504" },
            { value: "elegant serif", label: "\uC6B0\uC544\uD55C \uC138\uB9AC\uD504" },
            { value: "hand-written script", label: "\uC190\uAE00\uC528 \uD544\uAE30\uCCB4" },
            { value: "retro vintage", label: "\uB808\uD2B8\uB85C \uBE48\uD2F0\uC9C0" },
            { value: "modern minimalist", label: "\uBAA8\uB358 \uBBF8\uB2C8\uBA40\uB9AC\uC2A4\uD2B8" },
            { value: "graffiti style", label: "\uADF8\uB798\uD53C\uD2F0 \uC2A4\uD0C0\uC77C" },
            { value: "neon sign", label: "\uB124\uC628 \uC0AC\uC778" }
          ]
        },
        {
          id: "textColor",
          label: "\uD14D\uC2A4\uD2B8 \uC0C9\uC0C1",
          type: "text",
          placeholder: "\uC608: \uD770\uC0C9, \uAE08\uC0C9, \uADF8\uB77C\uB370\uC774\uC158 \uD30C\uB791-\uBCF4\uB77C"
        },
        {
          id: "placement",
          label: "\uD14D\uC2A4\uD2B8 \uC704\uCE58",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "centered in the image", label: "\uC911\uC559" },
            { value: "at the top", label: "\uC0C1\uB2E8" },
            { value: "at the bottom", label: "\uD558\uB2E8" },
            { value: "diagonal across", label: "\uB300\uAC01\uC120" },
            { value: "curved around subject", label: "\uACE1\uC120\uC73C\uB85C \uBC30\uCE58" }
          ]
        },
        {
          id: "background",
          label: "\uBC30\uACBD",
          type: "text",
          placeholder: "\uC608: \uC5B4\uB450\uC6B4 \uC6B0\uC8FC \uBC30\uACBD, \uD770\uC0C9 \uB300\uB9AC\uC11D, \uB124\uC628 \uB3C4\uC2DC"
        },
        {
          id: "effects",
          label: "\uD6A8\uACFC",
          type: "text",
          placeholder: "\uC608: \uADF8\uB9BC\uC790, \uBE5B \uBC1C\uC0B0, 3D \uC785\uCCB4\uAC10"
        },
        {
          id: "additional",
          label: "\uCD94\uAC00 \uC9C0\uC2DC\uC0AC\uD56D",
          type: "textarea",
          placeholder: "\uAE30\uD0C0 \uC138\uBD80\uC0AC\uD56D..."
        }
      ],
      promptTemplate: 'Create an image with the text "{text}" displayed prominently. Font style: {fontStyle}. Text color: {textColor}. Text placement: {placement}. Background: {background}. Effects: {effects}. {additional}'
    },
    logoGrid: {
      id: "logoGrid",
      name: "8\uAC1C \uB85C\uACE0 \uADF8\uB9AC\uB4DC",
      icon: "\u{1F524}",
      category: "typography",
      description: "\uD55C \uBC88\uC5D0 \uC5EC\uB7EC \uB85C\uACE0 \uBCC0\uD615 \uC0DD\uC131",
      fields: [
        {
          id: "theme",
          label: "\uD14C\uB9C8",
          type: "text",
          placeholder: "\uC608: \uC74C\uC2DD, \uAC10\uC815, \uB3D9\uBB3C",
          required: true
        },
        {
          id: "expressionStyle",
          label: "\uD45C\uD604 \uBC29\uC2DD",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "letters visually express meaning", label: "\uAE00\uC790\uAC00 \uC758\uBBF8\uB97C \uC2DC\uAC01\uC801\uC73C\uB85C \uD45C\uD604" },
            { value: "letters made of actual objects", label: "\uAE00\uC790\uB97C \uC2E4\uC81C \uBB3C\uCCB4\uB85C \uC81C\uC791" },
            { value: "letters with dramatic shadows", label: "\uADF9\uC801\uC778 \uADF8\uB9BC\uC790\uAC00 \uC788\uB294 \uAE00\uC790" }
          ]
        },
        {
          id: "backgroundColor",
          label: "\uBC30\uACBD\uC0C9",
          type: "select",
          options: [
            { value: "white", label: "\uD770\uC0C9" },
            { value: "black", label: "\uAC80\uC740\uC0C9" },
            { value: "gradient gray", label: "\uADF8\uB77C\uB370\uC774\uC158 \uD68C\uC0C9" }
          ]
        },
        {
          id: "renderStyle",
          label: "\uB80C\uB354\uB9C1 \uC2A4\uD0C0\uC77C",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "flat vector black", label: "\uD50C\uB7AB \uBCA1\uD130 \uAC80\uC740\uC0C9" },
            { value: "colorful 3D", label: "\uCEEC\uB7EC\uD480 3D" },
            { value: "minimalist line art", label: "\uBBF8\uB2C8\uBA40 \uB77C\uC778 \uC544\uD2B8" }
          ]
        }
      ],
      promptTemplate: "Create 8 minimalist logos. Each is a word related to {theme}, where {expressionStyle}. Composition: all logos on a single {backgroundColor} background, rendered in {renderStyle} style."
    },
    chiaroscuro: {
      id: "chiaroscuro",
      name: "\uBA85\uC554\uBC95 (Chiaroscuro)",
      icon: "\u{1F313}",
      category: "artwork",
      description: "\uB4DC\uB77C\uB9C8\uD2F1\uD55C \uBA85\uC554 \uB300\uBE44 \uD6A8\uACFC",
      fields: [
        {
          id: "subject",
          label: "\uD53C\uC0AC\uCCB4",
          type: "textarea",
          placeholder: "\uC608: \uC911\uB144 \uB0A8\uC131\uC758 \uCE21\uBA74 \uCD08\uC0C1\uD654",
          required: true
        },
        {
          id: "lightDirection",
          label: "\uC870\uBA85 \uBC29\uD5A5",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "from above and slightly left", label: "\uC704\uC640 \uC57D\uAC04 \uC67C\uCABD\uC5D0\uC11C" },
            { value: "from above and slightly right", label: "\uC704\uC640 \uC57D\uAC04 \uC624\uB978\uCABD\uC5D0\uC11C" },
            { value: "from direct side left", label: "\uC67C\uCABD \uCE21\uBA74\uC5D0\uC11C" },
            { value: "from below (horror style)", label: "\uC544\uB798\uC5D0\uC11C (\uD638\uB7EC \uC2A4\uD0C0\uC77C)" }
          ]
        },
        {
          id: "highlightAreas",
          label: "\uD558\uC774\uB77C\uC774\uD2B8 \uC601\uC5ED",
          type: "text",
          placeholder: "\uC608: \uB208\uACFC \uAD11\uB300\uBF08\uB9CC",
          helpText: "\uBE5B\uC774 \uB2FF\uB294 \uBD80\uBD84\uC744 \uC9C0\uC815"
        },
        {
          id: "shadowIntensity",
          label: "\uADF8\uB9BC\uC790 \uAC15\uB3C4",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "deep and sharp", label: "\uAE4A\uACE0 \uC120\uBA85\uD55C" },
            { value: "soft and gradual", label: "\uBD80\uB4DC\uB7FD\uACE0 \uC810\uC9C4\uC801" },
            { value: "extreme contrast", label: "\uADF9\uB2E8\uC801 \uB300\uBE44" }
          ]
        },
        {
          id: "mood",
          label: "\uBD84\uC704\uAE30",
          type: "text",
          placeholder: "\uC608: \uC2E0\uBE44\uB85C\uC6B4, \uADF9\uC801\uC778, \uACE0\uC804\uC801\uC778"
        }
      ],
      promptTemplate: "Generate intense chiaroscuro effect. Harsh, directional lighting coming {lightDirection}. Cast {shadowIntensity} shadows. Only {highlightAreas} are illuminated by thin lines of light, rest in deep shadow. Subject: {subject}. Mood: {mood}."
    },
    productLifestyle: {
      id: "productLifestyle",
      name: "\uC81C\uD488 \uB77C\uC774\uD504\uC2A4\uD0C0\uC77C",
      icon: "\u{1F4E6}",
      category: "professional",
      description: "\uC81C\uD488\uC744 \uC5EC\uB7EC \uD658\uACBD\uC5D0 \uBC30\uCE58",
      fields: [
        {
          id: "productDescription",
          label: "\uC81C\uD488 \uC124\uBA85",
          type: "textarea",
          placeholder: "\uC608: \uBBF8\uB2C8\uBA40\uD55C \uB514\uC790\uC778\uC758 \uC2A4\uD14C\uC778\uB9AC\uC2A4 \uC2A4\uD2F8 \uD140\uBE14\uB7EC",
          required: true,
          helpText: "\uC81C\uD488\uC758 \uD615\uD0DC, \uC0C9\uC0C1, \uC7AC\uC9C8\uC744 \uC0C1\uC138\uD788 \uC124\uBA85\uD558\uC138\uC694"
        },
        {
          id: "scene1",
          label: "\uC7A5\uBA74 1",
          type: "text",
          placeholder: "\uC608: \uB9E5\uBD81\uACFC \uCEE4\uD53C\uAC00 \uC788\uB294 \uBBF8\uB2C8\uBA40\uD55C \uD648 \uC624\uD53C\uC2A4 \uCC45\uC0C1 \uC704"
        },
        {
          id: "scene2",
          label: "\uC7A5\uBA74 2",
          type: "text",
          placeholder: "\uC608: \uD0C0\uC6D4\uACFC \uBB3C\uBCD1\uC774 \uC788\uB294 \uD5EC\uC2A4\uC7A5 \uAC00\uBC29 \uC548"
        },
        {
          id: "scene3",
          label: "\uC7A5\uBA74 3",
          type: "text",
          placeholder: "\uC608: \uC640\uC778 \uC794\uACFC \uCD1B\uBD88\uC774 \uC788\uB294 \uB808\uC2A4\uD1A0\uB791 \uD14C\uC774\uBE14 \uC704"
        },
        {
          id: "scene4",
          label: "\uC7A5\uBA74 4",
          type: "text",
          placeholder: "\uC608: \uC232 \uB4F1\uC0B0\uB85C\uC758 \uC5F4\uB9B0 \uBC31\uD329 \uC548"
        },
        {
          id: "consistency",
          label: "\uC77C\uAD00\uC131 \uC720\uC9C0 \uD56D\uBAA9",
          type: "checkbox-group",
          options: [
            { value: "same angle", label: "\uAC19\uC740 \uAC01\uB3C4" },
            { value: "same material reflection", label: "\uAC19\uC740 \uC7AC\uC9C8 \uBC18\uC0AC" },
            { value: "same color", label: "\uAC19\uC740 \uC0C9\uC0C1" },
            { value: "same logo position", label: "\uAC19\uC740 \uB85C\uACE0 \uC704\uCE58" }
          ],
          defaultValue: ["same angle", "same material reflection", "same color", "same logo position"]
        },
        {
          id: "lightingStyle",
          label: "\uC870\uBA85 \uC2A4\uD0C0\uC77C",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "natural daylight", label: "\uC790\uC5F0 \uC8FC\uAD11" },
            { value: "soft studio lighting", label: "\uC18C\uD504\uD2B8 \uC2A4\uD29C\uB514\uC624 \uC870\uBA85" },
            { value: "dramatic side lighting", label: "\uB4DC\uB77C\uB9C8\uD2F1 \uC0AC\uC774\uB4DC \uC870\uBA85" },
            { value: "warm golden hour", label: "\uB530\uB73B\uD55C \uACE8\uB4E0\uC544\uC6CC" }
          ]
        }
      ],
      promptTemplate: "Show this product in 4 lifestyle scenes:\n1) {scene1}\n2) {scene2}\n3) {scene3}\n4) {scene4}\n\nProduct: {productDescription}\n\nProduct must remain identical across all images: {consistency}. Only environment, props, and lighting change. Lighting style: {lightingStyle}. Use natural depth of field. Output as 4 separate images optimized for e-commerce."
    },
    // ===== Phase 4 추가 템플릿 =====
    composite: {
      id: "composite",
      name: "\uB2E4\uC911 \uC774\uBBF8\uC9C0 \uD569\uC131",
      icon: "\u{1F9E9}",
      category: "professional",
      description: "\uC5EC\uB7EC \uC774\uBBF8\uC9C0\uB97C \uD558\uB098\uB85C \uD569\uC131",
      fields: [
        {
          id: "aspectRatio",
          label: "\uCD5C\uC885 \uC885\uD6A1\uBE44",
          type: "select",
          options: [
            { value: "16:9", label: "16:9 \uC640\uC774\uB4DC" },
            { value: "1:1", label: "1:1 \uC815\uC0AC\uAC01\uD615" },
            { value: "4:3", label: "4:3 \uAC00\uB85C" },
            { value: "9:16", label: "9:16 \uC138\uB85C" },
            { value: "3:4", label: "3:4 \uC138\uB85C" }
          ],
          required: true
        },
        {
          id: "compositeInstructions",
          label: "\uD569\uC131 \uC9C0\uC2DC\uC0AC\uD56D",
          type: "textarea",
          placeholder: "\uAC01 \uC774\uBBF8\uC9C0\uC758 \uBC30\uCE58 \uC704\uCE58\uC640 \uD06C\uAE30\uB97C \uC124\uBA85\uD558\uC138\uC694.\n\uC608: \uC774\uBBF8\uC9C0 1\uC744 \uC67C\uCABD\uC5D0, \uC774\uBBF8\uC9C0 2\uB97C \uC911\uC559 \uD06C\uAC8C, \uC774\uBBF8\uC9C0 3\uC744 \uC624\uB978\uCABD \uC0C1\uB2E8\uC5D0 \uC791\uAC8C",
          required: true,
          helpText: "\uCCA8\uBD80 \uD328\uB110\uC5D0\uC11C \uC774\uBBF8\uC9C0\uB97C \uBA3C\uC800 \uC5C5\uB85C\uB4DC\uD558\uC138\uC694 (\uCD5C\uB300 14\uAC1C)"
        },
        {
          id: "lightingUnity",
          label: "\uC870\uBA85 \uD1B5\uC77C",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "unified studio lighting from left", label: "\uC67C\uCABD \uC2A4\uD29C\uB514\uC624 \uC870\uBA85" },
            { value: "unified natural daylight", label: "\uC790\uC5F0 \uC8FC\uAD11" },
            { value: "unified soft box at 45 degrees", label: "\uC18C\uD504\uD2B8\uBC15\uC2A4 45\uB3C4" },
            { value: "unified golden hour warm lighting", label: "\uACE8\uB4E0\uC544\uC6CC \uB530\uB73B\uD55C \uC870\uBA85" }
          ]
        },
        {
          id: "shadowDirection",
          label: "\uADF8\uB9BC\uC790 \uBC29\uD5A5",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "consistent shadows to the right", label: "\uC624\uB978\uCABD\uC73C\uB85C \uD1B5\uC77C" },
            { value: "consistent shadows to the left", label: "\uC67C\uCABD\uC73C\uB85C \uD1B5\uC77C" },
            { value: "consistent shadows below", label: "\uC544\uB798\uB85C \uD1B5\uC77C" },
            { value: "soft diffused shadows", label: "\uBD80\uB4DC\uB7FD\uAC8C \uD655\uC0B0" }
          ]
        },
        {
          id: "background",
          label: "\uBC30\uACBD",
          type: "text",
          placeholder: "\uC608: \uADF8\uB77C\uB370\uC774\uC158 \uD68C\uC0C9, \uD770\uC0C9 \uC2A4\uD29C\uB514\uC624, \uB3C4\uC2DC \uC57C\uACBD"
        },
        {
          id: "additional",
          label: "\uCD94\uAC00 \uC9C0\uC2DC\uC0AC\uD56D",
          type: "textarea",
          placeholder: "\uC0C9\uAC10 \uD1B5\uC77C, \uBE14\uB80C\uB529 \uBC29\uC2DD \uB4F1..."
        }
      ],
      promptTemplate: "Composite the uploaded images into a single {aspectRatio} image. {compositeInstructions}. Apply {lightingUnity} with {shadowDirection}. Background: {background}. {additional}"
    },
    magazine: {
      id: "magazine",
      name: "\uB9E4\uAC70\uC9C4 \uCEE4\uBC84",
      icon: "\u{1F4F0}",
      category: "typography",
      description: "\uAD11\uD0DD \uB9E4\uAC70\uC9C4 \uCEE4\uBC84 \uC2A4\uD0C0\uC77C",
      fields: [
        {
          id: "title",
          label: "\uB9E4\uAC70\uC9C4 \uC81C\uBAA9",
          type: "text",
          placeholder: "\uC608: VOGUE, TIME, ELLE",
          required: true,
          helpText: "25\uC790 \uC774\uD558 \uAD8C\uC7A5"
        },
        {
          id: "personDescription",
          label: "\uC778\uBB3C \uC124\uBA85",
          type: "textarea",
          placeholder: "\uC608: \uB179\uC0C9\uACFC \uACE8\uB4DC \uACE0\uAE09 \uD328\uC158\uC744 \uC785\uC740 \uB2E4\uC774\uB098\uBBF9\uD55C \uC778\uBB3C"
        },
        {
          id: "fontStyle",
          label: "\uD3F0\uD2B8 \uC2A4\uD0C0\uC77C",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "bold serif black-white", label: "\uAD75\uC740 \uC138\uB9AC\uD504 \uD751\uBC31" },
            { value: "elegant script gold", label: "\uC6B0\uC544\uD55C \uD544\uAE30\uCCB4 \uACE8\uB4DC" },
            { value: "modern sans-serif white", label: "\uBAA8\uB358 \uC0B0\uC138\uB9AC\uD504 \uD770\uC0C9" },
            { value: "vintage art deco", label: "\uBE48\uD2F0\uC9C0 \uC544\uD2B8\uB370\uCF54" }
          ]
        },
        {
          id: "issueInfo",
          label: "\uBC1C\uD589 \uC815\uBCF4",
          type: "text",
          placeholder: "\uC608: 2025\uB144 12\uC6D4\uD638, $15.99"
        },
        {
          id: "extras",
          label: "\uCD94\uAC00 \uC694\uC18C",
          type: "checkbox-group",
          options: [
            { value: "barcode in corner", label: "\uBC14\uCF54\uB4DC" },
            { value: "issue number displayed", label: "\uBC1C\uD589 \uD638\uC218" },
            { value: "price tag visible", label: "\uAC00\uACA9\uD45C" }
          ]
        }
      ],
      promptTemplate: 'Glossy magazine cover photo. Cover displays "{title}" in large {fontStyle} font filling the top. In front of the text, {personDescription}. Corner includes {issueInfo}. {extras}. Magazine resting on white shelf leaning against wall.'
    },
    quilling: {
      id: "quilling",
      name: "\uD398\uC774\uD37C \uD03C\uB9C1",
      icon: "\u{1F380}",
      category: "artwork",
      description: "\uC885\uC774 \uB760\uB85C \uB9CC\uB4E0 \uC785\uCCB4 \uC544\uD2B8\uC6CC\uD06C",
      fields: [
        {
          id: "text",
          label: "\uD45C\uD604\uD560 \uD14D\uC2A4\uD2B8",
          type: "text",
          placeholder: "\uC608: MAGIC, LOVE, DREAM",
          required: true,
          helpText: "\uC9E7\uC740 \uB2E8\uC5B4 \uAD8C\uC7A5 (1-2\uB2E8\uC5B4)"
        },
        {
          id: "colors",
          label: "\uC885\uC774 \uB760 \uC0C9\uC0C1",
          type: "text",
          placeholder: "\uC608: \uBCF4\uB77C\uC0C9, \uD551\uD06C, \uB9C8\uC820\uD0C0, \uD770\uC0C9",
          helpText: "\uCF64\uB9C8\uB85C \uC5EC\uB7EC \uC0C9\uC0C1 \uAD6C\uBD84"
        },
        {
          id: "backgroundColor",
          label: "\uBC30\uACBD\uC0C9",
          type: "text",
          placeholder: "\uC608: \uC9C4\uD68C\uC0C9, \uD06C\uB9BC\uC0C9, \uAC80\uC740\uC0C9"
        },
        {
          id: "scriptStyle",
          label: "\uAE00\uC528 \uC2A4\uD0C0\uC77C",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "elaborate calligraphy script", label: "\uC815\uAD50\uD55C \uCE98\uB9AC\uADF8\uB798\uD53C" },
            { value: "bold block letters", label: "\uAD75\uC740 \uBE14\uB85D \uAE00\uC790" },
            { value: "flowing cursive", label: "\uD750\uB974\uB294 \uD544\uAE30\uCCB4" },
            { value: "decorative ornamental", label: "\uC7A5\uC2DD\uC801 \uC624\uB108\uBA58\uD0C8" }
          ]
        },
        {
          id: "depth",
          label: "\uC785\uCCB4\uAC10 \uC218\uC900",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "subtle 3D depth", label: "\uC740\uC740\uD55C \uC785\uCCB4\uAC10" },
            { value: "pronounced layered depth", label: "\uB69C\uB837\uD55C \uB808\uC774\uC5B4 \uAE4A\uC774" },
            { value: "extreme sculptural depth", label: "\uADF9\uC801\uC778 \uC870\uAC01\uC801 \uAE4A\uC774" }
          ]
        }
      ],
      promptTemplate: 'Paper quilling artwork, rendered with {colors} paper strips. The word "{text}" expressed in {scriptStyle}. Paper strips create {depth} and natural shadows, placed on {backgroundColor} textured background.'
    },
    material: {
      id: "material",
      name: "\uC7AC\uB8CC/\uD14D\uC2A4\uCC98",
      icon: "\u{1FAA8}",
      category: "artwork",
      description: "\uC624\uBE0C\uC81D\uD2B8\uB97C \uD2B9\uC815 \uC7AC\uB8CC\uB85C \uD45C\uD604",
      fields: [
        {
          id: "targetObject",
          label: "\uB300\uC0C1 \uC624\uBE0C\uC81D\uD2B8",
          type: "textarea",
          placeholder: "\uC608: \uC0AC\uACFC, \uC790\uB3D9\uCC28, \uC778\uAC04 \uC5BC\uAD74",
          required: true
        },
        {
          id: "material",
          label: "\uC7AC\uB8CC",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "polished marble", label: "\uAD11\uD0DD \uB300\uB9AC\uC11D" },
            { value: "rough granite", label: "\uAC70\uCE5C \uD654\uAC15\uC554" },
            { value: "liquid mercury", label: "\uC561\uCCB4 \uC218\uC740" },
            { value: "cracked porcelain", label: "\uAE08\uAC04 \uB3C4\uC790\uAE30" },
            { value: "weathered bronze", label: "\uD48D\uD654\uB41C \uCCAD\uB3D9" },
            { value: "ice crystal", label: "\uC5BC\uC74C \uACB0\uC815" },
            { value: "molten lava", label: "\uB179\uC740 \uC6A9\uC554" },
            { value: "woven fabric", label: "\uC9C1\uC870 \uCC9C" },
            { value: "transparent glass", label: "\uD22C\uBA85 \uC720\uB9AC" }
          ]
        },
        {
          id: "textureDetails",
          label: "\uD14D\uC2A4\uCC98 \uB514\uD14C\uC77C",
          type: "text",
          placeholder: "\uC608: \uADE0\uC5F4, \uBC18\uC0AC, \uC9C8\uAC10, \uD45C\uBA74 \uCC98\uB9AC"
        },
        {
          id: "lighting",
          label: "\uC870\uBA85",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "studio lighting for material showcase", label: "\uC7AC\uC9C8 \uC1FC\uCF00\uC774\uC2A4\uC6A9 \uC2A4\uD29C\uB514\uC624 \uC870\uBA85" },
            { value: "dramatic side lighting", label: "\uB4DC\uB77C\uB9C8\uD2F1 \uC0AC\uC774\uB4DC \uC870\uBA85" },
            { value: "soft ambient lighting", label: "\uBD80\uB4DC\uB7EC\uC6B4 \uD658\uACBD \uC870\uBA85" }
          ]
        },
        {
          id: "background",
          label: "\uBC30\uACBD",
          type: "text",
          placeholder: "\uC608: \uAC80\uC740 \uBC30\uACBD, \uADF8\uB77C\uB370\uC774\uC158, \uC790\uC5F0\uD658\uACBD"
        }
      ],
      promptTemplate: "Create {targetObject} made entirely of {material}. The surface shows {textureDetails}. Lighting: {lighting}. Background: {background}. Photorealistic render emphasizing the material properties."
    },
    cityLettering: {
      id: "cityLettering",
      name: "\uB3C4\uC2DC \uB808\uD130\uB9C1",
      icon: "\u{1F3D9}\uFE0F",
      category: "artwork",
      description: "\uAC74\uBB3C\uB85C \uAE00\uC790 \uD615\uD0DC \uD45C\uD604",
      fields: [
        {
          id: "city",
          label: "\uB3C4\uC2DC",
          type: "text",
          placeholder: "\uC608: \uBCA0\uB97C\uB9B0, \uC11C\uC6B8, \uB3C4\uCFC4, \uB274\uC695",
          required: true
        },
        {
          id: "word",
          label: "\uD45C\uD604\uD560 \uB2E8\uC5B4",
          type: "text",
          placeholder: "\uC608: BERLIN, SEOUL",
          required: true,
          helpText: "\uB3C4\uC2DC \uC774\uB984 \uB610\uB294 \uC9E7\uC740 \uB2E8\uC5B4 \uAD8C\uC7A5"
        },
        {
          id: "buildingColors",
          label: "\uAC74\uBB3C \uC0C9\uC0C1",
          type: "text",
          placeholder: "\uC608: \uD30C\uB780\uC0C9, \uBE68\uAC04\uC0C9, \uD770\uC0C9, \uAC80\uC740\uC0C9"
        },
        {
          id: "timeOfDay",
          label: "\uC2DC\uAC04\uB300",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "bright sunny day", label: "\uBC1D\uC740 \uD587\uC0B4 \uB0AE" },
            { value: "golden hour sunset", label: "\uACE8\uB4E0\uC544\uC6CC \uC11D\uC591" },
            { value: "blue hour twilight", label: "\uBE14\uB8E8\uC544\uC6CC \uD669\uD63C" },
            { value: "night with city lights", label: "\uB3C4\uC2DC \uBD88\uBE5B \uBC24" }
          ]
        },
        {
          id: "perspective",
          label: "\uC2DC\uC810",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "street level view", label: "\uAC70\uB9AC \uC2DC\uC810" },
            { value: "aerial view", label: "\uACF5\uC911 \uC2DC\uC810" },
            { value: "wide panoramic", label: "\uC640\uC774\uB4DC \uD30C\uB178\uB77C\uB9C8" }
          ]
        }
      ],
      promptTemplate: '{timeOfDay} {city} street view. Old buildings arranged subtly in the shape of the letters "{word}". Buildings painted in {buildingColors}. Buildings still look like buildings, similarity to letters is subtle. {perspective}. Strong shadows, sharp details.'
    },
    lightingPro: {
      id: "lightingPro",
      name: "\uC870\uBA85 \uC815\uBC00 \uC81C\uC5B4",
      icon: "\u{1F4A1}",
      category: "professional",
      description: "\uAE30\uC220\uC801 \uC870\uBA85 \uC5B8\uC5B4\uB85C \uC815\uD655\uD55C \uC870\uBA85 \uC124\uC815",
      fields: [
        {
          id: "subject",
          label: "\uD53C\uC0AC\uCCB4/\uC7A5\uBA74",
          type: "textarea",
          placeholder: "\uC608: \uD504\uB9AC\uBBF8\uC5C4 \uC2DC\uACC4 \uC81C\uD488 \uC0AC\uC9C4, \uC778\uBB3C \uCD08\uC0C1\uD654",
          required: true
        },
        {
          id: "colorTemp",
          label: "\uC0C9\uC628\uB3C4",
          type: "select",
          options: [
            { value: "", label: "\uC120\uD0DD\uD558\uC138\uC694" },
            { value: "5600K daylight balanced", label: "5600K \uC8FC\uAD11" },
            { value: "3200K tungsten warm", label: "3200K \uD145\uC2A4\uD150 \uB530\uB73B\uD568" },
            { value: "6500K cool daylight", label: "6500K \uCFE8 \uB370\uC774\uB77C\uC774\uD2B8" },
            { value: "mixed warm key and cool fill", label: "\uD63C\uD569 (\uB530\uB73B\uD568 \uD0A4 + \uCC28\uAC00\uC6C0 \uD544)" }
          ]
        },
        {
          id: "keyLight",
          label: "\uD0A4 \uB77C\uC774\uD2B8",
          type: "text",
          placeholder: "\uC608: \uC67C\uCABD \uC0C1\uB2E8\uC5D0\uC11C 45\uB3C4 \uAC01\uB3C4, \uC18C\uD504\uD2B8\uBC15\uC2A4",
          helpText: "\uC8FC\uC694 \uC870\uBA85\uC758 \uC704\uCE58, \uAC01\uB3C4, \uC218\uC2DD\uC5B4"
        },
        {
          id: "fillLight",
          label: "\uD544 \uB77C\uC774\uD2B8",
          type: "text",
          placeholder: "\uC608: \uC624\uB978\uCABD\uC5D0\uC11C 30% \uAC15\uB3C4\uC758 \uBC18\uC0AC\uD310",
          helpText: "\uADF8\uB9BC\uC790\uB97C \uCC44\uC6B0\uB294 \uBCF4\uC870 \uC870\uBA85"
        },
        {
          id: "rimLight",
          label: "\uB9BC/\uBC31 \uB77C\uC774\uD2B8",
          type: "text",
          placeholder: "\uC608: \uB4A4\uC5D0\uC11C \uD53C\uC0AC\uCCB4 \uAC00\uC7A5\uC790\uB9AC\uB97C \uAC15\uC870\uD558\uB294 \uC587\uC740 \uBE5B",
          helpText: "\uD53C\uC0AC\uCCB4 \uC724\uACFD\uC744 \uBD84\uB9AC\uD558\uB294 \uC870\uBA85"
        },
        {
          id: "surface",
          label: "\uBC30\uCE58 \uD45C\uBA74",
          type: "text",
          placeholder: "\uC608: \uAC80\uC740 \uC544\uD06C\uB9B4 \uD45C\uBA74\uC5D0 \uBC18\uC0AC, \uD770\uC0C9 \uBB34\uAD11 \uD14C\uC774\uBE14"
        }
      ],
      promptTemplate: "{subject}. Professional lighting setup: {colorTemp} color temperature. Key light: {keyLight}. Fill light: {fillLight}. Rim/back light: {rimLight}. Subject placed on {surface}. Studio photography quality."
    }
  };

  // src/js/state.js
  var state = {
    apiKey: "",
    apiStatus: "disconnected",
    // 'disconnected' | 'testing' | 'connected' | 'error'
    currentTemplate: "basic",
    fieldValues: {},
    generatedImage: null,
    isLoading: false,
    error: null,
    // Phase 2 추가
    workMode: "explore",
    // 'explore' | 'refine' | 'final'
    attachedImages: [],
    // { id, file, originalSize, processedSize, base64, thumbnail, width, height }
    selectedImageId: null,
    resultHistory: [],
    // { id, prompt, translatedPrompt, image: { mimeType, data }, timestamp }
    selectedResultId: null,
    autoTranslate: false,
    translatedPrompt: "",
    isTranslating: false,
    promptTab: "original",
    // 'original' | 'translated'
    imageModalIndex: -1,
    // Phase 3 추가
    thinkingMode: false,
    editSession: {
      sessionId: null,
      basePrompt: "",
      editHistory: [],
      // { id, step, request, prompt, image, timestamp }
      currentEditIndex: -1
    },
    presetCategory: "lighting",
    // Phase 4 추가
    promptHistory: [],
    // { id, prompt, translatedPrompt, templateId, timestamp }
    promptHistorySearch: "",
    customTemplates: {},
    // { templateId: templateObject }
    editingTemplate: null,
    // 현재 편집 중인 템플릿 ID
    templateEditorFields: [],
    // 편집기의 필드 목록
    canvasSettings: {
      aspectRatio: "1:1",
      customWidth: 1024,
      customHeight: 1024,
      baseSize: 1024,
      backgroundColor: "#FFFFFF",
      backgroundType: "white"
      // 'white' | 'transparent' | 'custom'
    },
    // Phase 5 추가
    theme: "light",
    // 'light' | 'dark'
    locale: "ko",
    // 'ko' | 'en'
    showTips: true,
    dismissedTips: []
  };
  function initializeFieldValues() {
    Object.keys(TEMPLATES).forEach((templateId) => {
      state.fieldValues[templateId] = {};
      TEMPLATES[templateId].fields.forEach((field) => {
        if (field.defaultValue !== void 0) {
          state.fieldValues[templateId][field.id] = field.defaultValue;
        } else if (field.type === "checkbox-group") {
          state.fieldValues[templateId][field.id] = [];
        } else if (field.type === "checkbox") {
          state.fieldValues[templateId][field.id] = false;
        } else {
          state.fieldValues[templateId][field.id] = "";
        }
      });
    });
  }
  function initializeCustomTemplateFieldValues(templateId, template) {
    state.fieldValues[templateId] = {};
    template.fields.forEach((field) => {
      if (field.defaultValue !== void 0) {
        state.fieldValues[templateId][field.id] = field.defaultValue;
      } else if (field.type === "checkbox-group") {
        state.fieldValues[templateId][field.id] = [];
      } else if (field.type === "checkbox") {
        state.fieldValues[templateId][field.id] = false;
      } else {
        state.fieldValues[templateId][field.id] = "";
      }
    });
  }

  // src/js/config.js
  var STORAGE_KEYS = {
    API_KEY: "nano_banana_api_key",
    SETTINGS: "nano_banana_settings",
    HISTORY: "nano_banana_history",
    PROMPT_HISTORY: "nano_banana_prompt_history",
    CUSTOM_TEMPLATES: "nano_banana_custom_templates",
    RESULT_HISTORY: "nano_banana_result_history",
    DISMISSED_TIPS: "nano_banana_dismissed_tips",
    SHOW_TIPS: "nano_banana_show_tips",
    LOCALE: "nano_banana_locale"
  };
  var API_ENDPOINTS = {
    TEXT: "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",
    IMAGE: "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent"
  };
  var API_ERRORS = {
    400: "\uC798\uBABB\uB41C \uC694\uCCAD\uC785\uB2C8\uB2E4. \uD504\uB86C\uD504\uD2B8\uB97C \uD655\uC778\uD574\uC8FC\uC138\uC694.",
    401: "API \uD0A4\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.",
    403: "\uC811\uADFC\uC774 \uAC70\uBD80\uB418\uC5C8\uC2B5\uB2C8\uB2E4. API \uD0A4 \uAD8C\uD55C\uC744 \uD655\uC778\uD574\uC8FC\uC138\uC694.",
    429: "\uC694\uCCAD \uD55C\uB3C4\uB97C \uCD08\uACFC\uD588\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",
    500: "\uC11C\uBC84 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",
    "NETWORK_ERROR": "\uB124\uD2B8\uC6CC\uD06C \uC5F0\uACB0\uC744 \uD655\uC778\uD574\uC8FC\uC138\uC694.",
    "IMAGE_SAFETY": "\uC548\uC804 \uD544\uD130\uC5D0 \uC758\uD574 \uC774\uBBF8\uC9C0 \uC0DD\uC131\uC774 \uCC28\uB2E8\uB418\uC5C8\uC2B5\uB2C8\uB2E4."
  };
  var THINKING_PREFIX = `Before generating this image:
1. Analyze the core objective of my request
2. Verify logical consistency of physics, lighting, and composition
3. Establish relationships and priorities between elements
4. Review potential error points (e.g., text spelling, proportions)

Then generate:
`;
  var QUICK_PRESETS = {
    lighting: {
      id: "lighting",
      name: "\u{1F4A1} \uC870\uBA85",
      presets: [
        { id: "warmer", label: "\uB354 \uB530\uB73B\uD558\uAC8C", prompt: "Make the lighting warmer with golden tones" },
        { id: "cooler", label: "\uB354 \uCC28\uAC11\uAC8C", prompt: "Make the lighting cooler with blue tones" },
        { id: "shadow_strong", label: "\uADF8\uB9BC\uC790 \uAC15\uD654", prompt: "Enhance shadows for more dramatic contrast" },
        { id: "shadow_soft", label: "\uADF8\uB9BC\uC790 \uBD80\uB4DC\uB7FD\uAC8C", prompt: "Soften shadows for a more gentle look" },
        { id: "backlight", label: "\uC5ED\uAD11 \uCD94\uAC00", prompt: "Add backlighting/rim light behind the subject" }
      ]
    },
    color: {
      id: "color",
      name: "\u{1F3A8} \uC0C9\uC0C1",
      presets: [
        { id: "saturation_up", label: "\uCC44\uB3C4 +15%", prompt: "Increase color saturation by 15%" },
        { id: "saturation_down", label: "\uCC44\uB3C4 -15%", prompt: "Decrease color saturation by 15%" },
        { id: "contrast_up", label: "\uB300\uBE44 \uB192\uC774\uAE30", prompt: "Increase contrast for more vivid colors" },
        { id: "vintage", label: "\uBE48\uD2F0\uC9C0 \uD1A4", prompt: "Apply vintage/retro color grading" },
        { id: "monochrome", label: "\uBAA8\uB178\uD06C\uB86C", prompt: "Convert to monochrome/black and white" }
      ]
    },
    elements: {
      id: "elements",
      name: "\u{1F9E9} \uC694\uC18C",
      presets: [
        { id: "add_logo", label: "\uB85C\uACE0 \uCD94\uAC00", prompt: "Add a subtle logo placeholder in the corner" },
        { id: "add_text", label: "\uD14D\uC2A4\uD2B8 \uCD94\uAC00", prompt: "Add text overlay space" },
        { id: "change_bg", label: "\uBC30\uACBD \uBCC0\uACBD", prompt: "Change the background to a neutral/clean background" },
        { id: "add_props", label: "\uC18C\uD488 \uCD94\uAC00", prompt: "Add complementary props/accessories to the scene" }
      ]
    },
    style: {
      id: "style",
      name: "\u{1F58C}\uFE0F \uC2A4\uD0C0\uC77C",
      presets: [
        { id: "more_realistic", label: "\uB354 \uC0AC\uC2E4\uC801\uC73C\uB85C", prompt: "Make it more photorealistic with natural details" },
        { id: "more_illustration", label: "\uB354 \uC77C\uB7EC\uC2A4\uD2B8\uD48D\uC73C\uB85C", prompt: "Make it more illustrated/artistic style" },
        { id: "film_grain", label: "\uD544\uB984 \uADF8\uB808\uC778 \uCD94\uAC00", prompt: "Add subtle film grain texture" },
        { id: "cinematic", label: "\uC2DC\uB124\uB9C8\uD2F1", prompt: "Apply cinematic look with letterbox aspect ratio feel" }
      ]
    }
  };
  var WORK_MODES = {
    explore: {
      id: "explore",
      name: "\uD0D0\uC0C9",
      icon: "\u{1F50D}",
      maxSize: 512,
      quality: 0.6,
      description: "\uBE60\uB978 \uBCC0\uD615 \uC0DD\uC131\uC6A9 (512px, 60% \uD488\uC9C8)"
    },
    refine: {
      id: "refine",
      name: "\uC815\uC81C",
      icon: "\u2728",
      maxSize: 1024,
      quality: 0.8,
      description: "\uC138\uBD80 \uC870\uC815\uC6A9 (1024px, 80% \uD488\uC9C8)"
    },
    final: {
      id: "final",
      name: "\uCD5C\uC885",
      icon: "\u{1F4F8}",
      maxSize: null,
      quality: 1,
      description: "\uD504\uB85C\uB355\uC158 \uCD9C\uB825\uC6A9 (\uC6D0\uBCF8 \uD574\uC0C1\uB3C4)"
    }
  };

  // src/js/storage.js
  function loadFromStorage() {
    try {
      const savedApiKey = localStorage.getItem(STORAGE_KEYS.API_KEY);
      if (savedApiKey) {
        state.apiKey = savedApiKey;
        const apiKeyInput = document.getElementById("apiKeyInput");
        if (apiKeyInput) {
          apiKeyInput.value = savedApiKey;
        }
        return savedApiKey;
      }
    } catch (e) {
      console.error("Failed to load from storage:", e);
    }
    return null;
  }
  function saveToStorage() {
    try {
      localStorage.setItem(STORAGE_KEYS.API_KEY, state.apiKey);
    } catch (e) {
      console.error("Failed to save to storage:", e);
    }
  }
  function loadSettings() {
    try {
      const saved = localStorage.getItem(STORAGE_KEYS.SETTINGS);
      if (saved) {
        const settings = JSON.parse(saved);
        if (settings.workMode) state.workMode = settings.workMode;
        if (settings.autoTranslate !== void 0) state.autoTranslate = settings.autoTranslate;
        if (settings.thinkingMode !== void 0) state.thinkingMode = settings.thinkingMode;
      }
    } catch (e) {
      console.error("Failed to load settings:", e);
    }
  }
  var MAX_HISTORY_ITEMS = 20;
  var MAX_STORAGE_SIZE = 4 * 1024 * 1024;
  function saveResultHistory() {
    try {
      const historyToSave = state.resultHistory.slice(0, MAX_HISTORY_ITEMS);
      let jsonString = JSON.stringify(historyToSave);
      while (jsonString.length > MAX_STORAGE_SIZE && historyToSave.length > 0) {
        historyToSave.pop();
        jsonString = JSON.stringify(historyToSave);
      }
      localStorage.setItem(STORAGE_KEYS.RESULT_HISTORY, jsonString);
    } catch (e) {
      if (e.name === "QuotaExceededError") {
        console.warn("Storage quota exceeded, reducing history size...");
        state.resultHistory = state.resultHistory.slice(0, Math.floor(state.resultHistory.length / 2));
        saveResultHistory();
      } else {
        console.error("Failed to save result history:", e);
      }
    }
  }
  function loadResultHistory() {
    try {
      const saved = localStorage.getItem(STORAGE_KEYS.RESULT_HISTORY);
      if (saved) {
        state.resultHistory = JSON.parse(saved);
        if (state.resultHistory.length > 0) {
          state.selectedResultId = state.resultHistory[0].id;
          state.generatedImage = state.resultHistory[0].image;
        }
      }
    } catch (e) {
      console.error("Failed to load result history:", e);
      state.resultHistory = [];
    }
  }
  function addToResultHistory(item) {
    state.resultHistory.unshift(item);
    if (state.resultHistory.length > MAX_HISTORY_ITEMS) {
      state.resultHistory = state.resultHistory.slice(0, MAX_HISTORY_ITEMS);
    }
    saveResultHistory();
  }
  function saveToLocalStorage(key, value) {
    try {
      localStorage.setItem(key, JSON.stringify(value));
    } catch (e) {
      console.error(`Failed to save ${key}:`, e);
    }
  }
  function loadFromLocalStorage(key) {
    try {
      const saved = localStorage.getItem(key);
      return saved ? JSON.parse(saved) : null;
    } catch (e) {
      console.error(`Failed to load ${key}:`, e);
      return null;
    }
  }

  // src/js/utils.js
  function generateImageId() {
    return "img_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
  }
  function generateSessionId() {
    return "session_" + Date.now() + "_" + Math.random().toString(36).substr(2, 6);
  }
  function generateCustomTemplateId() {
    return "custom_" + Date.now() + "_" + Math.random().toString(36).substr(2, 6);
  }
  function generateResultId() {
    return "result_" + Date.now() + "_" + Math.random().toString(36).substr(2, 6);
  }
  function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + " B";
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
    return (bytes / (1024 * 1024)).toFixed(1) + " MB";
  }
  function formatRelativeTime(timestamp) {
    const date = new Date(timestamp);
    const now = /* @__PURE__ */ new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 6e4);
    const diffHours = Math.floor(diffMs / 36e5);
    const diffDays = Math.floor(diffMs / 864e5);
    if (diffMins < 1) return "\uBC29\uAE08 \uC804";
    if (diffMins < 60) return `${diffMins}\uBD84 \uC804`;
    if (diffHours < 24) return `${diffHours}\uC2DC\uAC04 \uC804`;
    if (diffDays < 7) return `${diffDays}\uC77C \uC804`;
    return date.toLocaleDateString("ko-KR");
  }
  function escapeHtml(str) {
    if (!str) return "";
    return str.replace(/[&<>"']/g, (c) => ({
      "&": "&amp;",
      "<": "&lt;",
      ">": "&gt;",
      '"': "&quot;",
      "'": "&#039;"
    })[c]);
  }
  function showError(message) {
    const errorDiv = document.getElementById("errorMessage");
    if (errorDiv) {
      errorDiv.textContent = message;
      errorDiv.classList.remove("hidden");
      setTimeout(() => {
        errorDiv.classList.add("hidden");
      }, 5e3);
    }
  }
  function hideError() {
    const errorDiv = document.getElementById("errorMessage");
    if (errorDiv) {
      errorDiv.classList.add("hidden");
    }
  }
  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  // src/js/prompt-builder.js
  function buildPrompt(templateId, values) {
    const template = TEMPLATES[templateId] || state.customTemplates[templateId];
    if (!template) return "";
    let prompt = template.promptTemplate;
    template.fields.forEach((field) => {
      const value = values[field.id];
      let replacement = "";
      if (field.type === "checkbox-group" && Array.isArray(value)) {
        replacement = value.join(", ");
      } else if (field.type === "checkbox") {
        replacement = value ? "yes" : "";
      } else {
        replacement = value || "";
      }
      if (field.id === "action" && replacement) {
        replacement = ", " + replacement;
      }
      if (field.id === "location" && replacement) {
        replacement = " in " + replacement;
      }
      prompt = prompt.replace(new RegExp(`\\{${field.id}\\}`, "g"), replacement);
    });
    prompt = prompt.replace(/\{[^}]+\}/g, "").replace(/\s+/g, " ").replace(/\s*,\s*,/g, ",").replace(/,\s*\./g, ".").replace(/\.\s*\./g, ".").replace(/\s+\./g, ".").replace(/^\s*,\s*/g, "").replace(/,\s*$/g, "").trim();
    return prompt;
  }
  function _updatePromptPreview() {
    const prompt = buildPrompt(state.currentTemplate, state.fieldValues[state.currentTemplate]);
    const previewEl = document.getElementById("promptPreview");
    if (!previewEl) return;
    if (prompt && prompt.length > 10) {
      previewEl.textContent = prompt;
      previewEl.classList.remove("empty");
    } else {
      previewEl.textContent = "\uD544\uB4DC\uB97C \uC785\uB825\uD558\uBA74 \uD504\uB86C\uD504\uD2B8\uAC00 \uC0DD\uC131\uB429\uB2C8\uB2E4.";
      previewEl.classList.add("empty");
    }
  }
  var updatePromptPreview = debounce(_updatePromptPreview, 300);
  function updatePromptPreviewImmediate() {
    _updatePromptPreview();
  }

  // src/js/ui/render-templates.js
  function renderTemplateTabs() {
    const container = document.getElementById("templateTabs");
    if (!container) return;
    container.innerHTML = "";
    Object.values(TEMPLATES).forEach((template) => {
      const tab = document.createElement("button");
      tab.className = `template-tab ${state.currentTemplate === template.id ? "active" : ""}`;
      tab.onclick = () => window.handleTemplateChange(template.id);
      tab.innerHTML = `
      <span class="icon">${template.icon}</span>
      <span>${template.name}</span>
    `;
      container.appendChild(tab);
    });
    if (Object.keys(state.customTemplates).length > 0) {
      const divider = document.createElement("div");
      divider.className = "template-tab-divider";
      divider.innerHTML = "|";
      container.appendChild(divider);
      Object.values(state.customTemplates).forEach((template) => {
        const tab = document.createElement("button");
        tab.className = `template-tab template-tab-custom ${state.currentTemplate === template.id ? "active" : ""}`;
        tab.onclick = () => window.handleTemplateChange(template.id);
        tab.innerHTML = `
        <span class="icon">${template.icon}</span>
        <span>${template.name}</span>
      `;
        container.appendChild(tab);
      });
    }
    const addBtn = document.createElement("button");
    addBtn.className = "template-tab template-tab-add";
    addBtn.onclick = () => window.openTemplateEditor();
    addBtn.innerHTML = `
    <span class="icon">\u2795</span>
    <span>\uC0C8 \uD15C\uD50C\uB9BF</span>
  `;
    container.appendChild(addBtn);
  }
  function renderTemplateFields() {
    const container = document.getElementById("templateForm");
    if (!container) return;
    const template = TEMPLATES[state.currentTemplate] || state.customTemplates[state.currentTemplate];
    if (!template) {
      container.innerHTML = '<p class="form-help">\uD15C\uD50C\uB9BF\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.</p>';
      return;
    }
    const values = state.fieldValues[state.currentTemplate];
    container.innerHTML = "";
    if (template.isCustom) {
      const customActions = document.createElement("div");
      customActions.className = "custom-template-actions";
      customActions.innerHTML = `
      <button class="btn btn-outline btn-sm" onclick="openTemplateEditor('${template.id}')">\u270F\uFE0F \uD3B8\uC9D1</button>
      <button class="btn btn-outline btn-sm" onclick="duplicateTemplate('${template.id}')">\u{1F4CB} \uBCF5\uC81C</button>
      <button class="btn btn-outline btn-sm" onclick="exportTemplate('${template.id}')">\u{1F4E4} \uB0B4\uBCF4\uB0B4\uAE30</button>
      <button class="btn btn-outline btn-sm btn-danger" onclick="deleteCustomTemplate('${template.id}')">\u{1F5D1}\uFE0F \uC0AD\uC81C</button>
    `;
      container.appendChild(customActions);
    } else {
      const duplicateBtn = document.createElement("div");
      duplicateBtn.className = "template-duplicate-btn";
      duplicateBtn.innerHTML = `
      <button class="btn btn-outline btn-sm" onclick="duplicateTemplate('${template.id}')">\u{1F4CB} \uC774 \uD15C\uD50C\uB9BF \uBCF5\uC81C\uD558\uC5EC \uCEE4\uC2A4\uD130\uB9C8\uC774\uC988</button>
    `;
      container.appendChild(duplicateBtn);
    }
    template.fields.forEach((field) => {
      const group = document.createElement("div");
      group.className = "form-group";
      const label = document.createElement("label");
      label.className = "form-label";
      label.innerHTML = field.label + (field.required ? ' <span class="required">*</span>' : "");
      group.appendChild(label);
      let input;
      switch (field.type) {
        case "text":
          input = document.createElement("input");
          input.type = "text";
          input.className = "form-input";
          input.placeholder = field.placeholder || "";
          input.value = values[field.id] || "";
          input.oninput = (e) => {
            state.fieldValues[state.currentTemplate][field.id] = e.target.value;
            updatePromptPreview();
          };
          break;
        case "textarea":
          input = document.createElement("textarea");
          input.className = "form-textarea";
          input.placeholder = field.placeholder || "";
          input.value = values[field.id] || "";
          input.oninput = (e) => {
            state.fieldValues[state.currentTemplate][field.id] = e.target.value;
            updatePromptPreview();
          };
          break;
        case "select":
          input = document.createElement("select");
          input.className = "form-select";
          field.options.forEach((opt) => {
            const option = document.createElement("option");
            option.value = opt.value;
            option.textContent = opt.label;
            if (values[field.id] === opt.value) {
              option.selected = true;
            }
            input.appendChild(option);
          });
          input.onchange = (e) => {
            state.fieldValues[state.currentTemplate][field.id] = e.target.value;
            updatePromptPreview();
          };
          break;
        case "checkbox":
          input = document.createElement("label");
          input.className = "form-checkbox-label";
          input.innerHTML = `
          <input type="checkbox" ${values[field.id] ? "checked" : ""}>
          <span>\uD65C\uC131\uD654</span>
        `;
          input.querySelector("input").onchange = (e) => {
            state.fieldValues[state.currentTemplate][field.id] = e.target.checked;
            updatePromptPreview();
          };
          break;
        case "checkbox-group":
          input = document.createElement("div");
          input.className = "form-checkbox-group";
          field.options.forEach((opt) => {
            const checkLabel = document.createElement("label");
            checkLabel.className = "form-checkbox-label";
            const isChecked = Array.isArray(values[field.id]) && values[field.id].includes(opt.value);
            checkLabel.innerHTML = `
            <input type="checkbox" value="${opt.value}" ${isChecked ? "checked" : ""}>
            <span>${opt.label}</span>
          `;
            checkLabel.querySelector("input").onchange = (e) => {
              const currentValues = state.fieldValues[state.currentTemplate][field.id] || [];
              if (e.target.checked) {
                state.fieldValues[state.currentTemplate][field.id] = [...currentValues, opt.value];
              } else {
                state.fieldValues[state.currentTemplate][field.id] = currentValues.filter((v) => v !== opt.value);
              }
              updatePromptPreview();
            };
            input.appendChild(checkLabel);
          });
          break;
      }
      if (input) {
        group.appendChild(input);
      }
      if (field.helpText) {
        const help = document.createElement("p");
        help.className = "form-help";
        help.textContent = field.helpText;
        group.appendChild(help);
      }
      container.appendChild(group);
    });
    updatePromptPreviewImmediate();
  }

  // src/js/ui/render-result.js
  function renderResult() {
    const container = document.getElementById("resultContainer");
    const historyContainer = document.getElementById("resultHistory");
    if (!container) return;
    if (historyContainer) {
      if (state.resultHistory.length > 0) {
        historyContainer.classList.remove("hidden");
        historyContainer.innerHTML = state.resultHistory.map((item, index) => `
        <div class="result-history-item ${state.selectedResultId === item.id ? "selected" : ""}"
             onclick="selectResultHistory('${item.id}')"
             ondblclick="openImageModal(${index})">
          <img src="data:${item.image.mimeType};base64,${item.image.data}" alt="\uD788\uC2A4\uD1A0\uB9AC ${index + 1}">
        </div>
      `).join("");
      } else {
        historyContainer.classList.add("hidden");
      }
    }
    if (state.isLoading) {
      container.innerHTML = `
      <div class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">\uC774\uBBF8\uC9C0 \uC0DD\uC131 \uC911...</div>
      </div>
    `;
      return;
    }
    if (state.generatedImage) {
      container.innerHTML = `
      <img
        src="data:${state.generatedImage.mimeType};base64,${state.generatedImage.data}"
        alt="\uC0DD\uC131\uB41C \uC774\uBBF8\uC9C0"
        class="result-image"
        style="cursor: pointer;"
        onclick="openImageModal(${state.resultHistory.length - 1})"
      >
      <div class="result-actions">
        <button class="btn btn-primary" onclick="downloadImage()">
          \u{1F4BE} \uB2E4\uC6B4\uB85C\uB4DC
        </button>
        <button class="btn btn-outline" onclick="openImageModal(${state.resultHistory.length - 1})">
          \u{1F50D} \uD655\uB300
        </button>
      </div>
    `;
      return;
    }
    container.innerHTML = `
    <div class="result-placeholder">
      <div class="result-placeholder-icon">\u{1F3A8}</div>
      <div>\uD504\uB86C\uD504\uD2B8\uB97C \uC785\uB825\uD558\uACE0<br>\uC774\uBBF8\uC9C0\uB97C \uC0DD\uC131\uD558\uC138\uC694</div>
    </div>
  `;
  }

  // src/js/ui/render-images.js
  function renderAttachedImages() {
    const grid = document.getElementById("thumbnailGrid");
    const countEl = document.getElementById("attachedCount");
    const infoEl = document.getElementById("selectedImageInfo");
    if (!grid || !countEl) return;
    countEl.textContent = state.attachedImages.length;
    if (state.attachedImages.length === 0) {
      grid.innerHTML = "";
      if (infoEl) infoEl.classList.add("hidden");
      return;
    }
    grid.innerHTML = state.attachedImages.map((img, index) => `
    <div class="thumbnail-item attached-thumb ${state.selectedImageId === img.id ? "selected" : ""}"
         draggable="true"
         onclick="selectAttachedImage('${img.id}')"
         ondragstart="handleImageDragStart(event, '${img.id}')"
         ondragover="handleImageDragOver(event)"
         ondragleave="handleImageDragLeave(event)"
         ondrop="handleImageDrop(event, '${img.id}')"
         ondragend="handleImageDragEnd(event)">
      <img src="${img.thumbnail}" alt="\uCCA8\uBD80 ${index + 1}" draggable="false">
      <span class="thumbnail-index">${index + 1}</span>
      <button class="thumbnail-delete" onclick="event.stopPropagation(); deleteAttachedImage('${img.id}')">&times;</button>
    </div>
  `).join("");
    if (state.selectedImageId && infoEl) {
      const selectedImg = state.attachedImages.find((img) => img.id === state.selectedImageId);
      if (selectedImg) {
        infoEl.classList.remove("hidden");
        const previewEl = document.getElementById("selectedImagePreview");
        const metaEl = document.getElementById("selectedImageMeta");
        if (previewEl) {
          previewEl.src = `data:image/jpeg;base64,${selectedImg.base64}`;
        }
        if (metaEl) {
          metaEl.innerHTML = `
          <p>\u{1F4C4} ${selectedImg.file.name}</p>
          <p>\u{1F4D0} ${selectedImg.originalWidth}\xD7${selectedImg.originalHeight} \u2192 ${selectedImg.width}\xD7${selectedImg.height}</p>
          <p>\u{1F4BE} ${formatFileSize(selectedImg.originalSize)} \u2192 ${formatFileSize(selectedImg.processedSize)}</p>
        `;
        }
      }
    } else if (infoEl) {
      infoEl.classList.add("hidden");
    }
  }

  // src/js/ui/render-edit-session.js
  function renderEditSession() {
    const sessionEl = document.getElementById("editSession");
    const historyEl = document.getElementById("editHistory");
    if (!sessionEl) return;
    if (state.editSession.editHistory.length === 0) {
      sessionEl.classList.add("hidden");
      return;
    }
    sessionEl.classList.remove("hidden");
    if (historyEl) {
      historyEl.innerHTML = state.editSession.editHistory.map((item, index) => `
      <div class="edit-history-item ${index === state.editSession.currentEditIndex ? "active" : ""}"
           onclick="selectEditHistoryItem(${index})">
        <span class="step-number">${item.step}</span>
        <div class="step-content">
          <div class="step-label">\uB2E8\uACC4 ${item.step}</div>
          <div class="step-text">${item.request}</div>
        </div>
        ${item.image ? `
          <div class="step-thumb">
            <img src="data:${item.image.mimeType};base64,${item.image.data}" alt="\uB2E8\uACC4 ${item.step}">
          </div>
        ` : ""}
      </div>
    `).join("");
    }
    renderPresets();
  }
  function renderPresets() {
    const categoriesEl = document.getElementById("presetCategories");
    const itemsEl = document.getElementById("presetItems");
    if (!categoriesEl || !itemsEl) return;
    categoriesEl.innerHTML = Object.values(QUICK_PRESETS).map((category) => `
    <button class="preset-category-btn ${state.presetCategory === category.id ? "active" : ""}"
            onclick="setPresetCategory('${category.id}')">
      ${category.name}
    </button>
  `).join("");
    const currentCategory = QUICK_PRESETS[state.presetCategory];
    if (currentCategory) {
      itemsEl.innerHTML = currentCategory.presets.map((preset) => `
      <button class="preset-item" onclick="applyPreset('${preset.id}')">
        ${preset.label}
      </button>
    `).join("");
    }
  }

  // src/js/handlers/template-handlers.js
  function handleTemplateChange(templateId) {
    state.currentTemplate = templateId;
    renderTemplateTabs();
    renderTemplateFields();
  }
  function resetForm() {
    const template = TEMPLATES[state.currentTemplate] || state.customTemplates[state.currentTemplate];
    if (!template) return;
    template.fields.forEach((field) => {
      if (field.defaultValue !== void 0) {
        state.fieldValues[state.currentTemplate][field.id] = field.defaultValue;
      } else if (field.type === "checkbox-group") {
        state.fieldValues[state.currentTemplate][field.id] = [];
      } else if (field.type === "checkbox") {
        state.fieldValues[state.currentTemplate][field.id] = false;
      } else {
        state.fieldValues[state.currentTemplate][field.id] = "";
      }
    });
    renderTemplateFields();
  }

  // src/js/image-processing.js
  async function processImage(file, mode) {
    const config = WORK_MODES[mode];
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          const originalWidth = img.width;
          const originalHeight = img.height;
          const originalSize = file.size;
          if (!config.maxSize || img.width <= config.maxSize && img.height <= config.maxSize) {
            const canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            const base64Full = canvas.toDataURL("image/jpeg", config.quality);
            const base64Data = base64Full.split(",")[1];
            const thumbnail = createThumbnail(img, img.width, img.height);
            resolve({
              id: generateImageId(),
              file,
              originalSize,
              processedSize: Math.round(base64Data.length * 0.75),
              base64: base64Data,
              thumbnail,
              width: img.width,
              height: img.height,
              originalWidth,
              originalHeight
            });
          } else {
            let newWidth, newHeight;
            if (img.width > img.height) {
              newWidth = config.maxSize;
              newHeight = Math.round(img.height * (config.maxSize / img.width));
            } else {
              newHeight = config.maxSize;
              newWidth = Math.round(img.width * (config.maxSize / img.height));
            }
            const canvas = document.createElement("canvas");
            canvas.width = newWidth;
            canvas.height = newHeight;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, newWidth, newHeight);
            const base64Full = canvas.toDataURL("image/jpeg", config.quality);
            const base64Data = base64Full.split(",")[1];
            const thumbnail = createThumbnailFromCanvas(canvas, newWidth, newHeight);
            resolve({
              id: generateImageId(),
              file,
              originalSize,
              processedSize: Math.round(base64Data.length * 0.75),
              base64: base64Data,
              thumbnail,
              width: newWidth,
              height: newHeight,
              originalWidth,
              originalHeight
            });
          }
        };
        img.onerror = () => reject(new Error("\uC774\uBBF8\uC9C0 \uB85C\uB4DC \uC2E4\uD328"));
        img.src = e.target.result;
      };
      reader.onerror = () => reject(new Error("\uD30C\uC77C \uC77D\uAE30 \uC2E4\uD328"));
      reader.readAsDataURL(file);
    });
  }
  function createThumbnail(img, width, height) {
    const thumbCanvas = document.createElement("canvas");
    const thumbSize = 100;
    thumbCanvas.width = thumbSize;
    thumbCanvas.height = thumbSize;
    const thumbCtx = thumbCanvas.getContext("2d");
    const minDim = Math.min(width, height);
    const sx = (width - minDim) / 2;
    const sy = (height - minDim) / 2;
    thumbCtx.drawImage(img, sx, sy, minDim, minDim, 0, 0, thumbSize, thumbSize);
    return thumbCanvas.toDataURL("image/jpeg", 0.7);
  }
  function createThumbnailFromCanvas(canvas, width, height) {
    const thumbCanvas = document.createElement("canvas");
    const thumbSize = 100;
    thumbCanvas.width = thumbSize;
    thumbCanvas.height = thumbSize;
    const thumbCtx = thumbCanvas.getContext("2d");
    const minDim = Math.min(width, height);
    const sx = (width - minDim) / 2;
    const sy = (height - minDim) / 2;
    thumbCtx.drawImage(canvas, sx, sy, minDim, minDim, 0, 0, thumbSize, thumbSize);
    return thumbCanvas.toDataURL("image/jpeg", 0.7);
  }

  // src/js/handlers/image-handlers.js
  function setWorkMode(mode) {
    state.workMode = mode;
    document.querySelectorAll(".work-mode-btn").forEach((btn) => {
      btn.classList.toggle("active", btn.dataset.mode === mode);
    });
    if (state.attachedImages.length > 0) {
      reprocessAttachedImages();
    }
  }
  async function reprocessAttachedImages() {
    const files = state.attachedImages.map((img) => img.file);
    state.attachedImages = [];
    for (const file of files) {
      try {
        const processed = await processImage(file, state.workMode);
        state.attachedImages.push(processed);
      } catch (e) {
        console.error("Image reprocessing failed:", e);
      }
    }
    renderAttachedImages();
  }
  async function handleFileSelect(event) {
    const files = Array.from(event.target.files);
    await addImages(files);
    event.target.value = "";
  }
  async function addImages(files) {
    const validTypes = ["image/png", "image/jpeg", "image/webp", "image/jpg"];
    const maxImages = 14;
    for (const file of files) {
      if (state.attachedImages.length >= maxImages) {
        showError(`\uCD5C\uB300 ${maxImages}\uAC1C\uC758 \uC774\uBBF8\uC9C0\uB9CC \uCCA8\uBD80\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4.`);
        break;
      }
      if (!validTypes.includes(file.type)) {
        showError(`\uC9C0\uC6D0\uD558\uC9C0 \uC54A\uB294 \uD615\uC2DD: ${file.name}`);
        continue;
      }
      try {
        const processed = await processImage(file, state.workMode);
        state.attachedImages.push(processed);
      } catch (e) {
        showError(`\uC774\uBBF8\uC9C0 \uCC98\uB9AC \uC2E4\uD328: ${file.name}`);
      }
    }
    if (state.attachedImages.length > 0 && !state.selectedImageId) {
      state.selectedImageId = state.attachedImages[0].id;
    }
    renderAttachedImages();
  }
  function selectAttachedImage(imageId) {
    state.selectedImageId = imageId;
    renderAttachedImages();
  }
  function deleteAttachedImage(imageId) {
    state.attachedImages = state.attachedImages.filter((img) => img.id !== imageId);
    if (state.selectedImageId === imageId) {
      state.selectedImageId = state.attachedImages.length > 0 ? state.attachedImages[0].id : null;
    }
    renderAttachedImages();
  }
  function deleteSelectedImage() {
    if (state.selectedImageId) {
      deleteAttachedImage(state.selectedImageId);
    }
  }
  function viewOriginalImage() {
    if (!state.selectedImageId) return;
    const img = state.attachedImages.find((i) => i.id === state.selectedImageId);
    if (img) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const modal = document.getElementById("imageModal");
        const modalImg = document.getElementById("imageModalImg");
        const modalInfo = document.getElementById("imageModalInfo");
        if (modalImg) modalImg.src = e.target.result;
        if (modalInfo) modalInfo.textContent = `\uC6D0\uBCF8: ${img.originalWidth}\xD7${img.originalHeight}`;
        if (modal) modal.classList.add("active");
        state.imageModalIndex = -1;
      };
      reader.readAsDataURL(img.file);
    }
  }
  function downloadImage() {
    if (!state.generatedImage) return;
    const link = document.createElement("a");
    link.href = `data:${state.generatedImage.mimeType};base64,${state.generatedImage.data}`;
    link.download = `nano-banana-${Date.now()}.png`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
  function selectResultHistory(historyId) {
    const item = state.resultHistory.find((h) => h.id === historyId);
    if (item) {
      state.selectedResultId = historyId;
      state.generatedImage = item.image;
    }
  }
  var draggedImageId = null;
  function handleImageDragStart(event, imageId) {
    draggedImageId = imageId;
    event.dataTransfer.effectAllowed = "move";
    event.dataTransfer.setData("text/plain", imageId);
    const element = event.target.closest(".attached-thumb");
    if (element) {
      element.classList.add("dragging");
    }
  }
  function handleImageDragOver(event) {
    event.preventDefault();
    event.dataTransfer.dropEffect = "move";
    const thumbContainer = event.target.closest(".attached-thumb");
    if (thumbContainer && !thumbContainer.classList.contains("dragging")) {
      document.querySelectorAll(".attached-thumb.drag-over").forEach((el) => {
        el.classList.remove("drag-over");
      });
      thumbContainer.classList.add("drag-over");
    }
  }
  function handleImageDragLeave(event) {
    const thumbContainer = event.target.closest(".attached-thumb");
    if (thumbContainer) {
      thumbContainer.classList.remove("drag-over");
    }
  }
  function handleImageDrop(event, targetImageId) {
    event.preventDefault();
    document.querySelectorAll(".attached-thumb.drag-over").forEach((el) => {
      el.classList.remove("drag-over");
    });
    if (!draggedImageId || draggedImageId === targetImageId) {
      return;
    }
    const draggedIndex = state.attachedImages.findIndex((img) => img.id === draggedImageId);
    const targetIndex = state.attachedImages.findIndex((img) => img.id === targetImageId);
    if (draggedIndex === -1 || targetIndex === -1) {
      return;
    }
    const [draggedImage] = state.attachedImages.splice(draggedIndex, 1);
    state.attachedImages.splice(targetIndex, 0, draggedImage);
    renderAttachedImages();
  }
  function handleImageDragEnd(event) {
    draggedImageId = null;
    document.querySelectorAll(".attached-thumb.dragging").forEach((el) => {
      el.classList.remove("dragging");
    });
    document.querySelectorAll(".attached-thumb.drag-over").forEach((el) => {
      el.classList.remove("drag-over");
    });
  }

  // src/js/api.js
  async function testApiKey(apiKey) {
    try {
      const response = await fetch(
        `${API_ENDPOINTS.TEXT}?key=${apiKey}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text: "Hello" }] }]
          })
        }
      );
      return response.ok;
    } catch (e) {
      console.error("API test failed:", e);
      return false;
    }
  }
  async function callImageApi(prompt, apiKey, attachedImages = []) {
    const parts = [{ text: prompt }];
    for (const img of attachedImages) {
      if (img.base64) {
        parts.push({
          inlineData: {
            mimeType: "image/jpeg",
            data: img.base64
          }
        });
      }
    }
    const response = await fetch(
      `${API_ENDPOINTS.IMAGE}?key=${apiKey}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{
            parts
          }],
          generationConfig: {
            responseModalities: ["TEXT", "IMAGE"]
          }
        })
      }
    );
    if (!response.ok) {
      const errorText = API_ERRORS[response.status] || `\uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4 (${response.status})`;
      throw new Error(errorText);
    }
    const data = await response.json();
    if (data.candidates && data.candidates[0] && data.candidates[0].content) {
      const parts2 = data.candidates[0].content.parts;
      for (const part of parts2) {
        if (part.inlineData) {
          return {
            mimeType: part.inlineData.mimeType,
            data: part.inlineData.data
          };
        }
      }
    }
    throw new Error("\uC774\uBBF8\uC9C0\uB97C \uC0DD\uC131\uD558\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4. \uB2E4\uB978 \uD504\uB86C\uD504\uD2B8\uB97C \uC2DC\uB3C4\uD574\uBCF4\uC138\uC694.");
  }

  // src/js/features/performance.js
  var translationCache = /* @__PURE__ */ new Map();
  var MAX_CACHE_SIZE = 100;
  function getCachedTranslation(text) {
    return translationCache.get(text);
  }
  function setCachedTranslation(text, translation) {
    if (translationCache.size >= MAX_CACHE_SIZE) {
      const firstKey = translationCache.keys().next().value;
      translationCache.delete(firstKey);
    }
    translationCache.set(text, translation);
  }
  var MAX_STORAGE_SIZE2 = 5 * 1024 * 1024;
  var WARNING_THRESHOLD = 0.8;
  function getStorageUsage() {
    let total = 0;
    for (const key in localStorage) {
      if (localStorage.hasOwnProperty(key)) {
        total += localStorage.getItem(key).length * 2;
      }
    }
    return total;
  }
  function checkStorageQuota() {
    const used = getStorageUsage();
    const usagePercent = used / MAX_STORAGE_SIZE2;
    if (usagePercent > WARNING_THRESHOLD) {
      console.warn(`LocalStorage usage: ${(usagePercent * 100).toFixed(1)}%`);
      return true;
    }
    return false;
  }
  function cleanupOldData() {
    try {
      const historyKey = STORAGE_KEYS.PROMPT_HISTORY;
      const history = JSON.parse(localStorage.getItem(historyKey) || "[]");
      if (history.length > 50) {
        const trimmedHistory = history.slice(-50);
        localStorage.setItem(historyKey, JSON.stringify(trimmedHistory));
        console.log(`Prompt history trimmed: ${history.length} \u2192 ${trimmedHistory.length}`);
      }
    } catch (e) {
      console.error("Failed to cleanup prompt history:", e);
    }
    try {
      const resultKey = STORAGE_KEYS.RESULT_HISTORY;
      const results = JSON.parse(localStorage.getItem(resultKey) || "[]");
      if (results.length > 20) {
        const trimmedResults = results.slice(-20);
        localStorage.setItem(resultKey, JSON.stringify(trimmedResults));
        console.log(`Result history trimmed: ${results.length} \u2192 ${trimmedResults.length}`);
      }
    } catch (e) {
      console.error("Failed to cleanup result history:", e);
    }
  }
  var lazyLoadObserver = null;
  function setupLazyLoading() {
    if ("IntersectionObserver" in window) {
      lazyLoadObserver = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const img = entry.target;
            if (img.dataset.src) {
              img.src = img.dataset.src;
              img.removeAttribute("data-src");
              lazyLoadObserver.unobserve(img);
            }
          }
        });
      }, {
        rootMargin: "50px",
        threshold: 0.01
      });
    }
  }
  function initPerformance() {
    setupLazyLoading();
    if (checkStorageQuota()) {
      cleanupOldData();
    }
  }

  // src/js/translation.js
  async function translateToEnglish(koreanText, apiKey) {
    const cached = getCachedTranslation(koreanText);
    if (cached) {
      console.log("Translation cache hit");
      return cached;
    }
    try {
      const response = await fetch(
        `${API_ENDPOINTS.TEXT}?key=${apiKey}`,
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: `Translate the following Korean text to English. This is a prompt for image generation, so preserve all descriptive details precisely. Only output the translated text, nothing else.

Korean text:
${koreanText}`
              }]
            }]
          })
        }
      );
      if (!response.ok) {
        throw new Error("\uBC88\uC5ED \uC2E4\uD328");
      }
      const data = await response.json();
      if (data.candidates && data.candidates[0] && data.candidates[0].content) {
        const text = data.candidates[0].content.parts[0].text.trim();
        setCachedTranslation(koreanText, text);
        return text;
      }
      throw new Error("\uBC88\uC5ED \uACB0\uACFC \uC5C6\uC74C");
    } catch (e) {
      console.error("Translation failed:", e);
      throw e;
    }
  }
  function containsKorean(text) {
    const koreanRegex = /[\uAC00-\uD7AF\u1100-\u11FF\u3130-\u318F]/;
    return koreanRegex.test(text);
  }

  // src/js/handlers/generation-handlers.js
  function applyThinkingPrefix(prompt) {
    if (state.thinkingMode) {
      return THINKING_PREFIX + prompt;
    }
    return prompt;
  }
  function updateTranslateStatus(status, message) {
    const statusEl = document.getElementById("translateStatus");
    const textEl = document.getElementById("translateStatusText");
    if (!statusEl || !textEl) return;
    if (status === "hidden") {
      statusEl.classList.add("hidden");
      return;
    }
    statusEl.classList.remove("hidden");
    statusEl.className = "translate-status " + status;
    textEl.textContent = message;
  }
  async function generateImage() {
    if (!state.apiKey) {
      showError("API \uD0A4\uB97C \uBA3C\uC800 \uC124\uC815\uD574\uC8FC\uC138\uC694.");
      window.openSettingsModal();
      return;
    }
    let prompt = buildPrompt(state.currentTemplate, state.fieldValues[state.currentTemplate]);
    if (!prompt || prompt.length < 10) {
      showError("\uD504\uB86C\uD504\uD2B8\uAC00 \uB108\uBB34 \uC9E7\uC2B5\uB2C8\uB2E4. \uB354 \uB9CE\uC740 \uD544\uB4DC\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694.");
      return;
    }
    state.isLoading = true;
    state.error = null;
    hideError();
    renderResult();
    const generateBtn = document.getElementById("generateBtn");
    if (generateBtn) generateBtn.disabled = true;
    try {
      let finalPrompt = prompt;
      let translatedPrompt = "";
      if (state.autoTranslate && containsKorean(prompt)) {
        updateTranslateStatus("translating", "\uBC88\uC5ED \uC911...");
        try {
          translatedPrompt = await translateToEnglish(prompt, state.apiKey);
          finalPrompt = translatedPrompt;
          state.translatedPrompt = translatedPrompt;
          updateTranslateStatus("translated", "\uBC88\uC5ED \uC644\uB8CC");
          updatePromptPreview();
        } catch (e) {
          console.error("Translation failed, using original:", e);
          updateTranslateStatus("error", "\uBC88\uC5ED \uC2E4\uD328, \uC6D0\uBCF8 \uC0AC\uC6A9");
        }
      }
      finalPrompt = applyThinkingPrefix(finalPrompt);
      const image = await callImageApi(finalPrompt, state.apiKey, state.attachedImages);
      state.generatedImage = image;
      const historyItem = {
        id: generateResultId(),
        prompt,
        translatedPrompt,
        image,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      };
      addToResultHistory(historyItem);
      state.selectedResultId = historyItem.id;
      if (window.initEditSession) {
        window.initEditSession(finalPrompt, image);
      }
      if (window.savePromptToHistory) {
        window.savePromptToHistory(prompt, translatedPrompt, state.currentTemplate);
      }
    } catch (e) {
      showError(e.message);
    } finally {
      state.isLoading = false;
      renderResult();
      if (generateBtn) generateBtn.disabled = false;
    }
  }
  function copyPrompt() {
    let textToCopy;
    if (state.promptTab === "translated" && state.translatedPrompt) {
      textToCopy = state.translatedPrompt;
    } else {
      textToCopy = buildPrompt(state.currentTemplate, state.fieldValues[state.currentTemplate]);
    }
    if (!textToCopy) {
      showError("\uBCF5\uC0AC\uD560 \uD504\uB86C\uD504\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");
      return;
    }
    navigator.clipboard.writeText(textToCopy).then(() => {
      const btn = document.querySelector(".prompt-preview-header .btn-icon");
      if (btn) {
        const originalText = btn.textContent;
        btn.textContent = "\u2705";
        setTimeout(() => {
          btn.textContent = originalText;
        }, 1500);
      }
    }).catch((e) => {
      showError("\uD074\uB9BD\uBCF4\uB4DC \uBCF5\uC0AC\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.");
    });
  }
  function handleTranslateToggle(checked) {
    state.autoTranslate = checked;
    state.translatedPrompt = "";
    const promptTabs = document.getElementById("promptTabs");
    if (promptTabs) {
      if (checked) {
        promptTabs.style.display = "flex";
      } else {
        promptTabs.style.display = "none";
        state.promptTab = "original";
        updateTranslateStatus("hidden", "");
      }
    }
    updatePromptPreview();
  }
  function setPromptTab(tab) {
    state.promptTab = tab;
    document.querySelectorAll(".prompt-tab").forEach((btn) => {
      btn.classList.toggle("active", btn.dataset.tab === tab);
    });
    updatePromptPreview();
  }

  // src/js/handlers/modal-handlers.js
  function openSettingsModal() {
    const modal = document.getElementById("settingsModal");
    const apiKeyInput = document.getElementById("apiKeyInput");
    if (modal) modal.classList.add("active");
    if (apiKeyInput) apiKeyInput.value = state.apiKey;
  }
  function closeSettingsModal() {
    const modal = document.getElementById("settingsModal");
    if (modal) modal.classList.remove("active");
  }
  function toggleApiKeyVisibility() {
    const input = document.getElementById("apiKeyInput");
    if (input) {
      input.type = input.type === "password" ? "text" : "password";
    }
  }
  async function testApiConnection(silent = false) {
    const apiKeyInput = document.getElementById("apiKeyInput");
    const apiKey = apiKeyInput ? apiKeyInput.value.trim() : "";
    if (!apiKey) {
      if (!silent) {
        const resultEl = document.getElementById("apiTestResult");
        if (resultEl) {
          resultEl.innerHTML = `
          <div class="error-message">API \uD0A4\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694.</div>
        `;
        }
      }
      return;
    }
    updateApiStatus("testing");
    const testBtn = document.getElementById("testApiBtn");
    if (testBtn) testBtn.disabled = true;
    if (!silent) {
      const resultEl = document.getElementById("apiTestResult");
      if (resultEl) {
        resultEl.innerHTML = `
        <div class="api-status testing">
          <span class="status-dot"></span>
          <span>\uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uC911...</span>
        </div>
      `;
      }
    }
    const isValid = await testApiKey(apiKey);
    if (testBtn) testBtn.disabled = false;
    if (isValid) {
      state.apiKey = apiKey;
      updateApiStatus("connected");
      if (!silent) {
        const resultEl = document.getElementById("apiTestResult");
        if (resultEl) {
          resultEl.innerHTML = `
          <div class="success-message">API \uC5F0\uACB0 \uC131\uACF5!</div>
        `;
        }
      }
    } else {
      updateApiStatus("disconnected");
      if (!silent) {
        const resultEl = document.getElementById("apiTestResult");
        if (resultEl) {
          resultEl.innerHTML = `
          <div class="error-message">API \uC5F0\uACB0 \uC2E4\uD328. \uD0A4\uB97C \uD655\uC778\uD574\uC8FC\uC138\uC694.</div>
        `;
        }
      }
    }
  }
  function saveApiKey() {
    const apiKeyInput = document.getElementById("apiKeyInput");
    const apiKey = apiKeyInput ? apiKeyInput.value.trim() : "";
    state.apiKey = apiKey;
    saveToStorage();
    if (apiKey) {
      testApiConnection(true);
    } else {
      updateApiStatus("disconnected");
    }
    closeSettingsModal();
  }
  function updateApiStatus(status) {
    state.apiStatus = status;
    const statusEl = document.getElementById("apiStatus");
    const textEl = document.getElementById("apiStatusText");
    if (!statusEl || !textEl) return;
    statusEl.className = "api-status " + status;
    switch (status) {
      case "connected":
        textEl.textContent = "API \uC5F0\uACB0\uB428";
        break;
      case "testing":
        textEl.textContent = "\uD14C\uC2A4\uD2B8 \uC911...";
        break;
      default:
        textEl.textContent = "API \uBBF8\uC5F0\uACB0";
    }
  }
  function openImageModal(index) {
    if (index < 0 || index >= state.resultHistory.length) return;
    state.imageModalIndex = index;
    const item = state.resultHistory[index];
    const modalImg = document.getElementById("imageModalImg");
    const modalInfo = document.getElementById("imageModalInfo");
    const modal = document.getElementById("imageModal");
    if (modalImg) {
      modalImg.src = `data:${item.image.mimeType};base64,${item.image.data}`;
    }
    if (modalInfo) {
      let info = "";
      if (item.prompt) {
        info = item.prompt.substring(0, 200);
        if (item.prompt.length > 200) info += "...";
      }
      modalInfo.textContent = info;
    }
    if (modal) modal.classList.add("active");
  }
  function closeImageModal() {
    const modal = document.getElementById("imageModal");
    if (modal) modal.classList.remove("active");
    state.imageModalIndex = -1;
  }
  function navigateImageModal(direction) {
    if (state.imageModalIndex < 0) return;
    const newIndex = state.imageModalIndex + direction;
    if (newIndex >= 0 && newIndex < state.resultHistory.length) {
      openImageModal(newIndex);
    }
  }
  function downloadModalImage() {
    if (state.imageModalIndex < 0 || state.imageModalIndex >= state.resultHistory.length) return;
    const item = state.resultHistory[state.imageModalIndex];
    const link = document.createElement("a");
    link.href = `data:${item.image.mimeType};base64,${item.image.data}`;
    link.download = `nano-banana-${Date.now()}.png`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
  function reusePrompt() {
    if (state.imageModalIndex < 0 || state.imageModalIndex >= state.resultHistory.length) return;
    const item = state.resultHistory[state.imageModalIndex];
    closeImageModal();
    navigator.clipboard.writeText(item.prompt).then(() => {
      showError("\uD504\uB86C\uD504\uD2B8\uAC00 \uD074\uB9BD\uBCF4\uB4DC\uC5D0 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uD544\uB4DC\uC5D0 \uBD99\uC5EC\uB123\uAE30 \uD558\uC138\uC694.");
      setTimeout(hideError, 3e3);
    });
  }

  // src/js/handlers/edit-handlers.js
  function startNewSession() {
    state.editSession = {
      sessionId: generateSessionId(),
      basePrompt: "",
      editHistory: [],
      currentEditIndex: -1
    };
    const requestInput = document.getElementById("editRequestInput");
    if (requestInput) requestInput.value = "";
    renderEditSession();
  }
  function initEditSession(prompt, image) {
    if (!state.editSession.sessionId) {
      state.editSession.sessionId = generateSessionId();
    }
    state.editSession.basePrompt = prompt;
    const historyItem = {
      id: "edit_" + Date.now(),
      step: 1,
      request: "\uC6D0\uBCF8 \uC0DD\uC131",
      prompt,
      image,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    };
    state.editSession.editHistory = [historyItem];
    state.editSession.currentEditIndex = 0;
    renderEditSession();
  }
  function addEditHistory(request, prompt, image) {
    const step = state.editSession.editHistory.length + 1;
    const historyItem = {
      id: "edit_" + Date.now(),
      step,
      request,
      prompt,
      image,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    };
    state.editSession.editHistory.push(historyItem);
    state.editSession.currentEditIndex = state.editSession.editHistory.length - 1;
    renderEditSession();
  }
  function selectEditHistoryItem(index) {
    if (index >= 0 && index < state.editSession.editHistory.length) {
      state.editSession.currentEditIndex = index;
      const item = state.editSession.editHistory[index];
      state.generatedImage = item.image;
      renderEditSession();
      renderResult();
    }
  }
  function clearEditRequest() {
    const requestInput = document.getElementById("editRequestInput");
    if (requestInput) requestInput.value = "";
  }
  async function applyEditRequest() {
    const requestInput = document.getElementById("editRequestInput");
    const editRequest = requestInput ? requestInput.value.trim() : "";
    if (!editRequest) {
      showError("\uC218\uC815 \uC694\uCCAD\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.");
      return;
    }
    if (!state.apiKey) {
      showError("API \uD0A4\uB97C \uBA3C\uC800 \uC124\uC815\uD574\uC8FC\uC138\uC694.");
      window.openSettingsModal();
      return;
    }
    if (state.editSession.editHistory.length === 0) {
      showError("\uBA3C\uC800 \uC774\uBBF8\uC9C0\uB97C \uC0DD\uC131\uD574\uC8FC\uC138\uC694.");
      return;
    }
    const currentItem = state.editSession.editHistory[state.editSession.currentEditIndex];
    const editPrompt = `Based on the previous image, please modify it according to this request: ${editRequest}

Previous prompt for context: ${currentItem.prompt}`;
    state.isLoading = true;
    state.error = null;
    hideError();
    renderResult();
    const applyBtn = document.getElementById("applyEditBtn");
    if (applyBtn) applyBtn.disabled = true;
    try {
      let finalPrompt = applyThinkingPrefix(editPrompt);
      if (state.autoTranslate && containsKorean(finalPrompt)) {
        updateTranslateStatus("translating", "\uBC88\uC5ED \uC911...");
        try {
          const translated = await translateToEnglish(finalPrompt, state.apiKey);
          finalPrompt = translated;
          updateTranslateStatus("translated", "\uBC88\uC5ED \uC644\uB8CC");
        } catch (e) {
          console.error("Translation failed, using original:", e);
          updateTranslateStatus("error", "\uBC88\uC5ED \uC2E4\uD328, \uC6D0\uBCF8 \uC0AC\uC6A9");
        }
      }
      const attachments = [{
        base64: currentItem.image.data
      }];
      const image = await callImageApi(finalPrompt, state.apiKey, attachments);
      state.generatedImage = image;
      addEditHistory(editRequest, finalPrompt, image);
      const historyItem = {
        id: generateResultId(),
        prompt: finalPrompt,
        translatedPrompt: "",
        image,
        timestamp: (/* @__PURE__ */ new Date()).toISOString()
      };
      state.resultHistory.push(historyItem);
      state.selectedResultId = historyItem.id;
      if (requestInput) requestInput.value = "";
    } catch (e) {
      showError(e.message);
    } finally {
      state.isLoading = false;
      renderResult();
      if (applyBtn) applyBtn.disabled = false;
    }
  }
  function setPresetCategory(categoryId) {
    state.presetCategory = categoryId;
    renderPresets();
  }
  async function applyPreset(presetId) {
    const category = QUICK_PRESETS[state.presetCategory];
    if (!category) return;
    const preset = category.presets.find((p) => p.id === presetId);
    if (!preset) return;
    const requestInput = document.getElementById("editRequestInput");
    if (requestInput) {
      requestInput.value = preset.prompt;
    }
    await applyEditRequest();
  }
  function toggleThinkingMode() {
    state.thinkingMode = !state.thinkingMode;
    const toggle = document.getElementById("thinkingToggle");
    const checkbox = document.getElementById("thinkingCheckbox");
    if (state.thinkingMode) {
      if (toggle) toggle.classList.add("active");
      if (checkbox) checkbox.checked = true;
    } else {
      if (toggle) toggle.classList.remove("active");
      if (checkbox) checkbox.checked = false;
    }
    try {
      localStorage.setItem("nano_banana_thinking_mode", state.thinkingMode ? "true" : "false");
    } catch (e) {
      console.error("Failed to save thinking mode:", e);
    }
  }
  function loadThinkingMode() {
    try {
      const saved = localStorage.getItem("nano_banana_thinking_mode");
      if (saved === "true") {
        state.thinkingMode = true;
        const toggle = document.getElementById("thinkingToggle");
        const checkbox = document.getElementById("thinkingCheckbox");
        if (toggle) toggle.classList.add("active");
        if (checkbox) checkbox.checked = true;
      }
    } catch (e) {
      console.error("Failed to load thinking mode:", e);
    }
  }

  // src/js/features/prompt-history.js
  var MAX_PROMPT_HISTORY = 100;
  function savePromptToHistory(prompt, translatedPrompt, templateId) {
    const historyItem = {
      id: "ph_" + Date.now(),
      prompt,
      translatedPrompt: translatedPrompt || "",
      templateId,
      timestamp: (/* @__PURE__ */ new Date()).toISOString()
    };
    state.promptHistory = state.promptHistory.filter((h) => h.prompt !== prompt);
    state.promptHistory.unshift(historyItem);
    if (state.promptHistory.length > MAX_PROMPT_HISTORY) {
      state.promptHistory = state.promptHistory.slice(0, MAX_PROMPT_HISTORY);
    }
    savePromptHistory();
  }
  function savePromptHistory() {
    try {
      localStorage.setItem(STORAGE_KEYS.PROMPT_HISTORY, JSON.stringify(state.promptHistory));
    } catch (e) {
      console.error("Failed to save prompt history:", e);
      if (e.name === "QuotaExceededError") {
        state.promptHistory = state.promptHistory.slice(0, 50);
        savePromptHistory();
      }
    }
  }
  function loadPromptHistory() {
    try {
      const saved = localStorage.getItem(STORAGE_KEYS.PROMPT_HISTORY);
      if (saved) {
        state.promptHistory = JSON.parse(saved);
      }
    } catch (e) {
      console.error("Failed to load prompt history:", e);
      state.promptHistory = [];
    }
  }
  function openPromptHistory() {
    const modal = document.getElementById("promptHistoryModal");
    state.promptHistorySearch = "";
    renderPromptHistory();
    if (modal) modal.classList.add("active");
  }
  function closePromptHistory() {
    const modal = document.getElementById("promptHistoryModal");
    if (modal) modal.classList.remove("active");
  }
  function renderPromptHistory() {
    const container = document.getElementById("promptHistoryList");
    const searchInput = document.getElementById("promptHistorySearch");
    if (!container) return;
    if (searchInput) {
      searchInput.value = state.promptHistorySearch;
    }
    let filteredHistory = state.promptHistory;
    if (state.promptHistorySearch) {
      const searchLower = state.promptHistorySearch.toLowerCase();
      filteredHistory = state.promptHistory.filter(
        (h) => h.prompt.toLowerCase().includes(searchLower) || h.translatedPrompt && h.translatedPrompt.toLowerCase().includes(searchLower)
      );
    }
    if (filteredHistory.length === 0) {
      container.innerHTML = `
      <div class="empty-history">
        ${state.promptHistory.length === 0 ? "\uC800\uC7A5\uB41C \uD504\uB86C\uD504\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4." : "\uAC80\uC0C9 \uACB0\uACFC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."}
      </div>
    `;
      return;
    }
    container.innerHTML = filteredHistory.map((item) => `
    <div class="history-item">
      <div class="history-item-content">
        <div class="history-prompt">${escapeHtml(item.prompt.substring(0, 150))}${item.prompt.length > 150 ? "..." : ""}</div>
        ${item.translatedPrompt ? `
          <div class="history-translated">\u{1F310} ${escapeHtml(item.translatedPrompt.substring(0, 100))}...</div>
        ` : ""}
        <div class="history-meta">
          <span class="history-template">${getTemplateName(item.templateId)}</span>
          <span class="history-time">${formatRelativeTime(item.timestamp)}</span>
        </div>
      </div>
      <div class="history-item-actions">
        <button class="btn btn-outline btn-sm" onclick="restorePromptFromHistory('${item.id}')" title="\uBCF5\uC6D0">
          \u21A9\uFE0F
        </button>
        <button class="btn btn-outline btn-sm" onclick="copyPromptFromHistory('${item.id}')" title="\uBCF5\uC0AC">
          \u{1F4CB}
        </button>
        <button class="btn btn-outline btn-sm" onclick="deletePromptFromHistory('${item.id}')" title="\uC0AD\uC81C">
          \u{1F5D1}\uFE0F
        </button>
      </div>
    </div>
  `).join("");
  }
  function searchPromptHistory(query) {
    state.promptHistorySearch = query;
    renderPromptHistory();
  }
  function restorePromptFromHistory(historyId) {
    const item = state.promptHistory.find((h) => h.id === historyId);
    if (!item) return;
    if (item.templateId && (TEMPLATES[item.templateId] || state.customTemplates[item.templateId])) {
      handleTemplateChange(item.templateId);
    }
    navigator.clipboard.writeText(item.prompt).then(() => {
      closePromptHistory();
      showError("\uD504\uB86C\uD504\uD2B8\uAC00 \uD074\uB9BD\uBCF4\uB4DC\uC5D0 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uD544\uB4DC\uC5D0 \uBD99\uC5EC\uB123\uAE30 \uD558\uC138\uC694.");
      setTimeout(hideError, 3e3);
    });
  }
  function copyPromptFromHistory(historyId) {
    const item = state.promptHistory.find((h) => h.id === historyId);
    if (!item) return;
    navigator.clipboard.writeText(item.prompt).then(() => {
      showError("\uD504\uB86C\uD504\uD2B8\uAC00 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");
      setTimeout(hideError, 2e3);
    });
  }
  function deletePromptFromHistory(historyId) {
    state.promptHistory = state.promptHistory.filter((h) => h.id !== historyId);
    savePromptHistory();
    renderPromptHistory();
  }
  function clearAllPromptHistory() {
    if (!confirm("\uBAA8\uB4E0 \uD504\uB86C\uD504\uD2B8 \uD788\uC2A4\uD1A0\uB9AC\uB97C \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")) return;
    state.promptHistory = [];
    savePromptHistory();
    renderPromptHistory();
  }
  function getTemplateName(templateId) {
    if (TEMPLATES[templateId]) return TEMPLATES[templateId].name;
    if (state.customTemplates[templateId]) return state.customTemplates[templateId].name;
    return "\uC54C \uC218 \uC5C6\uC74C";
  }

  // src/js/features/canvas-generator.js
  var ASPECT_RATIO_PRESETS = [
    { value: "1:1", label: "1:1", width: 1, height: 1 },
    { value: "3:4", label: "3:4", width: 3, height: 4 },
    { value: "4:3", label: "4:3", width: 4, height: 3 },
    { value: "9:16", label: "9:16", width: 9, height: 16 },
    { value: "16:9", label: "16:9", width: 16, height: 9 },
    { value: "21:9", label: "21:9", width: 21, height: 9 },
    { value: "2:3", label: "2:3", width: 2, height: 3 },
    { value: "3:2", label: "3:2", width: 3, height: 2 },
    { value: "4:5", label: "4:5", width: 4, height: 5 },
    { value: "custom", label: "\uCEE4\uC2A4\uD140", width: null, height: null }
  ];
  function openCanvasGenerator() {
    const modal = document.getElementById("canvasGeneratorModal");
    renderAspectRatioButtons();
    renderCanvasPreview();
    updateCanvasSizeInputs();
    if (modal) modal.classList.add("active");
  }
  function closeCanvasGenerator() {
    const modal = document.getElementById("canvasGeneratorModal");
    if (modal) modal.classList.remove("active");
  }
  function setCanvasAspectRatio(ratio) {
    state.canvasSettings.aspectRatio = ratio;
    if (ratio !== "custom") {
      const preset = ASPECT_RATIO_PRESETS.find((p) => p.value === ratio);
      if (preset) {
        calculateCanvasSize(preset.width, preset.height);
      }
    }
    renderAspectRatioButtons();
    renderCanvasPreview();
    updateCanvasSizeInputs();
  }
  function calculateCanvasSize(ratioW, ratioH) {
    const baseSize = state.canvasSettings.baseSize;
    if (ratioW > ratioH) {
      state.canvasSettings.customWidth = baseSize;
      state.canvasSettings.customHeight = Math.round(baseSize * ratioH / ratioW);
    } else {
      state.canvasSettings.customHeight = baseSize;
      state.canvasSettings.customWidth = Math.round(baseSize * ratioW / ratioH);
    }
  }
  function setCanvasBaseSize(size) {
    state.canvasSettings.baseSize = parseInt(size) || 1024;
    if (state.canvasSettings.aspectRatio !== "custom") {
      const preset = ASPECT_RATIO_PRESETS.find((p) => p.value === state.canvasSettings.aspectRatio);
      if (preset && preset.width) {
        calculateCanvasSize(preset.width, preset.height);
      }
    }
    renderCanvasPreview();
    updateCanvasSizeInputs();
  }
  function setCanvasCustomSize(width, height) {
    state.canvasSettings.customWidth = parseInt(width) || 1024;
    state.canvasSettings.customHeight = parseInt(height) || 1024;
    state.canvasSettings.aspectRatio = "custom";
    renderAspectRatioButtons();
    renderCanvasPreview();
  }
  function setCanvasBackgroundType(type) {
    state.canvasSettings.backgroundType = type;
    if (type === "white") {
      state.canvasSettings.backgroundColor = "#FFFFFF";
    } else if (type === "transparent") {
      state.canvasSettings.backgroundColor = "transparent";
    }
    renderCanvasPreview();
  }
  function setCanvasBackgroundColor(color) {
    state.canvasSettings.backgroundColor = color;
    state.canvasSettings.backgroundType = "custom";
    renderCanvasPreview();
  }
  function renderAspectRatioButtons() {
    const container = document.getElementById("aspectRatioButtons");
    if (!container) return;
    container.innerHTML = ASPECT_RATIO_PRESETS.map((preset) => `
    <button class="aspect-ratio-btn ${state.canvasSettings.aspectRatio === preset.value ? "active" : ""}"
            onclick="setCanvasAspectRatio('${preset.value}')">
      <span class="ratio-preview" style="${getRatioPreviewStyle(preset)}"></span>
      <span class="ratio-label">${preset.label}</span>
    </button>
  `).join("");
  }
  function getRatioPreviewStyle(preset) {
    if (preset.value === "custom") {
      return "width: 20px; height: 20px; border: 1px dashed var(--color-text-muted);";
    }
    const maxSize = 30;
    let w, h;
    if (preset.width > preset.height) {
      w = maxSize;
      h = Math.round(maxSize * preset.height / preset.width);
    } else {
      h = maxSize;
      w = Math.round(maxSize * preset.width / preset.height);
    }
    return `width: ${w}px; height: ${h}px; background: var(--color-border);`;
  }
  function updateCanvasSizeInputs() {
    const widthInput = document.getElementById("canvasWidth");
    const heightInput = document.getElementById("canvasHeight");
    if (widthInput) widthInput.value = state.canvasSettings.customWidth;
    if (heightInput) heightInput.value = state.canvasSettings.customHeight;
  }
  function renderCanvasPreview() {
    const canvas = document.getElementById("canvasPreview");
    const infoEl = document.getElementById("canvasInfo");
    if (!canvas || !infoEl) return;
    const ctx = canvas.getContext("2d");
    const width = state.canvasSettings.customWidth;
    const height = state.canvasSettings.customHeight;
    const maxPreviewSize = 200;
    let previewWidth, previewHeight;
    if (width > height) {
      previewWidth = maxPreviewSize;
      previewHeight = Math.round(maxPreviewSize * height / width);
    } else {
      previewHeight = maxPreviewSize;
      previewWidth = Math.round(maxPreviewSize * width / height);
    }
    canvas.width = previewWidth;
    canvas.height = previewHeight;
    if (state.canvasSettings.backgroundType === "transparent") {
      const tileSize = 10;
      for (let y = 0; y < previewHeight; y += tileSize) {
        for (let x = 0; x < previewWidth; x += tileSize) {
          ctx.fillStyle = (x + y) / tileSize % 2 === 0 ? "#FFFFFF" : "#CCCCCC";
          ctx.fillRect(x, y, tileSize, tileSize);
        }
      }
    } else {
      ctx.fillStyle = state.canvasSettings.backgroundColor;
      ctx.fillRect(0, 0, previewWidth, previewHeight);
    }
    ctx.strokeStyle = "#CCCCCC";
    ctx.strokeRect(0, 0, previewWidth, previewHeight);
    infoEl.textContent = `${width} \xD7 ${height}px`;
  }
  async function generateAndAttachCanvas() {
    const width = state.canvasSettings.customWidth;
    const height = state.canvasSettings.customHeight;
    const canvas = document.createElement("canvas");
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext("2d");
    if (state.canvasSettings.backgroundType === "transparent") {
      ctx.clearRect(0, 0, width, height);
    } else {
      ctx.fillStyle = state.canvasSettings.backgroundColor;
      ctx.fillRect(0, 0, width, height);
    }
    const blob = await new Promise((resolve) => {
      canvas.toBlob(resolve, "image/png");
    });
    const file = new File([blob], `canvas-${width}x${height}.png`, { type: "image/png" });
    await addImages([file]);
    closeCanvasGenerator();
    showError(`${width}\xD7${height} \uCE94\uBC84\uC2A4\uAC00 \uCCA8\uBD80\uB418\uC5C8\uC2B5\uB2C8\uB2E4.`);
    setTimeout(hideError, 2e3);
  }

  // src/js/features/custom-templates.js
  function saveCustomTemplates() {
    try {
      localStorage.setItem(STORAGE_KEYS.CUSTOM_TEMPLATES, JSON.stringify(state.customTemplates));
    } catch (e) {
      console.error("Failed to save custom templates:", e);
      showError("\uD15C\uD50C\uB9BF \uC800\uC7A5\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. \uC800\uC7A5 \uACF5\uAC04\uC774 \uBD80\uC871\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4.");
    }
  }
  function loadCustomTemplates() {
    try {
      const saved = localStorage.getItem(STORAGE_KEYS.CUSTOM_TEMPLATES);
      if (saved) {
        state.customTemplates = JSON.parse(saved);
        Object.keys(state.customTemplates).forEach((templateId) => {
          if (!state.fieldValues[templateId]) {
            initializeCustomTemplateFieldValues(templateId, state.customTemplates[templateId]);
          }
        });
      }
    } catch (e) {
      console.error("Failed to load custom templates:", e);
    }
  }
  function initFieldValue(templateId, field) {
    if (field.defaultValue !== void 0) {
      state.fieldValues[templateId][field.id] = field.defaultValue;
    } else if (field.type === "checkbox-group") {
      state.fieldValues[templateId][field.id] = [];
    } else if (field.type === "checkbox") {
      state.fieldValues[templateId][field.id] = false;
    } else {
      state.fieldValues[templateId][field.id] = "";
    }
  }
  function openTemplateEditor(templateId = null) {
    const modal = document.getElementById("templateEditorModal");
    if (!modal) return;
    if (templateId && state.customTemplates[templateId]) {
      state.editingTemplate = templateId;
      const template = state.customTemplates[templateId];
      document.getElementById("templateName").value = template.name;
      document.getElementById("templateIcon").value = template.icon;
      document.getElementById("templateCategory").value = template.category || "custom";
      document.getElementById("templateDescription").value = template.description || "";
      document.getElementById("templatePrompt").value = template.promptTemplate;
      state.templateEditorFields = JSON.parse(JSON.stringify(template.fields));
    } else {
      state.editingTemplate = null;
      document.getElementById("templateName").value = "";
      document.getElementById("templateIcon").value = "\u{1F3A8}";
      document.getElementById("templateCategory").value = "custom";
      document.getElementById("templateDescription").value = "";
      document.getElementById("templatePrompt").value = "";
      state.templateEditorFields = [];
    }
    renderTemplateEditorFields();
    modal.classList.add("active");
  }
  function closeTemplateEditor() {
    const modal = document.getElementById("templateEditorModal");
    if (modal) modal.classList.remove("active");
    state.editingTemplate = null;
    state.templateEditorFields = [];
  }
  function addEditorField() {
    const newField = {
      id: "field_" + Date.now(),
      label: "\uC0C8 \uD544\uB4DC",
      type: "text",
      placeholder: "",
      helpText: "",
      required: false,
      options: []
    };
    state.templateEditorFields.push(newField);
    renderTemplateEditorFields();
  }
  function deleteEditorField(index) {
    state.templateEditorFields.splice(index, 1);
    renderTemplateEditorFields();
  }
  function moveEditorField(index, direction) {
    const newIndex = index + direction;
    if (newIndex < 0 || newIndex >= state.templateEditorFields.length) return;
    const temp = state.templateEditorFields[index];
    state.templateEditorFields[index] = state.templateEditorFields[newIndex];
    state.templateEditorFields[newIndex] = temp;
    renderTemplateEditorFields();
  }
  function updateEditorField(index, property, value) {
    state.templateEditorFields[index][property] = value;
    if (property === "label" && !state.templateEditorFields[index].idManuallySet) {
      state.templateEditorFields[index].id = value.toLowerCase().replace(/[^a-z0-9가-힣]/g, "_").replace(/_+/g, "_").replace(/^_|_$/g, "") || "field_" + Date.now();
    }
    renderTemplateEditorFields();
  }
  function addFieldOption(fieldIndex) {
    if (!state.templateEditorFields[fieldIndex].options) {
      state.templateEditorFields[fieldIndex].options = [];
    }
    state.templateEditorFields[fieldIndex].options.push({
      value: "",
      label: ""
    });
    renderTemplateEditorFields();
  }
  function deleteFieldOption(fieldIndex, optionIndex) {
    state.templateEditorFields[fieldIndex].options.splice(optionIndex, 1);
    renderTemplateEditorFields();
  }
  function getFieldTypeName(type) {
    const names = {
      "text": "\uD14D\uC2A4\uD2B8",
      "textarea": "\uC601\uC5ED",
      "select": "\uC120\uD0DD",
      "checkbox": "\uCCB4\uD06C",
      "checkbox-group": "\uADF8\uB8F9"
    };
    return names[type] || type;
  }
  function renderTemplateEditorFields() {
    const container = document.getElementById("templateFieldsEditor");
    const placeholdersContainer = document.getElementById("fieldPlaceholders");
    if (!container) return;
    if (state.templateEditorFields.length === 0) {
      container.innerHTML = '<div class="empty-fields-message">\uD544\uB4DC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4. "\uD544\uB4DC \uCD94\uAC00" \uBC84\uD2BC\uC744 \uD074\uB9AD\uD558\uC138\uC694.</div>';
      if (placeholdersContainer) placeholdersContainer.innerHTML = "";
      return;
    }
    container.innerHTML = state.templateEditorFields.map((field, index) => `
    <div class="editor-field-item">
      <div class="editor-field-header">
        <span class="field-drag-handle">\u22EE\u22EE</span>
        <span class="field-type-badge">${getFieldTypeName(field.type)}</span>
        <span class="field-label-preview">{${field.id}}</span>
        <div class="field-actions">
          <button class="btn btn-outline btn-sm" onclick="moveEditorField(${index}, -1)" ${index === 0 ? "disabled" : ""}>\u25B2</button>
          <button class="btn btn-outline btn-sm" onclick="moveEditorField(${index}, 1)" ${index === state.templateEditorFields.length - 1 ? "disabled" : ""}>\u25BC</button>
          <button class="btn btn-outline btn-sm btn-danger" onclick="deleteEditorField(${index})">\u{1F5D1}\uFE0F</button>
        </div>
      </div>
      <div class="editor-field-body">
        <div class="field-row">
          <div class="field-col">
            <label>\uB77C\uBCA8</label>
            <input type="text" class="form-input" value="${escapeHtml(field.label)}"
                   oninput="updateEditorField(${index}, 'label', this.value)">
          </div>
          <div class="field-col">
            <label>ID</label>
            <input type="text" class="form-input" value="${escapeHtml(field.id)}"
                   oninput="updateEditorField(${index}, 'id', this.value); state.templateEditorFields[${index}].idManuallySet = true;">
          </div>
          <div class="field-col">
            <label>\uD0C0\uC785</label>
            <select class="form-select" onchange="updateEditorField(${index}, 'type', this.value)">
              <option value="text" ${field.type === "text" ? "selected" : ""}>\uD14D\uC2A4\uD2B8</option>
              <option value="textarea" ${field.type === "textarea" ? "selected" : ""}>\uD14D\uC2A4\uD2B8\uC601\uC5ED</option>
              <option value="select" ${field.type === "select" ? "selected" : ""}>\uC120\uD0DD</option>
              <option value="checkbox" ${field.type === "checkbox" ? "selected" : ""}>\uCCB4\uD06C\uBC15\uC2A4</option>
              <option value="checkbox-group" ${field.type === "checkbox-group" ? "selected" : ""}>\uCCB4\uD06C\uBC15\uC2A4 \uADF8\uB8F9</option>
            </select>
          </div>
        </div>
        <div class="field-row">
          <div class="field-col">
            <label>Placeholder</label>
            <input type="text" class="form-input" value="${escapeHtml(field.placeholder || "")}"
                   oninput="updateEditorField(${index}, 'placeholder', this.value)">
          </div>
          <div class="field-col-sm">
            <label>\uD544\uC218</label>
            <input type="checkbox" ${field.required ? "checked" : ""}
                   onchange="updateEditorField(${index}, 'required', this.checked)">
          </div>
        </div>
        <div class="field-row">
          <div class="field-col">
            <label>\uB3C4\uC6C0\uB9D0</label>
            <input type="text" class="form-input" value="${escapeHtml(field.helpText || "")}"
                   oninput="updateEditorField(${index}, 'helpText', this.value)">
          </div>
        </div>
        ${field.type === "select" || field.type === "checkbox-group" ? `
          <div class="field-options">
            <label>\uC635\uC158</label>
            ${(field.options || []).map((opt, optIndex) => `
              <div class="option-row">
                <input type="text" class="form-input" placeholder="\uAC12" value="${escapeHtml(opt.value)}"
                       oninput="state.templateEditorFields[${index}].options[${optIndex}].value = this.value">
                <input type="text" class="form-input" placeholder="\uB77C\uBCA8" value="${escapeHtml(opt.label)}"
                       oninput="state.templateEditorFields[${index}].options[${optIndex}].label = this.value">
                <button class="btn btn-outline btn-sm" onclick="deleteFieldOption(${index}, ${optIndex})">\xD7</button>
              </div>
            `).join("")}
            <button class="btn btn-outline btn-sm" onclick="addFieldOption(${index})">+ \uC635\uC158 \uCD94\uAC00</button>
          </div>
        ` : ""}
      </div>
    </div>
  `).join("");
    if (placeholdersContainer) {
      placeholdersContainer.innerHTML = state.templateEditorFields.map((field) => `
      <button class="field-placeholder-btn" onclick="insertFieldPlaceholder('${field.id}')">{${field.id}}</button>
    `).join("");
    }
  }
  function insertFieldPlaceholder(fieldId) {
    const textarea = document.getElementById("templatePrompt");
    if (!textarea) return;
    const placeholder = `{${fieldId}}`;
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const text = textarea.value;
    textarea.value = text.substring(0, start) + placeholder + text.substring(end);
    textarea.focus();
    textarea.selectionStart = textarea.selectionEnd = start + placeholder.length;
  }
  function saveTemplate() {
    const name = document.getElementById("templateName").value.trim();
    const icon = document.getElementById("templateIcon").value.trim() || "\u{1F3A8}";
    const category = document.getElementById("templateCategory").value;
    const description = document.getElementById("templateDescription").value.trim();
    const promptTemplate = document.getElementById("templatePrompt").value.trim();
    if (!name) {
      showError("\uD15C\uD50C\uB9BF \uC774\uB984\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.");
      return;
    }
    if (state.templateEditorFields.length === 0) {
      showError("\uCD5C\uC18C 1\uAC1C\uC758 \uD544\uB4DC\uAC00 \uD544\uC694\uD569\uB2C8\uB2E4.");
      return;
    }
    if (!promptTemplate) {
      showError("\uD504\uB86C\uD504\uD2B8 \uD15C\uD50C\uB9BF\uC744 \uC785\uB825\uD574\uC8FC\uC138\uC694.");
      return;
    }
    const templateId = state.editingTemplate || generateCustomTemplateId();
    const template = {
      id: templateId,
      name,
      icon,
      category,
      description,
      isCustom: true,
      createdAt: state.editingTemplate ? state.customTemplates[templateId].createdAt : (/* @__PURE__ */ new Date()).toISOString(),
      updatedAt: (/* @__PURE__ */ new Date()).toISOString(),
      fields: state.templateEditorFields.map((f) => ({
        id: f.id,
        label: f.label,
        type: f.type,
        placeholder: f.placeholder || "",
        helpText: f.helpText || "",
        required: f.required || false,
        options: f.options || []
      })),
      promptTemplate
    };
    state.customTemplates[templateId] = template;
    state.fieldValues[templateId] = {};
    template.fields.forEach((field) => {
      initFieldValue(templateId, field);
    });
    saveCustomTemplates();
    closeTemplateEditor();
    renderTemplateTabs();
    handleTemplateChange(templateId);
    showError(state.editingTemplate ? "\uD15C\uD50C\uB9BF\uC774 \uC218\uC815\uB418\uC5C8\uC2B5\uB2C8\uB2E4." : "\uD15C\uD50C\uB9BF\uC774 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");
    setTimeout(hideError, 2e3);
  }
  function duplicateTemplate(templateId) {
    let sourceTemplate;
    if (TEMPLATES[templateId]) {
      sourceTemplate = TEMPLATES[templateId];
    } else if (state.customTemplates[templateId]) {
      sourceTemplate = state.customTemplates[templateId];
    } else {
      showError("\uD15C\uD50C\uB9BF\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
      return;
    }
    const newId = generateCustomTemplateId();
    const newTemplate = {
      ...JSON.parse(JSON.stringify(sourceTemplate)),
      id: newId,
      name: sourceTemplate.name + " (\uBCF5\uC0AC\uBCF8)",
      isCustom: true,
      createdAt: (/* @__PURE__ */ new Date()).toISOString(),
      updatedAt: (/* @__PURE__ */ new Date()).toISOString()
    };
    state.customTemplates[newId] = newTemplate;
    state.fieldValues[newId] = {};
    newTemplate.fields.forEach((field) => {
      initFieldValue(newId, field);
    });
    saveCustomTemplates();
    renderTemplateTabs();
    showError("\uD15C\uD50C\uB9BF\uC774 \uBCF5\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");
    setTimeout(hideError, 2e3);
  }
  function deleteCustomTemplate(templateId) {
    if (!state.customTemplates[templateId]) {
      showError("\uC0AD\uC81C\uD560 \uD15C\uD50C\uB9BF\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
      return;
    }
    if (!confirm(`"${state.customTemplates[templateId].name}" \uD15C\uD50C\uB9BF\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?`)) {
      return;
    }
    delete state.customTemplates[templateId];
    delete state.fieldValues[templateId];
    if (state.currentTemplate === templateId) {
      state.currentTemplate = "basic";
    }
    saveCustomTemplates();
    renderTemplateTabs();
    renderTemplateFields();
    showError("\uD15C\uD50C\uB9BF\uC774 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4.");
    setTimeout(hideError, 2e3);
  }
  function exportTemplate(templateId) {
    const template = state.customTemplates[templateId];
    if (!template) {
      showError("\uD15C\uD50C\uB9BF\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
      return;
    }
    const exportData = JSON.stringify(template, null, 2);
    const blob = new Blob([exportData], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = `template-${template.name.replace(/[^a-z0-9가-힣]/gi, "-")}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  }

  // src/js/features/responsive.js
  var activePanel = "builder";
  var MOBILE_BREAKPOINT = 767;
  function isMobile() {
    return window.innerWidth <= MOBILE_BREAKPOINT;
  }
  function setActivePanel(panelId) {
    activePanel = panelId;
    const panels = document.querySelectorAll(".main-3col > .panel");
    panels.forEach((panel, index) => {
      const panelIds = ["attach", "builder", "result"];
      if (panelIds[index] === panelId) {
        panel.classList.add("mobile-active");
      } else {
        panel.classList.remove("mobile-active");
      }
    });
    const navBtns = document.querySelectorAll(".mobile-nav-btn");
    navBtns.forEach((btn) => {
      if (btn.dataset.panel === panelId) {
        btn.classList.add("active");
      } else {
        btn.classList.remove("active");
      }
    });
  }
  function initResponsive() {
    handleResize();
    window.addEventListener("resize", handleResize);
    setupMobileNavigation();
    setupSwipeGestures();
  }
  function handleResize() {
    const mobile = isMobile();
    if (mobile) {
      setActivePanel(activePanel);
    } else {
      const panels = document.querySelectorAll(".main-3col > .panel");
      panels.forEach((panel) => {
        panel.classList.remove("mobile-active");
      });
    }
  }
  function setupMobileNavigation() {
    const navBtns = document.querySelectorAll(".mobile-nav-btn");
    navBtns.forEach((btn) => {
      btn.addEventListener("click", () => {
        const panelId = btn.dataset.panel;
        setActivePanel(panelId);
      });
    });
  }
  function setupSwipeGestures() {
    let touchStartX = 0;
    let touchEndX = 0;
    const SWIPE_THRESHOLD = 50;
    const mainArea = document.querySelector(".main-3col");
    if (!mainArea) return;
    mainArea.addEventListener("touchstart", (e) => {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });
    mainArea.addEventListener("touchend", (e) => {
      if (!isMobile()) return;
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    }, { passive: true });
    function handleSwipe() {
      const diff = touchStartX - touchEndX;
      const panelOrder = ["attach", "builder", "result"];
      const currentIndex = panelOrder.indexOf(activePanel);
      if (Math.abs(diff) < SWIPE_THRESHOLD) return;
      if (diff > 0) {
        if (currentIndex < panelOrder.length - 1) {
          setActivePanel(panelOrder[currentIndex + 1]);
        }
      } else {
        if (currentIndex > 0) {
          setActivePanel(panelOrder[currentIndex - 1]);
        }
      }
    }
  }
  function navigateToPanel(panelId) {
    if (isMobile()) {
      setActivePanel(panelId);
    }
  }

  // src/js/features/keyboard-shortcuts.js
  var SHORTCUTS = {
    "ctrl+enter": {
      key: "Enter",
      ctrl: true,
      action: "generate",
      description: "\uC774\uBBF8\uC9C0 \uC0DD\uC131",
      category: "general"
    },
    "ctrl+c": {
      key: "c",
      ctrl: true,
      action: "copy",
      description: "\uD504\uB86C\uD504\uD2B8 \uBCF5\uC0AC",
      category: "builder",
      context: "builder"
    },
    "ctrl+r": {
      key: "r",
      ctrl: true,
      action: "reset",
      description: "\uD3FC \uCD08\uAE30\uD654",
      category: "builder"
    },
    "ctrl+s": {
      key: "s",
      ctrl: true,
      action: "saveApi",
      description: "API \uD0A4 \uC800\uC7A5",
      category: "settings",
      context: "settingsModal"
    },
    "ctrl+1": {
      key: "1",
      ctrl: true,
      action: "template1",
      description: "\uD15C\uD50C\uB9BF 1 (\uAE30\uBCF8)",
      category: "template"
    },
    "ctrl+2": {
      key: "2",
      ctrl: true,
      action: "template2",
      description: "\uD15C\uD50C\uB9BF 2 (\uD3EC\uD1A0)",
      category: "template"
    },
    "ctrl+3": {
      key: "3",
      ctrl: true,
      action: "template3",
      description: "\uD15C\uD50C\uB9BF 3 (\uD0C0\uC774\uD3EC)",
      category: "template"
    },
    "ctrl+4": {
      key: "4",
      ctrl: true,
      action: "template4",
      description: "\uD15C\uD50C\uB9BF 4 (\uB85C\uACE0)",
      category: "template"
    },
    "ctrl+5": {
      key: "5",
      ctrl: true,
      action: "template5",
      description: "\uD15C\uD50C\uB9BF 5 (\uBA85\uC554)",
      category: "template"
    },
    "ctrl+6": {
      key: "6",
      ctrl: true,
      action: "template6",
      description: "\uD15C\uD50C\uB9BF 6 (\uC81C\uD488)",
      category: "template"
    },
    "escape": {
      key: "Escape",
      ctrl: false,
      action: "closeModal",
      description: "\uBAA8\uB2EC \uB2EB\uAE30",
      category: "general"
    },
    "question": {
      key: "?",
      ctrl: false,
      shift: true,
      action: "showHelp",
      description: "\uB2E8\uCD95\uD0A4 \uC548\uB0B4",
      category: "general"
    }
  };
  var templateIds = Object.keys(TEMPLATES);
  function handleShortcut(action) {
    switch (action) {
      case "generate":
        if (window.generateImage) {
          window.generateImage();
        }
        break;
      case "copy":
        if (window.copyPrompt) {
          window.copyPrompt();
        }
        break;
      case "reset":
        if (window.resetForm) {
          window.resetForm();
        }
        break;
      case "saveApi":
        const settingsModal = document.getElementById("settingsModal");
        if (settingsModal && !settingsModal.classList.contains("hidden")) {
          if (window.saveApiKey) {
            window.saveApiKey();
          }
        }
        break;
      case "template1":
      case "template2":
      case "template3":
      case "template4":
      case "template5":
      case "template6":
        const index = parseInt(action.replace("template", "")) - 1;
        if (templateIds[index] && window.handleTemplateChange) {
          window.handleTemplateChange(templateIds[index]);
        }
        break;
      case "closeModal":
        closeAllModals();
        break;
      case "showHelp":
        if (window.openHelp) {
          window.openHelp();
        }
        break;
    }
  }
  function closeAllModals() {
    if (window.closeSettingsModal) window.closeSettingsModal();
    if (window.closeImageModal) window.closeImageModal();
    if (window.closePromptHistory) window.closePromptHistory();
    if (window.closeCanvasGenerator) window.closeCanvasGenerator();
    if (window.closeTemplateEditor) window.closeTemplateEditor();
    if (window.closeHelp) window.closeHelp();
  }
  function initKeyboardShortcuts() {
    document.addEventListener("keydown", (e) => {
      const isInputFocused = document.activeElement.matches("input, textarea, select");
      if (e.key === "Escape") {
        handleShortcut("closeModal");
        return;
      }
      if (isInputFocused) {
        if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
          e.preventDefault();
          handleShortcut("generate");
          return;
        }
        if ((e.ctrlKey || e.metaKey) && e.key === "s") {
          e.preventDefault();
          handleShortcut("saveApi");
          return;
        }
        return;
      }
      if (e.key === "?" && e.shiftKey) {
        e.preventDefault();
        handleShortcut("showHelp");
        return;
      }
      if (e.ctrlKey || e.metaKey) {
        switch (e.key) {
          case "Enter":
            e.preventDefault();
            handleShortcut("generate");
            break;
          case "c":
            if (!window.getSelection().toString()) {
              e.preventDefault();
              handleShortcut("copy");
            }
            break;
          case "r":
            e.preventDefault();
            handleShortcut("reset");
            break;
          case "s":
            e.preventDefault();
            handleShortcut("saveApi");
            break;
          case "1":
          case "2":
          case "3":
          case "4":
          case "5":
          case "6":
            e.preventDefault();
            handleShortcut("template" + e.key);
            break;
        }
      }
      if (state.imageModalIndex >= 0) {
        if (e.key === "ArrowLeft") {
          if (window.navigateImageModal) {
            window.navigateImageModal(-1);
          }
        } else if (e.key === "ArrowRight") {
          if (window.navigateImageModal) {
            window.navigateImageModal(1);
          }
        }
      }
    });
  }
  function getShortcutsList() {
    const list = [];
    for (const [id, shortcut] of Object.entries(SHORTCUTS)) {
      let keyCombo = "";
      if (shortcut.ctrl) keyCombo += "Ctrl+";
      if (shortcut.shift) keyCombo += "Shift+";
      keyCombo += shortcut.key.toUpperCase();
      list.push({
        id,
        keyCombo,
        description: shortcut.description,
        category: shortcut.category
      });
    }
    return list;
  }

  // src/js/features/help-system.js
  var HELP_CONTENT = {
    overview: {
      title: "\uC571 \uAC1C\uC694",
      content: `
      <h3>\uB098\uB178 \uBC14\uB098\uB098 \uD504\uB86C\uD504\uD2B8 \uC5B4\uC2DC\uC2A4\uD134\uD2B8</h3>
      <p>Google Gemini AI\uB97C \uD65C\uC6A9\uD55C \uC774\uBBF8\uC9C0 \uC0DD\uC131 \uB3C4\uAD6C\uC785\uB2C8\uB2E4.</p>

      <h4>\uC8FC\uC694 \uAE30\uB2A5</h4>
      <ul>
        <li><strong>\uD15C\uD50C\uB9BF \uAE30\uBC18 \uD504\uB86C\uD504\uD2B8 \uBE4C\uB354</strong> - 12\uAC1C\uC758 \uC804\uBB38 \uD15C\uD50C\uB9BF\uC73C\uB85C \uC27D\uAC8C \uD504\uB86C\uD504\uD2B8 \uC791\uC131</li>
        <li><strong>\uC774\uBBF8\uC9C0 \uCCA8\uBD80</strong> - \uCC38\uC870 \uC774\uBBF8\uC9C0\uB97C \uCCA8\uBD80\uD558\uC5EC \uB354 \uC815\uD655\uD55C \uACB0\uACFC \uC0DD\uC131</li>
        <li><strong>\uC790\uB3D9 \uBC88\uC5ED</strong> - \uD55C\uAE00 \uD504\uB86C\uD504\uD2B8\uB97C \uC601\uC5B4\uB85C \uC790\uB3D9 \uBC88\uC5ED</li>
        <li><strong>\uB300\uD654\uC2DD \uD3B8\uC9D1</strong> - \uC0DD\uC131\uB41C \uC774\uBBF8\uC9C0\uB97C \uAE30\uBC18\uC73C\uB85C \uC218\uC815 \uC694\uCCAD</li>
        <li><strong>Thinking \uBAA8\uB4DC</strong> - AI\uAC00 \uC774\uBBF8\uC9C0 \uC0DD\uC131 \uC804 \uB17C\uB9AC\uC801 \uAC80\uD1A0 \uC218\uD589</li>
        <li><strong>\uC0AC\uC6A9\uC790 \uC815\uC758 \uD15C\uD50C\uB9BF</strong> - \uB098\uB9CC\uC758 \uD15C\uD50C\uB9BF \uC0DD\uC131 \uBC0F \uAD00\uB9AC</li>
      </ul>
    `
    },
    templates: {
      title: "\uD15C\uD50C\uB9BF \uC0AC\uC6A9\uBC95",
      content: `
      <h4>\uAE30\uBCF8 \uD15C\uD50C\uB9BF (6\uAC1C)</h4>
      <ul>
        <li><strong>\u{1F3A8} \uAE30\uBCF8</strong> - 6\uC694\uC18C \uACF5\uC2DD (\uC8FC\uC81C, \uC2A4\uD0C0\uC77C, \uBD84\uC704\uAE30, \uC870\uBA85, \uAD6C\uB3C4, \uC0C9\uC0C1)</li>
        <li><strong>\u{1F4F7} \uD3EC\uD1A0</strong> - \uC0AC\uC9C4 \uCD2C\uC601 \uC124\uC815 (\uCE74\uBA54\uB77C, \uB80C\uC988, \uC870\uB9AC\uAC1C, \uC154\uD130 \uC2A4\uD53C\uB4DC)</li>
        <li><strong>\u{1F524} \uD0C0\uC774\uD3EC</strong> - \uD14D\uC2A4\uD2B8 \uB808\uD130\uB9C1 (\uD3F0\uD2B8, \uD06C\uAE30, \uC0C9\uC0C1, \uB808\uC774\uC544\uC6C3)</li>
        <li><strong>\u{1F4D0} \uB85C\uACE0 \uADF8\uB9AC\uB4DC</strong> - 8\uAC1C \uB85C\uACE0 \uBCC0\uD615 \uC2DC\uB9AC\uC988</li>
        <li><strong>\u{1F317} \uBA85\uC554\uBC95</strong> - \uBA85\uC554 \uB300\uBE44 \uC804\uBB38</li>
        <li><strong>\u{1F6CD}\uFE0F \uC81C\uD488</strong> - \uC81C\uD488 \uB77C\uC774\uD504\uC2A4\uD0C0\uC77C \uCD2C\uC601</li>
      </ul>

      <h4>\uD15C\uD50C\uB9BF \uC0AC\uC6A9 \uBC29\uBC95</h4>
      <ol>
        <li>\uC0C1\uB2E8 \uD0ED\uC5D0\uC11C \uC6D0\uD558\uB294 \uD15C\uD50C\uB9BF \uC120\uD0DD</li>
        <li>\uAC01 \uD544\uB4DC\uC5D0 \uB0B4\uC6A9 \uC785\uB825 (\uD544\uC218 \uD544\uB4DC\uB294 * \uD45C\uC2DC)</li>
        <li>\uBBF8\uB9AC\uBCF4\uAE30\uC5D0\uC11C \uC0DD\uC131\uB41C \uD504\uB86C\uD504\uD2B8 \uD655\uC778</li>
        <li>"\uC774\uBBF8\uC9C0 \uC0DD\uC131" \uBC84\uD2BC \uD074\uB9AD</li>
      </ol>

      <h4>\uC0AC\uC6A9\uC790 \uC815\uC758 \uD15C\uD50C\uB9BF</h4>
      <p>"\u2795 \uC0C8 \uD15C\uD50C\uB9BF" \uBC84\uD2BC\uC73C\uB85C \uB098\uB9CC\uC758 \uD15C\uD50C\uB9BF\uC744 \uB9CC\uB4E4 \uC218 \uC788\uC2B5\uB2C8\uB2E4.</p>
    `
    },
    shortcuts: {
      title: "\uD0A4\uBCF4\uB4DC \uB2E8\uCD95\uD0A4",
      content: ""
      // 동적으로 생성
    },
    tips: {
      title: "\uC774\uBBF8\uC9C0 \uC0DD\uC131 \uD301",
      content: `
      <h4>\uB354 \uB098\uC740 \uACB0\uACFC\uB97C \uC704\uD55C \uD301</h4>

      <h5>\u{1F4A1} \uD504\uB86C\uD504\uD2B8 \uC791\uC131</h5>
      <ul>
        <li>\uAD6C\uCCB4\uC801\uC774\uACE0 \uC0C1\uC138\uD558\uAC8C \uC124\uBA85\uD560\uC218\uB85D \uC88B\uC2B5\uB2C8\uB2E4</li>
        <li>\uC6D0\uD558\uB294 \uC2A4\uD0C0\uC77C, \uBD84\uC704\uAE30, \uC870\uBA85\uC744 \uBA85\uD655\uD788 \uC9C0\uC815\uD558\uC138\uC694</li>
        <li>\uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1\uC740 25\uC790 \uC774\uD558\uAC00 \uAD8C\uC7A5\uB429\uB2C8\uB2E4</li>
      </ul>

      <h5>\u{1F9E0} Thinking \uBAA8\uB4DC \uD65C\uC6A9</h5>
      <ul>
        <li>\uB2E4\uC911 \uC694\uC18C\uAC00 \uC788\uB294 \uBCF5\uC7A1\uD55C \uC7A5\uBA74</li>
        <li>\uC815\uD655\uD55C \uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1\uC774 \uD544\uC694\uD55C \uACBD\uC6B0</li>
        <li>\uBB3C\uB9AC\uC801 \uC815\uD655\uC131\uC774 \uC911\uC694\uD55C \uC774\uBBF8\uC9C0</li>
        <li>\uC5EC\uB7EC \uC774\uBBF8\uC9C0\uC758 \uC77C\uAD00\uC131 \uC720\uC9C0\uAC00 \uD544\uC694\uD55C \uACBD\uC6B0</li>
      </ul>

      <h5>\u{1F4F8} \uC791\uC5C5 \uBAA8\uB4DC \uC120\uD0DD</h5>
      <ul>
        <li><strong>\uD0D0\uC0C9 \uBAA8\uB4DC</strong> - \uBE60\uB978 \uC544\uC774\uB514\uC5B4 \uD14C\uC2A4\uD2B8\uC6A9 (512px)</li>
        <li><strong>\uC815\uC81C \uBAA8\uB4DC</strong> - \uC138\uBD80 \uC870\uC815\uC6A9 (1024px)</li>
        <li><strong>\uCD5C\uC885 \uBAA8\uB4DC</strong> - \uD504\uB85C\uB355\uC158 \uCD9C\uB825\uC6A9 (\uC6D0\uBCF8 \uD574\uC0C1\uB3C4)</li>
      </ul>

      <h5>\u{1F5BC}\uFE0F \uC774\uBBF8\uC9C0 \uCCA8\uBD80</h5>
      <ul>
        <li>\uCC38\uC870 \uC774\uBBF8\uC9C0\uB97C \uCCA8\uBD80\uD558\uBA74 \uB354 \uC815\uD655\uD55C \uACB0\uACFC\uB97C \uC5BB\uC744 \uC218 \uC788\uC2B5\uB2C8\uB2E4</li>
        <li>\uCD5C\uB300 14\uAC1C\uAE4C\uC9C0 \uCCA8\uBD80 \uAC00\uB2A5</li>
        <li>\uB4DC\uB798\uADF8 \uC564 \uB4DC\uB86D\uC73C\uB85C \uC27D\uAC8C \uC5C5\uB85C\uB4DC</li>
      </ul>
    `
    },
    faq: {
      title: "FAQ",
      content: `
      <h4>\uC790\uC8FC \uBB3B\uB294 \uC9C8\uBB38</h4>

      <details>
        <summary>API \uD0A4\uB294 \uC5B4\uB514\uC11C \uBC1C\uAE09\uBC1B\uB098\uC694?</summary>
        <p><a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>\uC5D0\uC11C \uBB34\uB8CC\uB85C \uBC1C\uAE09\uBC1B\uC744 \uC218 \uC788\uC2B5\uB2C8\uB2E4.</p>
      </details>

      <details>
        <summary>\uC774\uBBF8\uC9C0\uAC00 \uC0DD\uC131\uB418\uC9C0 \uC54A\uC544\uC694</summary>
        <p>API \uD0A4\uAC00 \uC62C\uBC14\uB974\uAC8C \uC785\uB825\uB418\uC5C8\uB294\uC9C0 \uD655\uC778\uD558\uC138\uC694. \uC5F0\uACB0 \uD14C\uC2A4\uD2B8 \uBC84\uD2BC\uC73C\uB85C API \uC0C1\uD0DC\uB97C \uD655\uC778\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4.</p>
      </details>

      <details>
        <summary>"\uC548\uC804 \uD544\uD130\uC5D0 \uC758\uD574 \uCC28\uB2E8\uB418\uC5C8\uC2B5\uB2C8\uB2E4" \uC624\uB958\uAC00 \uB098\uC694</summary>
        <p>Gemini\uC758 \uC548\uC804 \uD544\uD130\uAC00 \uD2B9\uC815 \uCF58\uD150\uCE20\uB97C \uCC28\uB2E8\uD588\uC2B5\uB2C8\uB2E4. \uD504\uB86C\uD504\uD2B8\uB97C \uC218\uC815\uD574 \uC8FC\uC138\uC694.</p>
      </details>

      <details>
        <summary>\uD14D\uC2A4\uD2B8\uAC00 \uC815\uD655\uD558\uAC8C \uB80C\uB354\uB9C1\uB418\uC9C0 \uC54A\uC544\uC694</summary>
        <p>\uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1\uC740 25\uC790 \uC774\uD558\uAC00 \uAD8C\uC7A5\uB429\uB2C8\uB2E4. Thinking \uBAA8\uB4DC\uB97C \uD65C\uC131\uD654\uD558\uBA74 \uC815\uD655\uB3C4\uAC00 \uB192\uC544\uC9D1\uB2C8\uB2E4.</p>
      </details>

      <details>
        <summary>\uC774\uC804\uC5D0 \uC0DD\uC131\uD55C \uC774\uBBF8\uC9C0\uB97C \uB2E4\uC2DC \uBCF4\uACE0 \uC2F6\uC5B4\uC694</summary>
        <p>\uACB0\uACFC \uD328\uB110\uC758 \uD788\uC2A4\uD1A0\uB9AC \uC378\uB124\uC77C\uC5D0\uC11C \uC774\uC804 \uC774\uBBF8\uC9C0\uB97C \uD655\uC778\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4. \uD504\uB86C\uD504\uD2B8 \uD788\uC2A4\uD1A0\uB9AC \uBC84\uD2BC(\u{1F4DC})\uC744 \uD074\uB9AD\uD558\uBA74 \uC774\uC804 \uD504\uB86C\uD504\uD2B8\uB3C4 \uBCFC \uC218 \uC788\uC2B5\uB2C8\uB2E4.</p>
      </details>

      <details>
        <summary>\uB2E4\uD06C \uBAA8\uB4DC\uB97C \uC0AC\uC6A9\uD558\uACE0 \uC2F6\uC5B4\uC694</summary>
        <p>\uD5E4\uB354\uC758 \uD14C\uB9C8 \uD1A0\uAE00 \uBC84\uD2BC(\u2600\uFE0F/\u{1F319})\uC744 \uD074\uB9AD\uD558\uC138\uC694. \uC2DC\uC2A4\uD15C \uC124\uC815\uC5D0 \uB530\uB77C \uC790\uB3D9\uC73C\uB85C \uC801\uC6A9\uB429\uB2C8\uB2E4.</p>
      </details>
    `
    }
  };
  var currentTab = "overview";
  function openHelp() {
    const modal = document.getElementById("helpModal");
    if (modal) {
      modal.classList.remove("hidden");
      renderHelpContent(currentTab);
    }
  }
  function closeHelp() {
    const modal = document.getElementById("helpModal");
    if (modal) {
      modal.classList.add("hidden");
    }
  }
  function setHelpTab(tab) {
    currentTab = tab;
    document.querySelectorAll(".help-tab").forEach((btn) => {
      btn.classList.toggle("active", btn.dataset.tab === tab);
    });
    renderHelpContent(tab);
  }
  function renderHelpContent(tab) {
    const container = document.getElementById("helpContent");
    if (!container) return;
    let content = HELP_CONTENT[tab]?.content || "";
    if (tab === "shortcuts") {
      content = generateShortcutsContent();
    }
    container.innerHTML = content;
  }
  function generateShortcutsContent() {
    const shortcuts = getShortcutsList();
    const categories = {
      general: "\uC77C\uBC18",
      builder: "\uBE4C\uB354",
      template: "\uD15C\uD50C\uB9BF",
      settings: "\uC124\uC815"
    };
    let html = "<h4>\uD0A4\uBCF4\uB4DC \uB2E8\uCD95\uD0A4</h4>";
    for (const [catId, catName] of Object.entries(categories)) {
      const catShortcuts = shortcuts.filter((s) => s.category === catId);
      if (catShortcuts.length === 0) continue;
      html += `<h5>${catName}</h5><table class="shortcuts-table"><tbody>`;
      for (const shortcut of catShortcuts) {
        html += `
        <tr>
          <td><kbd>${shortcut.keyCombo}</kbd></td>
          <td>${shortcut.description}</td>
        </tr>
      `;
      }
      html += "</tbody></table>";
    }
    return html;
  }

  // src/js/features/tips-system.js
  var TIPS = {
    complexScene: {
      id: "complexScene",
      title: "Thinking \uBAA8\uB4DC \uAD8C\uC7A5",
      message: "\uBCF5\uC7A1\uD55C \uC7A5\uBA74\uC774\uB098 \uC5EC\uB7EC \uC694\uC18C\uAC00 \uD3EC\uD568\uB41C \uC774\uBBF8\uC9C0\uB294 Thinking \uBAA8\uB4DC\uB97C \uD65C\uC131\uD654\uD558\uBA74 \uB354 \uC815\uD655\uD55C \uACB0\uACFC\uB97C \uC5BB\uC744 \uC218 \uC788\uC2B5\uB2C8\uB2E4.",
      trigger: "promptLength",
      threshold: 200,
      position: "bottom"
    },
    textRendering: {
      id: "textRendering",
      title: "\uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1 \uD301",
      message: "\uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1\uC740 25\uC790 \uC774\uD558\uAC00 \uAD8C\uC7A5\uB429\uB2C8\uB2E4. \uAE34 \uD14D\uC2A4\uD2B8\uB294 \uC5EC\uB7EC \uC774\uBBF8\uC9C0\uB85C \uB098\uB204\uC5B4 \uC0DD\uC131\uD558\uC138\uC694.",
      trigger: "template",
      templateId: "typography",
      position: "bottom"
    },
    productPhoto: {
      id: "productPhoto",
      title: "\uC81C\uD488 \uC0AC\uC9C4 \uD301",
      message: "\uC81C\uD488 \uC0AC\uC9C4\uC740 \uD770\uC0C9 \uB610\uB294 \uB2E8\uC0C9 \uBC30\uACBD\uC5D0\uC11C \uAC00\uC7A5 \uC88B\uC740 \uACB0\uACFC\uB97C \uC5BB\uC744 \uC218 \uC788\uC2B5\uB2C8\uB2E4.",
      trigger: "template",
      templateId: "productLifestyle",
      position: "bottom"
    },
    imageAttachment: {
      id: "imageAttachment",
      title: "\uCC38\uC870 \uC774\uBBF8\uC9C0 \uD65C\uC6A9",
      message: "\uCC38\uC870 \uC774\uBBF8\uC9C0\uB97C \uCCA8\uBD80\uD558\uBA74 \uC2A4\uD0C0\uC77C\uC774\uB098 \uAD6C\uB3C4\uB97C \uB354 \uC815\uD655\uD558\uAC8C \uC7AC\uD604\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4.",
      trigger: "noImages",
      position: "bottom"
    },
    workMode: {
      id: "workMode",
      title: "\uC791\uC5C5 \uBAA8\uB4DC \uC120\uD0DD",
      message: "\uD0D0\uC0C9 \uBAA8\uB4DC(512px)\uB85C \uBE60\uB974\uAC8C \uC544\uC774\uB514\uC5B4\uB97C \uD14C\uC2A4\uD2B8\uD558\uACE0, \uB9CC\uC871\uC2A4\uB7EC\uC6B4 \uACB0\uACFC\uAC00 \uB098\uC624\uBA74 \uCD5C\uC885 \uBAA8\uB4DC\uB85C \uACE0\uD574\uC0C1\uB3C4 \uC774\uBBF8\uC9C0\uB97C \uC0DD\uC131\uD558\uC138\uC694.",
      trigger: "firstGeneration",
      position: "top"
    },
    editSession: {
      id: "editSession",
      title: "\uB300\uD654\uC2DD \uD3B8\uC9D1 \uBAA8\uB4DC",
      message: '\uC0DD\uC131\uB41C \uC774\uBBF8\uC9C0\uB97C \uAE30\uBC18\uC73C\uB85C \uC218\uC815 \uC694\uCCAD\uC744 \uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4. "\uC870\uAE08 \uB354 \uBC1D\uAC8C", "\uBC30\uACBD\uC744 \uD30C\uB780\uC0C9\uC73C\uB85C" \uB4F1 \uC790\uC5F0\uC5B4\uB85C \uC694\uCCAD\uD558\uC138\uC694.',
      trigger: "imageGenerated",
      position: "bottom"
    }
  };
  var currentTip = null;
  var tipTimeout = null;
  function loadTipsSettings() {
    const showTips = loadFromLocalStorage(STORAGE_KEYS.SHOW_TIPS);
    const dismissedTips = loadFromLocalStorage(STORAGE_KEYS.DISMISSED_TIPS);
    state.showTips = showTips !== false;
    state.dismissedTips = dismissedTips || [];
  }
  function saveTipsSettings() {
    saveToLocalStorage(STORAGE_KEYS.SHOW_TIPS, state.showTips);
    saveToLocalStorage(STORAGE_KEYS.DISMISSED_TIPS, state.dismissedTips);
  }
  function toggleTips() {
    state.showTips = !state.showTips;
    saveTipsSettings();
    if (!state.showTips && currentTip) {
      hideTip();
    }
    return state.showTips;
  }
  function showTip(tipId, targetElement = null) {
    if (!state.showTips) return;
    if (state.dismissedTips.includes(tipId)) return;
    const tip = TIPS[tipId];
    if (!tip) return;
    hideTip();
    const tipElement = document.createElement("div");
    tipElement.className = "tip-popup";
    tipElement.id = "currentTip";
    tipElement.innerHTML = `
    <div class="tip-header">
      <span class="tip-icon">\u{1F4A1}</span>
      <span class="tip-title">${tip.title}</span>
      <button class="tip-close" onclick="dismissTip('${tipId}')" aria-label="\uD301 \uB2EB\uAE30">&times;</button>
    </div>
    <div class="tip-message">${tip.message}</div>
    <div class="tip-footer">
      <button class="tip-dismiss-all" onclick="disableAllTips()">\uBAA8\uB4E0 \uD301 \uB044\uAE30</button>
    </div>
  `;
    if (targetElement) {
      const rect = targetElement.getBoundingClientRect();
      tipElement.style.position = "fixed";
      if (tip.position === "top") {
        tipElement.style.bottom = `${window.innerHeight - rect.top + 10}px`;
        tipElement.style.left = `${rect.left}px`;
      } else {
        tipElement.style.top = `${rect.bottom + 10}px`;
        tipElement.style.left = `${rect.left}px`;
      }
    } else {
      tipElement.style.position = "fixed";
      tipElement.style.bottom = "20px";
      tipElement.style.right = "20px";
    }
    document.body.appendChild(tipElement);
    currentTip = { id: tipId, element: tipElement };
    requestAnimationFrame(() => {
      tipElement.classList.add("visible");
    });
    tipTimeout = setTimeout(() => {
      hideTip();
    }, 1e4);
  }
  function hideTip() {
    if (tipTimeout) {
      clearTimeout(tipTimeout);
      tipTimeout = null;
    }
    const tipElement = document.getElementById("currentTip");
    if (tipElement) {
      tipElement.classList.remove("visible");
      setTimeout(() => {
        tipElement.remove();
      }, 200);
    }
    currentTip = null;
  }
  function dismissTip(tipId) {
    if (!state.dismissedTips.includes(tipId)) {
      state.dismissedTips.push(tipId);
      saveTipsSettings();
    }
    hideTip();
  }
  function disableAllTips() {
    state.showTips = false;
    saveTipsSettings();
    hideTip();
  }
  function resetTips() {
    state.dismissedTips = [];
    state.showTips = true;
    saveTipsSettings();
  }
  function triggerTip(trigger, context = {}) {
    if (!state.showTips) return;
    for (const [tipId, tip] of Object.entries(TIPS)) {
      if (state.dismissedTips.includes(tipId)) continue;
      switch (tip.trigger) {
        case "promptLength":
          if (trigger === "promptLength" && context.length >= tip.threshold) {
            showTip(tipId, context.element);
            return;
          }
          break;
        case "template":
          if (trigger === "template" && context.templateId === tip.templateId) {
            showTip(tipId, context.element);
            return;
          }
          break;
        case "noImages":
          if (trigger === "noImages" && (!state.attachedImages || state.attachedImages.length === 0)) {
            showTip(tipId, context.element);
            return;
          }
          break;
        case "firstGeneration":
          if (trigger === "firstGeneration" && !localStorage.getItem("nano_banana_first_gen_done")) {
            localStorage.setItem("nano_banana_first_gen_done", "true");
            showTip(tipId, context.element);
            return;
          }
          break;
        case "imageGenerated":
          if (trigger === "imageGenerated") {
            showTip(tipId, context.element);
            return;
          }
          break;
      }
    }
  }
  function initTips() {
    loadTipsSettings();
  }

  // src/js/data/locales/ko.js
  var ko_default = {
    // 일반
    app: {
      title: "\uB098\uB178 \uBC14\uB098\uB098 \uD504\uB86C\uD504\uD2B8 \uC5B4\uC2DC\uC2A4\uD134\uD2B8",
      description: "Google Gemini AI\uB97C \uD65C\uC6A9\uD55C \uC774\uBBF8\uC9C0 \uC0DD\uC131 \uB3C4\uAD6C"
    },
    // 헤더
    header: {
      apiConnected: "API \uC5F0\uACB0\uB428",
      apiDisconnected: "API \uBBF8\uC5F0\uACB0",
      apiError: "API \uC624\uB958",
      settings: "\uC124\uC815",
      help: "\uB3C4\uC6C0\uB9D0",
      theme: "\uD14C\uB9C8 \uBCC0\uACBD"
    },
    // 템플릿
    templates: {
      basic: "\uAE30\uBCF8",
      photo: "\uD3EC\uD1A0",
      typography: "\uD0C0\uC774\uD3EC",
      logoGrid: "\uB85C\uACE0 \uADF8\uB9AC\uB4DC",
      chiaroscuro: "\uBA85\uC554\uBC95",
      productLifestyle: "\uC81C\uD488",
      addNew: "\uC0C8 \uD15C\uD50C\uB9BF"
    },
    // 빌더
    builder: {
      title: "\uD504\uB86C\uD504\uD2B8 \uBE4C\uB354",
      preview: "\uBBF8\uB9AC\uBCF4\uAE30",
      original: "\uC6D0\uBB38",
      translated: "\uBC88\uC5ED",
      autoTranslate: "\uC790\uB3D9 \uBC88\uC5ED",
      generate: "\uC774\uBBF8\uC9C0 \uC0DD\uC131",
      generating: "\uC0DD\uC131 \uC911...",
      copy: "\uBCF5\uC0AC",
      reset: "\uCD08\uAE30\uD654",
      required: "\uD544\uC218"
    },
    // 작업 모드
    workMode: {
      title: "\uC791\uC5C5 \uBAA8\uB4DC",
      explore: "\uD0D0\uC0C9",
      refine: "\uC815\uC81C",
      final: "\uCD5C\uC885",
      exploreDesc: "\uBE60\uB978 \uC544\uC774\uB514\uC5B4 \uD14C\uC2A4\uD2B8\uC6A9 (512px)",
      refineDesc: "\uC138\uBD80 \uC870\uC815\uC6A9 (1024px)",
      finalDesc: "\uD504\uB85C\uB355\uC158 \uCD9C\uB825\uC6A9 (\uC6D0\uBCF8 \uD574\uC0C1\uB3C4)"
    },
    // 첨부 이미지
    attachments: {
      title: "\uC774\uBBF8\uC9C0 \uCCA8\uBD80",
      upload: "\uC774\uBBF8\uC9C0 \uC5C5\uB85C\uB4DC",
      dragDrop: "\uB4DC\uB798\uADF8 \uC564 \uB4DC\uB86D \uB610\uB294 \uD074\uB9AD",
      maxFiles: "\uCD5C\uB300 14\uAC1C",
      delete: "\uC0AD\uC81C",
      viewOriginal: "\uC6D0\uBCF8 \uBCF4\uAE30",
      createCanvas: "\uCE94\uBC84\uC2A4 \uC0DD\uC131"
    },
    // 결과
    result: {
      title: "\uACB0\uACFC",
      empty: "\uC0DD\uC131\uB41C \uC774\uBBF8\uC9C0\uAC00 \uC5EC\uAE30\uC5D0 \uD45C\uC2DC\uB429\uB2C8\uB2E4",
      download: "\uB2E4\uC6B4\uB85C\uB4DC",
      edit: "\uD3B8\uC9D1",
      newSession: "\uC0C8 \uC138\uC158",
      promptHistory: "\uD504\uB86C\uD504\uD2B8 \uD788\uC2A4\uD1A0\uB9AC"
    },
    // 편집 모드
    edit: {
      title: "\uB300\uD654\uC2DD \uD3B8\uC9D1",
      placeholder: "\uC218\uC815 \uC694\uCCAD\uC744 \uC785\uB825\uD558\uC138\uC694...",
      apply: "\uC801\uC6A9",
      presets: "\uD504\uB9AC\uC14B",
      categories: {
        color: "\uC0C9\uC0C1",
        style: "\uC2A4\uD0C0\uC77C",
        composition: "\uAD6C\uB3C4",
        detail: "\uB514\uD14C\uC77C"
      }
    },
    // 설정 모달
    settings: {
      title: "\uC124\uC815",
      apiKey: "API \uD0A4",
      apiKeyPlaceholder: "Gemini API \uD0A4\uB97C \uC785\uB825\uD558\uC138\uC694",
      save: "\uC800\uC7A5",
      testConnection: "\uC5F0\uACB0 \uD14C\uC2A4\uD2B8",
      getApiKey: "API \uD0A4 \uBC1C\uAE09\uBC1B\uAE30",
      thinkingMode: "Thinking \uBAA8\uB4DC",
      thinkingModeDesc: "AI\uAC00 \uC774\uBBF8\uC9C0 \uC0DD\uC131 \uC804 \uB17C\uB9AC\uC801 \uAC80\uD1A0 \uC218\uD589"
    },
    // 도움말
    help: {
      title: "\uB3C4\uC6C0\uB9D0",
      tabs: {
        overview: "\uAC1C\uC694",
        templates: "\uD15C\uD50C\uB9BF",
        shortcuts: "\uB2E8\uCD95\uD0A4",
        tips: "\uD301",
        faq: "FAQ"
      }
    },
    // 팁
    tips: {
      disable: "\uBAA8\uB4E0 \uD301 \uB044\uAE30",
      complexScene: {
        title: "Thinking \uBAA8\uB4DC \uAD8C\uC7A5",
        message: "\uBCF5\uC7A1\uD55C \uC7A5\uBA74\uC774\uB098 \uC5EC\uB7EC \uC694\uC18C\uAC00 \uD3EC\uD568\uB41C \uC774\uBBF8\uC9C0\uB294 Thinking \uBAA8\uB4DC\uB97C \uD65C\uC131\uD654\uD558\uBA74 \uB354 \uC815\uD655\uD55C \uACB0\uACFC\uB97C \uC5BB\uC744 \uC218 \uC788\uC2B5\uB2C8\uB2E4."
      },
      textRendering: {
        title: "\uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1 \uD301",
        message: "\uD14D\uC2A4\uD2B8 \uB80C\uB354\uB9C1\uC740 25\uC790 \uC774\uD558\uAC00 \uAD8C\uC7A5\uB429\uB2C8\uB2E4. \uAE34 \uD14D\uC2A4\uD2B8\uB294 \uC5EC\uB7EC \uC774\uBBF8\uC9C0\uB85C \uB098\uB204\uC5B4 \uC0DD\uC131\uD558\uC138\uC694."
      }
    },
    // 오류
    errors: {
      apiKeyRequired: "API \uD0A4\uB97C \uBA3C\uC800 \uC124\uC815\uD574\uC8FC\uC138\uC694",
      generationFailed: "\uC774\uBBF8\uC9C0 \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4",
      safetyFilter: "\uC548\uC804 \uD544\uD130\uC5D0 \uC758\uD574 \uCC28\uB2E8\uB418\uC5C8\uC2B5\uB2C8\uB2E4",
      networkError: "\uB124\uD2B8\uC6CC\uD06C \uC624\uB958\uAC00 \uBC1C\uC0DD\uD588\uC2B5\uB2C8\uB2E4",
      invalidApiKey: "API \uD0A4\uAC00 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4"
    },
    // 공통
    common: {
      close: "\uB2EB\uAE30",
      cancel: "\uCDE8\uC18C",
      confirm: "\uD655\uC778",
      delete: "\uC0AD\uC81C",
      save: "\uC800\uC7A5",
      copy: "\uBCF5\uC0AC",
      copied: "\uBCF5\uC0AC\uB428!"
    }
  };

  // src/js/data/locales/en.js
  var en_default = {
    // General
    app: {
      title: "Nano Banana Prompt Assistant",
      description: "Image generation tool powered by Google Gemini AI"
    },
    // Header
    header: {
      apiConnected: "API Connected",
      apiDisconnected: "API Not Connected",
      apiError: "API Error",
      settings: "Settings",
      help: "Help",
      theme: "Toggle Theme"
    },
    // Templates
    templates: {
      basic: "Basic",
      photo: "Photo",
      typography: "Typography",
      logoGrid: "Logo Grid",
      chiaroscuro: "Chiaroscuro",
      productLifestyle: "Product",
      addNew: "New Template"
    },
    // Builder
    builder: {
      title: "Prompt Builder",
      preview: "Preview",
      original: "Original",
      translated: "Translated",
      autoTranslate: "Auto Translate",
      generate: "Generate Image",
      generating: "Generating...",
      copy: "Copy",
      reset: "Reset",
      required: "Required"
    },
    // Work Mode
    workMode: {
      title: "Work Mode",
      explore: "Explore",
      refine: "Refine",
      final: "Final",
      exploreDesc: "Quick idea testing (512px)",
      refineDesc: "Fine-tuning (1024px)",
      finalDesc: "Production output (original resolution)"
    },
    // Attachments
    attachments: {
      title: "Image Attachments",
      upload: "Upload Images",
      dragDrop: "Drag & drop or click",
      maxFiles: "Max 14 files",
      delete: "Delete",
      viewOriginal: "View Original",
      createCanvas: "Create Canvas"
    },
    // Result
    result: {
      title: "Result",
      empty: "Generated images will appear here",
      download: "Download",
      edit: "Edit",
      newSession: "New Session",
      promptHistory: "Prompt History"
    },
    // Edit Mode
    edit: {
      title: "Interactive Edit",
      placeholder: "Enter your edit request...",
      apply: "Apply",
      presets: "Presets",
      categories: {
        color: "Color",
        style: "Style",
        composition: "Composition",
        detail: "Detail"
      }
    },
    // Settings Modal
    settings: {
      title: "Settings",
      apiKey: "API Key",
      apiKeyPlaceholder: "Enter your Gemini API key",
      save: "Save",
      testConnection: "Test Connection",
      getApiKey: "Get API Key",
      thinkingMode: "Thinking Mode",
      thinkingModeDesc: "AI performs logical review before image generation"
    },
    // Help
    help: {
      title: "Help",
      tabs: {
        overview: "Overview",
        templates: "Templates",
        shortcuts: "Shortcuts",
        tips: "Tips",
        faq: "FAQ"
      }
    },
    // Tips
    tips: {
      disable: "Disable all tips",
      complexScene: {
        title: "Thinking Mode Recommended",
        message: "For complex scenes with multiple elements, enabling Thinking Mode can produce more accurate results."
      },
      textRendering: {
        title: "Text Rendering Tip",
        message: "Text rendering works best with 25 characters or less. For longer text, consider splitting into multiple images."
      }
    },
    // Errors
    errors: {
      apiKeyRequired: "Please set your API key first",
      generationFailed: "Image generation failed",
      safetyFilter: "Blocked by safety filter",
      networkError: "Network error occurred",
      invalidApiKey: "Invalid API key"
    },
    // Common
    common: {
      close: "Close",
      cancel: "Cancel",
      confirm: "Confirm",
      delete: "Delete",
      save: "Save",
      copy: "Copy",
      copied: "Copied!"
    }
  };

  // src/js/features/i18n.js
  var LOCALES = {
    ko: ko_default,
    en: en_default
  };
  var DEFAULT_LOCALE = "ko";
  var currentLocaleData = null;
  function initI18n() {
    const savedLocale = loadFromLocalStorage(STORAGE_KEYS.LOCALE);
    const browserLocale = navigator.language?.split("-")[0];
    let locale = savedLocale || browserLocale || DEFAULT_LOCALE;
    if (!LOCALES[locale]) {
      locale = DEFAULT_LOCALE;
    }
    setLocale(locale, false);
  }
  function setLocale(locale, save = true) {
    if (!LOCALES[locale]) {
      console.warn(`Locale '${locale}' not supported. Using '${DEFAULT_LOCALE}'.`);
      locale = DEFAULT_LOCALE;
    }
    state.locale = locale;
    currentLocaleData = LOCALES[locale];
    if (save) {
      saveToLocalStorage(STORAGE_KEYS.LOCALE, locale);
    }
    updateDOMLocale();
    document.documentElement.lang = locale;
    const localeIcon = document.getElementById("localeIcon");
    if (localeIcon) {
      localeIcon.textContent = locale === "ko" ? "\u{1F1F0}\u{1F1F7}" : "\u{1F1FA}\u{1F1F8}";
    }
    return locale;
  }
  function getLocale() {
    return state.locale || DEFAULT_LOCALE;
  }
  function t(key, params = {}) {
    if (!currentLocaleData) {
      initI18n();
    }
    const keys = key.split(".");
    let value = currentLocaleData;
    for (const k of keys) {
      if (value && typeof value === "object" && k in value) {
        value = value[k];
      } else {
        value = getFromDefaultLocale(key);
        if (!value) {
          console.warn(`Translation key not found: ${key}`);
          return key;
        }
        break;
      }
    }
    if (typeof value === "string" && Object.keys(params).length > 0) {
      for (const [param, paramValue] of Object.entries(params)) {
        value = value.replace(new RegExp(`\\{${param}\\}`, "g"), paramValue);
      }
    }
    return value;
  }
  function getFromDefaultLocale(key) {
    const keys = key.split(".");
    let value = LOCALES[DEFAULT_LOCALE];
    for (const k of keys) {
      if (value && typeof value === "object" && k in value) {
        value = value[k];
      } else {
        return null;
      }
    }
    return value;
  }
  function updateDOMLocale() {
    const elements = document.querySelectorAll("[data-i18n]");
    elements.forEach((el) => {
      const key = el.getAttribute("data-i18n");
      const translation = t(key);
      if (translation && translation !== key) {
        const attr = el.getAttribute("data-i18n-attr");
        if (attr) {
          el.setAttribute(attr, translation);
        } else {
          el.textContent = translation;
        }
      }
    });
    const placeholderElements = document.querySelectorAll("[data-i18n-placeholder]");
    placeholderElements.forEach((el) => {
      const key = el.getAttribute("data-i18n-placeholder");
      const translation = t(key);
      if (translation && translation !== key) {
        el.placeholder = translation;
      }
    });
    const ariaElements = document.querySelectorAll("[data-i18n-aria]");
    ariaElements.forEach((el) => {
      const key = el.getAttribute("data-i18n-aria");
      const translation = t(key);
      if (translation && translation !== key) {
        el.setAttribute("aria-label", translation);
      }
    });
    const titleElements = document.querySelectorAll("[data-i18n-title]");
    titleElements.forEach((el) => {
      const key = el.getAttribute("data-i18n-title");
      const translation = t(key);
      if (translation && translation !== key) {
        el.title = translation;
      }
    });
  }
  function toggleLocale() {
    const newLocale = state.locale === "ko" ? "en" : "ko";
    setLocale(newLocale);
    return newLocale;
  }
  function getAvailableLocales() {
    return Object.keys(LOCALES).map((code) => ({
      code,
      name: code === "ko" ? "\uD55C\uAD6D\uC5B4" : "English",
      nativeName: code === "ko" ? "\uD55C\uAD6D\uC5B4" : "English"
    }));
  }

  // src/js/main.js
  window.handleTemplateChange = handleTemplateChange;
  window.resetForm = resetForm;
  window.setWorkMode = setWorkMode;
  window.handleFileSelect = handleFileSelect;
  window.selectAttachedImage = selectAttachedImage;
  window.deleteAttachedImage = deleteAttachedImage;
  window.deleteSelectedImage = deleteSelectedImage;
  window.viewOriginalImage = viewOriginalImage;
  window.downloadImage = downloadImage;
  window.selectResultHistory = (historyId) => {
    selectResultHistory(historyId);
    renderResult();
  };
  window.handleImageDragStart = handleImageDragStart;
  window.handleImageDragOver = handleImageDragOver;
  window.handleImageDragLeave = handleImageDragLeave;
  window.handleImageDrop = handleImageDrop;
  window.handleImageDragEnd = handleImageDragEnd;
  window.generateImage = generateImage;
  window.copyPrompt = copyPrompt;
  window.handleTranslateToggle = handleTranslateToggle;
  window.setPromptTab = setPromptTab;
  window.openSettingsModal = openSettingsModal;
  window.closeSettingsModal = closeSettingsModal;
  window.toggleApiKeyVisibility = toggleApiKeyVisibility;
  window.testApiConnection = testApiConnection;
  window.saveApiKey = saveApiKey;
  window.openImageModal = openImageModal;
  window.closeImageModal = closeImageModal;
  window.navigateImageModal = navigateImageModal;
  window.downloadModalImage = downloadModalImage;
  window.reusePrompt = reusePrompt;
  window.startNewSession = startNewSession;
  window.initEditSession = initEditSession;
  window.selectEditHistoryItem = selectEditHistoryItem;
  window.clearEditRequest = clearEditRequest;
  window.applyEditRequest = applyEditRequest;
  window.setPresetCategory = setPresetCategory;
  window.applyPreset = applyPreset;
  window.toggleThinkingMode = toggleThinkingMode;
  window.savePromptToHistory = savePromptToHistory;
  window.openPromptHistory = openPromptHistory;
  window.closePromptHistory = closePromptHistory;
  window.searchPromptHistory = searchPromptHistory;
  window.restorePromptFromHistory = restorePromptFromHistory;
  window.copyPromptFromHistory = copyPromptFromHistory;
  window.deletePromptFromHistory = deletePromptFromHistory;
  window.clearAllPromptHistory = clearAllPromptHistory;
  window.openCanvasGenerator = openCanvasGenerator;
  window.closeCanvasGenerator = closeCanvasGenerator;
  window.setCanvasAspectRatio = setCanvasAspectRatio;
  window.setCanvasBaseSize = setCanvasBaseSize;
  window.setCanvasCustomSize = setCanvasCustomSize;
  window.setCanvasBackgroundType = setCanvasBackgroundType;
  window.setCanvasBackgroundColor = setCanvasBackgroundColor;
  window.generateAndAttachCanvas = generateAndAttachCanvas;
  window.openTemplateEditor = openTemplateEditor;
  window.closeTemplateEditor = closeTemplateEditor;
  window.addEditorField = addEditorField;
  window.deleteEditorField = deleteEditorField;
  window.moveEditorField = moveEditorField;
  window.updateEditorField = updateEditorField;
  window.addFieldOption = addFieldOption;
  window.deleteFieldOption = deleteFieldOption;
  window.saveTemplate = saveTemplate;
  window.duplicateTemplate = duplicateTemplate;
  window.deleteCustomTemplate = deleteCustomTemplate;
  window.exportTemplate = exportTemplate;
  window.insertFieldPlaceholder = insertFieldPlaceholder;
  window.setActivePanel = setActivePanel;
  window.navigateToPanel = navigateToPanel;
  window.getShortcutsList = getShortcutsList;
  window.openHelp = openHelp;
  window.closeHelp = closeHelp;
  window.setHelpTab = setHelpTab;
  window.showTip = showTip;
  window.hideTip = hideTip;
  window.dismissTip = dismissTip;
  window.disableAllTips = disableAllTips;
  window.resetTips = resetTips;
  window.toggleTips = toggleTips;
  window.triggerTip = triggerTip;
  window.setLocale = setLocale;
  window.getLocale = getLocale;
  window.t = t;
  window.toggleLocale = toggleLocale;
  window.getAvailableLocales = getAvailableLocales;
  window.state = state;
  function initApp() {
    initI18n();
    initPerformance();
    initializeFieldValues();
    const savedApiKey = loadFromStorage();
    loadSettings();
    loadPromptHistory();
    loadCustomTemplates();
    loadThinkingMode();
    loadResultHistory();
    initTips();
    if (savedApiKey) {
      testApiConnection(true);
    }
    renderTemplateTabs();
    renderTemplateFields();
    renderResult();
    renderAttachedImages();
    setupDragAndDrop();
    initKeyboardShortcuts();
    initResponsive();
    console.log("Nano Banana Assistant initialized");
  }
  function setupDragAndDrop() {
    const uploadArea = document.getElementById("uploadArea");
    if (!uploadArea) return;
    ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
      uploadArea.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
      });
    });
    ["dragenter", "dragover"].forEach((eventName) => {
      uploadArea.addEventListener(eventName, () => {
        uploadArea.classList.add("drag-over");
      });
    });
    ["dragleave", "drop"].forEach((eventName) => {
      uploadArea.addEventListener(eventName, () => {
        uploadArea.classList.remove("drag-over");
      });
    });
    uploadArea.addEventListener("drop", async (e) => {
      const files = Array.from(e.dataTransfer.files);
      await addImages(files);
    });
  }
  document.addEventListener("DOMContentLoaded", initApp);
})();

  </script>
</body>
</html>